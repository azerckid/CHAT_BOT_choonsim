import{u as N,r as m,w,a as v,b as y}from"./chunk-WWGJGFF6-C0NtPc5H.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{B as k}from"./BottomNavigation-vdZES2hj.js";import{D as f}from"./luxon-BDx6lZXm.js";import{c as C}from"./utils-BQHNewu7.js";import"./_commonjsHelpers-DaWZu8wl.js";function A({initialStatus:p}){const n=N(),[a,d]=m.useState(p),[o,x]=m.useState(!1);return m.useEffect(()=>{if(a==="READY"||a===null||o)return;const c=setInterval(()=>{n.load("/api/wallet/status")},5e3);return()=>clearInterval(c)},[a,o]),m.useEffect(()=>{n.data?.status&&(d(n.data.status),n.data.isReady&&window.location.reload())},[n.data]),a==="READY"||a===null||o?null:e.jsx("div",{className:"mx-4 mt-2",children:e.jsxs("div",{className:"flex items-center gap-3 rounded-xl bg-surface-dark border border-white/10 p-3",children:[(a==="PENDING"||a==="CREATING")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-8 w-8 shrink-0 rounded-full bg-primary/20 flex items-center justify-center",children:e.jsx("div",{className:"h-4 w-4 rounded-full border-2 border-primary border-t-transparent animate-spin"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white text-sm font-bold",children:a==="PENDING"?"지갑 생성 대기 중...":"지갑 생성 중..."}),e.jsx("p",{className:"text-white/40 text-xs",children:"완료되면 자동으로 채팅이 활성화됩니다"})]})]}),a==="FAILED"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-8 w-8 shrink-0 rounded-full bg-red-500/20 flex items-center justify-center",children:e.jsx("span",{className:"text-red-400 text-sm font-bold",children:"!"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white text-sm font-bold",children:"지갑 생성에 문제가 발생했습니다"}),e.jsx("p",{className:"text-white/40 text-xs",children:"자동으로 재시도 중입니다"})]}),e.jsx("button",{onClick:()=>x(!0),className:"text-white/30 hover:text-white/60 transition-colors",children:e.jsx("span",{className:"text-lg leading-none",children:"×"})})]})]})})}function M({}){return[{title:"AI Chat - Home"},{name:"description",content:"AI 아이돌과의 특별한 일상 대화"}]}const T=w(function(){const{user:n,todaysPick:a,recentConversations:d,trendingIdols:o,notices:x,isAuthenticated:c,walletStatus:h}=v(),i=y(),b=async t=>{if(!c){i("/login");return}try{const s=await fetch("/api/chat/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({characterId:t})});if(!s.ok)throw new Error("Failed to create chat");const l=await s.json();i(`/chat/${l.conversationId}`)}catch(s){console.error("Chat creation error:",s)}},g=t=>{const s=f.now(),l=f.fromJSDate(new Date(t)),r=s.diff(l,["minutes","hours","days"]);return r.minutes<1?"방금 전":r.minutes<60?`${Math.floor(r.minutes)}분 전`:r.hours<24?`${Math.floor(r.hours)}시간 전`:r.days<7?`${Math.floor(r.days)}일 전`:l.toFormat("MM/dd")},j=t=>t.character;return e.jsxs("div",{className:"bg-background-light dark:bg-background-dark text-slate-900 dark:text-white font-display antialiased min-h-screen pb-24 max-w-md mx-auto shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"sticky top-0 z-50 flex items-center bg-background-dark/80 backdrop-blur-md p-4 justify-between border-b border-white/5",children:[e.jsx("div",{className:"flex flex-col",children:e.jsx("h2",{className:"text-white text-xl font-extrabold leading-tight tracking-[-0.015em]",children:"AI Chat"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>i("/chats"),className:"text-white hover:text-primary transition-colors",children:e.jsx("span",{className:"material-symbols-outlined text-[24px]",children:"search"})}),e.jsxs("button",{className:"relative text-white hover:text-primary transition-colors mr-1",children:[e.jsx("span",{className:"material-symbols-outlined text-[24px]",children:"notifications"}),e.jsx("span",{className:"absolute top-0 right-0 h-2 w-2 rounded-full bg-primary ring-2 ring-background-dark"})]}),e.jsx("button",{onClick:()=>i(c?"/profile":"/login"),className:"bg-white/10 hover:bg-white/20 text-white text-xs font-bold px-3 py-1.5 rounded-full transition-colors border border-white/10",children:c?"Profile":"Login"})]})]}),h&&h!=="READY"&&e.jsx(A,{initialStatus:h}),e.jsx("div",{className:"p-4 pt-2",children:e.jsxs("div",{className:"relative w-full overflow-hidden rounded-2xl bg-surface-dark shadow-lg",children:[e.jsx("div",{className:"absolute inset-0 h-full w-full bg-cover bg-center",style:{backgroundImage:`url(${a?.media?.filter(t=>t.type==="COVER")?.sort((t,s)=>(t.sortOrder??0)-(s.sortOrder??0))[0]?.url||a?.media?.sort((t,s)=>(t.sortOrder??0)-(s.sortOrder??0))[0]?.url})`}}),e.jsx("div",{className:"absolute inset-0 bg-linear-to-t from-background-dark via-background-dark/40 to-transparent"}),e.jsxs("div",{className:"relative flex min-h-[420px] flex-col justify-end p-6",children:[e.jsx("span",{className:"mb-2 inline-flex w-fit items-center rounded-full bg-primary/20 px-3 py-1 text-xs font-bold text-primary backdrop-blur-sm border border-primary/30",children:"✨ Today's Pick"}),e.jsx("h1",{className:"text-4xl font-black leading-tight tracking-tight text-white mb-1",children:a.name}),e.jsxs("p",{className:"text-base text-gray-200 font-medium mb-6 line-clamp-2",children:['"',a.bio,'"']}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>b(a.id),className:"flex-1 cursor-pointer items-center justify-center rounded-xl h-12 bg-primary text-white text-base font-bold shadow-lg shadow-primary/25 hover:bg-primary/90 transition-all",children:"Chat Now"}),e.jsx("button",{className:"flex h-12 w-12 items-center justify-center rounded-xl bg-white/10 text-white backdrop-blur-md hover:bg-white/20 transition-all",children:e.jsx("span",{className:"material-symbols-outlined",children:"favorite"})})]})]})]})}),e.jsx("div",{className:"px-4 py-2",children:e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("button",{onClick:()=>i("/chats"),className:"flex flex-col items-center gap-2 group",children:[e.jsx("div",{className:"flex h-14 w-14 items-center justify-center rounded-full bg-surface-dark border border-white/10 group-active:scale-95 transition-all text-primary",children:e.jsx("span",{className:"material-symbols-outlined text-[28px]",children:"chat_bubble"})}),e.jsx("span",{className:"text-xs font-medium text-gray-300",children:"New Chat"})]}),e.jsxs("button",{onClick:()=>i("/missions"),className:"flex flex-col items-center gap-2 group",children:[e.jsx("div",{className:"flex h-14 w-14 items-center justify-center rounded-full bg-surface-dark border border-white/10 group-active:scale-95 transition-all text-[#FFD700]",children:e.jsx("span",{className:"material-symbols-outlined text-[28px]",children:"redeem"})}),e.jsx("span",{className:"text-xs font-medium text-gray-300",children:"Missions"})]}),e.jsxs("button",{onClick:()=>i("/fandom"),className:"flex flex-col items-center gap-2 group",children:[e.jsx("div",{className:"flex h-14 w-14 items-center justify-center rounded-full bg-surface-dark border border-white/10 group-active:scale-95 transition-all text-[#4CAF50]",children:e.jsx("span",{className:"material-symbols-outlined text-[28px]",children:"photo_library"})}),e.jsx("span",{className:"text-xs font-medium text-gray-300",children:"Gallery"})]}),e.jsxs("button",{className:"flex flex-col items-center gap-2 group",children:[e.jsx("div",{className:"flex h-14 w-14 items-center justify-center rounded-full bg-surface-dark border border-white/10 group-active:scale-95 transition-all text-[#2196F3]",children:e.jsx("span",{className:"material-symbols-outlined text-[28px]",children:"storefront"})}),e.jsx("span",{className:"text-xs font-medium text-gray-300",children:"Shop"})]})]})}),d.length>0&&e.jsxs("div",{className:"px-4 py-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-white text-lg font-bold",children:"Continue Chatting"}),e.jsx("button",{onClick:()=>i("/chats"),className:"text-primary text-sm font-semibold",children:"View All"})]}),d.slice(0,1).map(t=>{const s=j(t),l=t.Message?.[0];return e.jsxs("button",{onClick:()=>i(`/chat/${t.id}`),className:"w-full flex items-center gap-4 rounded-xl bg-surface-dark p-4 border border-white/5 active:bg-white/5 transition-colors text-left",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{alt:`Avatar of ${s.name}`,className:"h-14 w-14 rounded-full object-cover ring-2 ring-primary/50",src:s.media?.filter(r=>r.type==="AVATAR")?.sort((r,u)=>(r.sortOrder??0)-(u.sortOrder??0))[0]?.url||s.media?.sort((r,u)=>(r.sortOrder??0)-(u.sortOrder??0))[0]?.url}),s.isOnline&&e.jsx("span",{className:"absolute bottom-0 right-0 h-3.5 w-3.5 rounded-full bg-green-500 ring-2 ring-surface-dark"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-baseline mb-1",children:[e.jsx("h3",{className:"text-white font-bold truncate",children:s.name}),l&&e.jsx("span",{className:"text-xs text-gray-500",children:g(l.createdAt)})]}),l&&e.jsx("p",{className:"text-gray-400 text-sm truncate",children:l.content})]}),e.jsx("span",{className:"material-symbols-outlined text-gray-500 text-sm",children:"chevron_right"})]},t.id)})]}),e.jsxs("div",{className:"pb-6",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 mb-3",children:[e.jsx("h2",{className:"text-white text-lg font-bold",children:"Trending Idols"}),e.jsx("span",{className:"material-symbols-outlined text-gray-400",children:"trending_up"})]}),e.jsx("div",{className:"flex overflow-x-auto px-4 gap-4 pb-4 scrollbar-hide snap-x",children:o.map((t,s)=>e.jsxs("button",{onClick:()=>i(`/character/${t.id}`),className:"snap-center shrink-0 w-[140px] flex flex-col gap-2 group cursor-pointer",children:[e.jsxs("div",{className:"relative h-[180px] w-full rounded-xl overflow-hidden",children:[e.jsx("img",{alt:t.name,className:"h-full w-full object-cover transition-transform duration-500 group-hover:scale-110",src:t.media?.filter(l=>l.type==="COVER")?.sort((l,r)=>(l.sortOrder??0)-(r.sortOrder??0))[0]?.url||t.media?.sort((l,r)=>(l.sortOrder??0)-(r.sortOrder??0))[0]?.url}),e.jsx("div",{className:"absolute inset-0 bg-linear-to-t from-black/80 to-transparent opacity-60"}),e.jsx("div",{className:"absolute top-2 left-2 flex h-6 w-6 items-center justify-center rounded-full bg-[#FFD700] text-black text-xs font-bold",children:s+1}),e.jsx("div",{className:"absolute bottom-2 left-2 right-2",children:e.jsxs("div",{className:"flex items-center gap-1 text-xs text-white/80 mb-0.5",children:[e.jsx("span",{className:"material-symbols-outlined text-[12px] text-primary",children:"favorite"}),e.jsx("span",{children:Math.floor(Math.random()*5e3+5e3)})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-bold text-base leading-tight",children:t.name}),e.jsx("p",{className:"text-gray-500 text-xs",children:t.role})]})]},t.id))})]}),e.jsxs("div",{className:"px-4 pb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-white text-lg font-bold",children:"News & Events"}),e.jsx("button",{onClick:()=>i("/notices"),className:"text-primary text-xs font-bold uppercase tracking-widest",children:"See All"})]}),e.jsx("div",{className:"space-y-4",children:x.length===0?e.jsx("div",{className:"py-8 text-center bg-white/5 rounded-2xl border border-white/5",children:e.jsx("p",{className:"text-white/20 text-xs font-bold uppercase tracking-[0.2em]",children:"No official updates yet"})}):x.map(t=>e.jsx("div",{onClick:()=>i(`/notices/${t.id}`),className:"relative overflow-hidden rounded-xl bg-surface-dark border border-white/5 active:bg-white/10 transition-colors cursor-pointer group",children:e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsx("div",{className:"h-28 w-full sm:w-28 shrink-0 bg-cover bg-center bg-linear-to-br from-primary/30 to-purple-600/30",children:t.imageUrl&&e.jsx("img",{src:t.imageUrl,alt:"",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 p-4 flex flex-col justify-center",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:C("rounded px-1.5 py-0.5 text-[8px] font-black uppercase tracking-wider text-white",t.type==="EVENT"?"bg-emerald-500":t.type==="NEWS"?"bg-blue-600":"bg-primary"),children:t.type}),e.jsx("span",{className:"text-[10px] text-gray-500 font-medium",children:f.fromJSDate(new Date(t.createdAt)).toFormat("LLL dd")})]}),e.jsx("h3",{className:"text-white font-bold text-sm mb-1 group-hover:text-primary transition-colors truncate",children:t.title}),e.jsx("p",{className:"text-gray-400 text-[11px] line-clamp-1 leading-relaxed",children:t.content})]})]})},t.id))})]}),e.jsx(k,{})]})});export{T as default,M as meta};
