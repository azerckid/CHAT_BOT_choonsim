import{r as f,L as Hr,w as Br,a as Ur,u as _r,c as Vr,b as zr,d as $r}from"./chunk-WWGJGFF6-C0NtPc5H.js";import{j as d}from"./jsx-runtime-u17CrQMm.js";import{c as Ce}from"./utils-BQHNewu7.js";import{F as rn,G as Ae,H as pt,I as Xe,J as qe,K as Tt,L as Xt,v as be,M as Ge,O as Je,P as hn,Q as Ke,R as Ue,S as Kn,T as on,U as st,V as mt,W as Wr,X as Yn,Y as Kr,Z as sn,_ as an,$ as Lt,a0 as Gn,a1 as ht,f as gt,a2 as Yr,a3 as Xn,t as le,a4 as xt,a5 as it,a6 as qn,w as Mt,a7 as Me,a8 as Pt,z as xe,a9 as ut,aa as Ft,ab as Gr,ac as Xr,x as $e,ad as qr,ae as Jr,af as Jn,ag as Qn,ah as Qr,ai as qt,aj as Zr,s as ue,ak as Fe,al as He,am as eo,an as to,ao as xn,ap as Ct,aq as It,ar as no,as as ro,at as oo,q as yt,au as Zn,av as er,aw as Jt,ax as tr,r as nr,y as bt,ay as so,E as vt,az as io,aA as ao,aB as co,aC as rr,aD as lo,aE as uo,aF as fo,aG as mo,aH as go,aI as po,aJ as ho,aK as xo,aL as St,aM as yo,aN as bo,aO as or,aP as vo,aQ as Te,aR as wo,aS as Ro,aT as sr,aU as Eo,aV as Co,aW as So,aX as Oo,aY as To,aZ as Mo,a_ as Po,a$ as Io,b0 as Qt,b1 as ko,b2 as ir,b3 as Ao,b4 as ar,b5 as No,b6 as jo,b7 as Do,b8 as Lo,b9 as Fo,ba as Ho,bb as Bo,bc as Uo,bd as yn,be as bn,bf as _o,D as Vo,a as zo,b as $o,c as Wo,d as Ko,e as Yo}from"./dialog-Dd6_L6Vt.js";import{a as kt}from"./index-Dc7LDrXT.js";import{a as Go,I as Xo}from"./ItemStoreModal-DVa-JFG-.js";import{L as Zt}from"./LoadingSpinner-Ibipr_pd.js";import{t as nt}from"./index-XQpFve_7.js";import{S as We,N as qo}from"./NetworkError-CKNiMwbG.js";import{A as vn,b as wn,c as Rn,d as En,e as Cn,f as Sn,g as On,h as Tn}from"./alert-dialog-DHfOMHGJ.js";import"./_commonjsHelpers-DaWZu8wl.js";import"./index.min-BJIztz5B.js";import"./react-paypal-js-PCT-g0U3.js";function Mn({value:e,duration:t=500,className:n,prefix:r="",suffix:s=""}){const[o,a]=f.useState(e),[i,g]=f.useState(!1),[l,u]=f.useState("none");return f.useEffect(()=>{if(e===o)return;if(u(e>o?"increase":"decrease"),t===0){a(e);const b=setTimeout(()=>u("none"),300);return()=>clearTimeout(b)}g(!0);const c=o,h=e,y=Date.now(),x=()=>{const b=Date.now(),p=Math.min((b-y)/t,1),C=(v=>v===1?1:1-Math.pow(2,-10*v))(p),R=Math.floor(c+(h-c)*C);a(R),p<1?requestAnimationFrame(x):(a(h),g(!1),setTimeout(()=>u("none"),300))},m=requestAnimationFrame(x);return()=>cancelAnimationFrame(m)},[e,t]),d.jsxs("span",{className:Ce("transition-colors duration-300",l==="decrease"&&"text-red-500 font-bold",l==="increase"&&"text-green-500 font-bold",n),children:[r,o.toLocaleString(),s]})}function Pn({amount:e,duration:t=2e3,className:n}){const[r,s]=f.useState(!1),[o,a]=f.useState(1);if(f.useEffect(()=>{if(e===0)return;s(!0),a(1);const l=t*.6,u=t*.4,c=setTimeout(()=>{const y=Date.now(),x=()=>{const m=Date.now()-y,b=Math.min(m/u,1);a(1-b),b<1?requestAnimationFrame(x):s(!1)};requestAnimationFrame(x)},l),h=setTimeout(()=>{s(!1)},t);return()=>{clearTimeout(c),clearTimeout(h)}},[e,t]),!r||e===0)return null;const i=e>0,g=Math.abs(e);return d.jsxs("span",{className:Ce("inline-block font-bold text-xs transition-opacity duration-300",i?"text-green-500":"text-red-500",n),style:{opacity:o},children:[i?"+":"-",g.toLocaleString()]})}const Jo=["top","right","bottom","left"],at=Math.min,De=Math.max,At=Math.round,rt=Math.floor,ze=e=>({x:e,y:e}),Qo={left:"right",right:"left",bottom:"top",top:"bottom"},Zo={start:"end",end:"start"};function en(e,t,n){return De(e,at(t,n))}function Ye(e,t){return typeof e=="function"?e(t):e}function Le(e){return e.split("-")[0]}function Qe(e){return e.split("-")[1]}function cn(e){return e==="x"?"y":"x"}function ln(e){return e==="y"?"height":"width"}const es=new Set(["top","bottom"]);function Be(e){return es.has(Le(e))?"y":"x"}function un(e){return cn(Be(e))}function ts(e,t,n){n===void 0&&(n=!1);const r=Qe(e),s=un(e),o=ln(s);let a=s==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return t.reference[o]>t.floating[o]&&(a=Nt(a)),[a,Nt(a)]}function ns(e){const t=Nt(e);return[tn(e),t,tn(t)]}function tn(e){return e.replace(/start|end/g,t=>Zo[t])}const In=["left","right"],kn=["right","left"],rs=["top","bottom"],os=["bottom","top"];function ss(e,t,n){switch(e){case"top":case"bottom":return n?t?kn:In:t?In:kn;case"left":case"right":return t?rs:os;default:return[]}}function is(e,t,n,r){const s=Qe(e);let o=ss(Le(e),n==="start",r);return s&&(o=o.map(a=>a+"-"+s),t&&(o=o.concat(o.map(tn)))),o}function Nt(e){return e.replace(/left|right|bottom|top/g,t=>Qo[t])}function as(e){return{top:0,right:0,bottom:0,left:0,...e}}function cr(e){return typeof e!="number"?as(e):{top:e,right:e,bottom:e,left:e}}function jt(e){const{x:t,y:n,width:r,height:s}=e;return{width:r,height:s,top:n,left:t,right:t+r,bottom:n+s,x:t,y:n}}function wt(e,t,n){return Math.floor(e/t)!==n}function ft(e,t){return t<0||t>=e.current.length}function Vt(e,t){return Pe(e,{disabledIndices:t})}function An(e,t){return Pe(e,{decrement:!0,startingIndex:e.current.length,disabledIndices:t})}function Pe(e,{startingIndex:t=-1,decrement:n=!1,disabledIndices:r,amount:s=1}={}){let o=t;do o+=n?-s:s;while(o>=0&&o<=e.current.length-1&&dt(e,o,r));return o}function cs(e,{event:t,orientation:n,loopFocus:r,rtl:s,cols:o,disabledIndices:a,minIndex:i,maxIndex:g,prevIndex:l,stopEvent:u=!1}){let c=l;const h=[],y={};let x=!1;{let p=null,w=-1;e.current.forEach((C,R)=>{if(C==null)return;const v=C.closest('[role="row"]');v&&(x=!0),(v!==p||w===-1)&&(p=v,w+=1,h[w]=[]),h[w].push(R),y[R]=w})}const m=x&&h.length>0&&h.some(p=>p.length!==o);function b(p){if(!m||l===-1)return;const w=y[l];if(w==null)return;const C=h[w].indexOf(l);let R=p==="up"?w-1:w+1;r&&(R<0?R=h.length-1:R>=h.length&&(R=0));const v=new Set;for(;R>=0&&R<h.length&&!v.has(R);){v.add(R);const E=h[R];if(E.length===0){R=p==="up"?R-1:R+1;continue}const S=Math.min(C,E.length-1);for(let k=S;k>=0;k-=1){const U=E[k];if(!dt(e,U,a))return U}R=p==="up"?R-1:R+1,r&&(R<0?R=h.length-1:R>=h.length&&(R=0))}}if(t.key===rn){const p=b("up");if(p!==void 0)u&&Ae(t),c=p;else{if(u&&Ae(t),l===-1)c=g;else if(c=Pe(e,{startingIndex:c,amount:o,decrement:!0,disabledIndices:a}),r&&(l-o<i||c<0)){const w=l%o,C=g%o,R=g-(C-w);C===w?c=g:c=C>w?R:R-o}ft(e,c)&&(c=l)}}if(t.key===pt){const p=b("down");p!==void 0?(u&&Ae(t),c=p):(u&&Ae(t),l===-1?c=i:(c=Pe(e,{startingIndex:l,amount:o,disabledIndices:a}),r&&l+o>g&&(c=Pe(e,{startingIndex:l%o-o,amount:o,disabledIndices:a}))),ft(e,c)&&(c=l))}if(n==="both"){const p=rt(l/o);t.key===(s?Xe:qe)&&(u&&Ae(t),l%o!==o-1?(c=Pe(e,{startingIndex:l,disabledIndices:a}),r&&wt(c,o,p)&&(c=Pe(e,{startingIndex:l-l%o-1,disabledIndices:a}))):r&&(c=Pe(e,{startingIndex:l-l%o-1,disabledIndices:a})),wt(c,o,p)&&(c=l)),t.key===(s?qe:Xe)&&(u&&Ae(t),l%o!==0?(c=Pe(e,{startingIndex:l,decrement:!0,disabledIndices:a}),r&&wt(c,o,p)&&(c=Pe(e,{startingIndex:l+(o-l%o),decrement:!0,disabledIndices:a}))):r&&(c=Pe(e,{startingIndex:l+(o-l%o),decrement:!0,disabledIndices:a})),wt(c,o,p)&&(c=l));const w=rt(g/o)===p;ft(e,c)&&(r&&w?c=t.key===(s?qe:Xe)?g:Pe(e,{startingIndex:l-l%o-1,disabledIndices:a}):c=l)}return c}function ls(e,t,n){const r=[];let s=0;return e.forEach(({width:o,height:a},i)=>{let g=!1;for(;!g;){const l=[];for(let u=0;u<o;u+=1)for(let c=0;c<a;c+=1)l.push(s+u+c*t);s%t+o<=t&&l.every(u=>r[u]==null)?(l.forEach(u=>{r[u]=i}),g=!0):s+=1}}),[...r]}function us(e,t,n,r,s){if(e===-1)return-1;const o=n.indexOf(e),a=t[e];switch(s){case"tl":return o;case"tr":return a?o+a.width-1:o;case"bl":return a?o+(a.height-1)*r:o;case"br":return n.lastIndexOf(e);default:return-1}}function fs(e,t){return t.flatMap((n,r)=>e.includes(n)?[r]:[])}function dt(e,t,n){if(typeof n=="function")return n(t);if(n)return n.includes(t);const r=e.current[t];return r?r.hasAttribute("disabled")||r.getAttribute("aria-disabled")==="true":!1}function zt(e,t,n){if(n&&!Tt(n))return 0;if(typeof e=="number")return e;if(typeof e=="function"){const r=e();return typeof r=="number"?r:r?.[t]}return e?.[t]}function Nn(e,t,n){let{reference:r,floating:s}=e;const o=Be(t),a=un(t),i=ln(a),g=Le(t),l=o==="y",u=r.x+r.width/2-s.width/2,c=r.y+r.height/2-s.height/2,h=r[i]/2-s[i]/2;let y;switch(g){case"top":y={x:u,y:r.y-s.height};break;case"bottom":y={x:u,y:r.y+r.height};break;case"right":y={x:r.x+r.width,y:c};break;case"left":y={x:r.x-s.width,y:c};break;default:y={x:r.x,y:r.y}}switch(Qe(t)){case"start":y[a]-=h*(n&&l?-1:1);break;case"end":y[a]+=h*(n&&l?-1:1);break}return y}async function ds(e,t){var n;t===void 0&&(t={});const{x:r,y:s,platform:o,rects:a,elements:i,strategy:g}=e,{boundary:l="clippingAncestors",rootBoundary:u="viewport",elementContext:c="floating",altBoundary:h=!1,padding:y=0}=Ye(t,e),x=cr(y),b=i[h?c==="floating"?"reference":"floating":c],p=jt(await o.getClippingRect({element:(n=await(o.isElement==null?void 0:o.isElement(b)))==null||n?b:b.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(i.floating)),boundary:l,rootBoundary:u,strategy:g})),w=c==="floating"?{x:r,y:s,width:a.floating.width,height:a.floating.height}:a.reference,C=await(o.getOffsetParent==null?void 0:o.getOffsetParent(i.floating)),R=await(o.isElement==null?void 0:o.isElement(C))?await(o.getScale==null?void 0:o.getScale(C))||{x:1,y:1}:{x:1,y:1},v=jt(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:i,rect:w,offsetParent:C,strategy:g}):w);return{top:(p.top-v.top+x.top)/R.y,bottom:(v.bottom-p.bottom+x.bottom)/R.y,left:(p.left-v.left+x.left)/R.x,right:(v.right-p.right+x.right)/R.x}}const ms=async(e,t,n)=>{const{placement:r="bottom",strategy:s="absolute",middleware:o=[],platform:a}=n,i=o.filter(Boolean),g=await(a.isRTL==null?void 0:a.isRTL(t));let l=await a.getElementRects({reference:e,floating:t,strategy:s}),{x:u,y:c}=Nn(l,r,g),h=r,y={},x=0;for(let b=0;b<i.length;b++){var m;const{name:p,fn:w}=i[b],{x:C,y:R,data:v,reset:E}=await w({x:u,y:c,initialPlacement:r,placement:h,strategy:s,middlewareData:y,rects:l,platform:{...a,detectOverflow:(m=a.detectOverflow)!=null?m:ds},elements:{reference:e,floating:t}});u=C??u,c=R??c,y={...y,[p]:{...y[p],...v}},E&&x<=50&&(x++,typeof E=="object"&&(E.placement&&(h=E.placement),E.rects&&(l=E.rects===!0?await a.getElementRects({reference:e,floating:t,strategy:s}):E.rects),{x:u,y:c}=Nn(l,h,g)),b=-1)}return{x:u,y:c,placement:h,strategy:s,middlewareData:y}},gs=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var n,r;const{placement:s,middlewareData:o,rects:a,initialPlacement:i,platform:g,elements:l}=t,{mainAxis:u=!0,crossAxis:c=!0,fallbackPlacements:h,fallbackStrategy:y="bestFit",fallbackAxisSideDirection:x="none",flipAlignment:m=!0,...b}=Ye(e,t);if((n=o.arrow)!=null&&n.alignmentOffset)return{};const p=Le(s),w=Be(i),C=Le(i)===i,R=await(g.isRTL==null?void 0:g.isRTL(l.floating)),v=h||(C||!m?[Nt(i)]:ns(i)),E=x!=="none";!h&&E&&v.push(...is(i,m,x,R));const S=[i,...v],k=await g.detectOverflow(t,b),U=[];let P=((r=o.flip)==null?void 0:r.overflows)||[];if(u&&U.push(k[p]),c){const I=ts(s,a,R);U.push(k[I[0]],k[I[1]])}if(P=[...P,{placement:s,overflows:U}],!U.every(I=>I<=0)){var j,N;const I=(((j=o.flip)==null?void 0:j.index)||0)+1,L=S[I];if(L&&(!(c==="alignment"?w!==Be(L):!1)||P.every(T=>Be(T.placement)===w?T.overflows[0]>0:!0)))return{data:{index:I,overflows:P},reset:{placement:L}};let F=(N=P.filter(M=>M.overflows[0]<=0).sort((M,T)=>M.overflows[1]-T.overflows[1])[0])==null?void 0:N.placement;if(!F)switch(y){case"bestFit":{var O;const M=(O=P.filter(T=>{if(E){const D=Be(T.placement);return D===w||D==="y"}return!0}).map(T=>[T.placement,T.overflows.filter(D=>D>0).reduce((D,_)=>D+_,0)]).sort((T,D)=>T[1]-D[1])[0])==null?void 0:O[0];M&&(F=M);break}case"initialPlacement":F=i;break}if(s!==F)return{reset:{placement:F}}}return{}}}};function jn(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function Dn(e){return Jo.some(t=>e[t]>=0)}const ps=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:n,platform:r}=t,{strategy:s="referenceHidden",...o}=Ye(e,t);switch(s){case"referenceHidden":{const a=await r.detectOverflow(t,{...o,elementContext:"reference"}),i=jn(a,n.reference);return{data:{referenceHiddenOffsets:i,referenceHidden:Dn(i)}}}case"escaped":{const a=await r.detectOverflow(t,{...o,altBoundary:!0}),i=jn(a,n.floating);return{data:{escapedOffsets:i,escaped:Dn(i)}}}default:return{}}}}},lr=new Set(["left","top"]);async function hs(e,t){const{placement:n,platform:r,elements:s}=e,o=await(r.isRTL==null?void 0:r.isRTL(s.floating)),a=Le(n),i=Qe(n),g=Be(n)==="y",l=lr.has(a)?-1:1,u=o&&g?-1:1,c=Ye(t,e);let{mainAxis:h,crossAxis:y,alignmentAxis:x}=typeof c=="number"?{mainAxis:c,crossAxis:0,alignmentAxis:null}:{mainAxis:c.mainAxis||0,crossAxis:c.crossAxis||0,alignmentAxis:c.alignmentAxis};return i&&typeof x=="number"&&(y=i==="end"?x*-1:x),g?{x:y*u,y:h*l}:{x:h*l,y:y*u}}const xs=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var n,r;const{x:s,y:o,placement:a,middlewareData:i}=t,g=await hs(t,e);return a===((n=i.offset)==null?void 0:n.placement)&&(r=i.arrow)!=null&&r.alignmentOffset?{}:{x:s+g.x,y:o+g.y,data:{...g,placement:a}}}}},ys=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:n,y:r,placement:s,platform:o}=t,{mainAxis:a=!0,crossAxis:i=!1,limiter:g={fn:p=>{let{x:w,y:C}=p;return{x:w,y:C}}},...l}=Ye(e,t),u={x:n,y:r},c=await o.detectOverflow(t,l),h=Be(Le(s)),y=cn(h);let x=u[y],m=u[h];if(a){const p=y==="y"?"top":"left",w=y==="y"?"bottom":"right",C=x+c[p],R=x-c[w];x=en(C,x,R)}if(i){const p=h==="y"?"top":"left",w=h==="y"?"bottom":"right",C=m+c[p],R=m-c[w];m=en(C,m,R)}const b=g.fn({...t,[y]:x,[h]:m});return{...b,data:{x:b.x-n,y:b.y-r,enabled:{[y]:a,[h]:i}}}}}},bs=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:n,y:r,placement:s,rects:o,middlewareData:a}=t,{offset:i=0,mainAxis:g=!0,crossAxis:l=!0}=Ye(e,t),u={x:n,y:r},c=Be(s),h=cn(c);let y=u[h],x=u[c];const m=Ye(i,t),b=typeof m=="number"?{mainAxis:m,crossAxis:0}:{mainAxis:0,crossAxis:0,...m};if(g){const C=h==="y"?"height":"width",R=o.reference[h]-o.floating[C]+b.mainAxis,v=o.reference[h]+o.reference[C]-b.mainAxis;y<R?y=R:y>v&&(y=v)}if(l){var p,w;const C=h==="y"?"width":"height",R=lr.has(Le(s)),v=o.reference[c]-o.floating[C]+(R&&((p=a.offset)==null?void 0:p[c])||0)+(R?0:b.crossAxis),E=o.reference[c]+o.reference[C]+(R?0:((w=a.offset)==null?void 0:w[c])||0)-(R?b.crossAxis:0);x<v?x=v:x>E&&(x=E)}return{[h]:y,[c]:x}}}},vs=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var n,r;const{placement:s,rects:o,platform:a,elements:i}=t,{apply:g=()=>{},...l}=Ye(e,t),u=await a.detectOverflow(t,l),c=Le(s),h=Qe(s),y=Be(s)==="y",{width:x,height:m}=o.floating;let b,p;c==="top"||c==="bottom"?(b=c,p=h===(await(a.isRTL==null?void 0:a.isRTL(i.floating))?"start":"end")?"left":"right"):(p=c,b=h==="end"?"top":"bottom");const w=m-u.top-u.bottom,C=x-u.left-u.right,R=at(m-u[b],w),v=at(x-u[p],C),E=!t.middlewareData.shift;let S=R,k=v;if((n=t.middlewareData.shift)!=null&&n.enabled.x&&(k=C),(r=t.middlewareData.shift)!=null&&r.enabled.y&&(S=w),E&&!h){const P=De(u.left,0),j=De(u.right,0),N=De(u.top,0),O=De(u.bottom,0);y?k=x-2*(P!==0||j!==0?P+j:De(u.left,u.right)):S=m-2*(N!==0||O!==0?N+O:De(u.top,u.bottom))}await g({...t,availableWidth:k,availableHeight:S});const U=await a.getDimensions(i.floating);return x!==U.width||m!==U.height?{reset:{rects:!0}}:{}}}};function ur(e){const t=Ke(e);let n=parseFloat(t.width)||0,r=parseFloat(t.height)||0;const s=Ue(e),o=s?e.offsetWidth:n,a=s?e.offsetHeight:r,i=At(n)!==o||At(r)!==a;return i&&(n=o,r=a),{width:n,height:r,$:i}}function fn(e){return be(e)?e:e.contextElement}function ot(e){const t=fn(e);if(!Ue(t))return ze(1);const n=t.getBoundingClientRect(),{width:r,height:s,$:o}=ur(t);let a=(o?At(n.width):n.width)/r,i=(o?At(n.height):n.height)/s;return(!a||!Number.isFinite(a))&&(a=1),(!i||!Number.isFinite(i))&&(i=1),{x:a,y:i}}const ws=ze(0);function fr(e){const t=Je(e);return!Kn()||!t.visualViewport?ws:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function Rs(e,t,n){return t===void 0&&(t=!1),!n||t&&n!==Je(e)?!1:t}function Ze(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=!1);const s=e.getBoundingClientRect(),o=fn(e);let a=ze(1);t&&(r?be(r)&&(a=ot(r)):a=ot(e));const i=Rs(o,n,r)?fr(o):ze(0);let g=(s.left+i.x)/a.x,l=(s.top+i.y)/a.y,u=s.width/a.x,c=s.height/a.y;if(o){const h=Je(o),y=r&&be(r)?Je(r):r;let x=h,m=hn(x);for(;m&&r&&y!==x;){const b=ot(m),p=m.getBoundingClientRect(),w=Ke(m),C=p.left+(m.clientLeft+parseFloat(w.paddingLeft))*b.x,R=p.top+(m.clientTop+parseFloat(w.paddingTop))*b.y;g*=b.x,l*=b.y,u*=b.x,c*=b.y,g+=C,l+=R,x=Je(m),m=hn(x)}}return jt({width:u,height:c,x:g,y:l})}function Ht(e,t){const n=Lt(e).scrollLeft;return t?t.left+n:Ze(Ge(e)).left+n}function dr(e,t){const n=e.getBoundingClientRect(),r=n.left+t.scrollLeft-Ht(e,n),s=n.top+t.scrollTop;return{x:r,y:s}}function Es(e){let{elements:t,rect:n,offsetParent:r,strategy:s}=e;const o=s==="fixed",a=Ge(r),i=t?on(t.floating):!1;if(r===a||i&&o)return n;let g={scrollLeft:0,scrollTop:0},l=ze(1);const u=ze(0),c=Ue(r);if((c||!c&&!o)&&((sn(r)!=="body"||an(a))&&(g=Lt(r)),Ue(r))){const y=Ze(r);l=ot(r),u.x=y.x+r.clientLeft,u.y=y.y+r.clientTop}const h=a&&!c&&!o?dr(a,g):ze(0);return{width:n.width*l.x,height:n.height*l.y,x:n.x*l.x-g.scrollLeft*l.x+u.x+h.x,y:n.y*l.y-g.scrollTop*l.y+u.y+h.y}}function Cs(e){return Array.from(e.getClientRects())}function Ss(e){const t=Ge(e),n=Lt(e),r=e.ownerDocument.body,s=De(t.scrollWidth,t.clientWidth,r.scrollWidth,r.clientWidth),o=De(t.scrollHeight,t.clientHeight,r.scrollHeight,r.clientHeight);let a=-n.scrollLeft+Ht(e);const i=-n.scrollTop;return Ke(r).direction==="rtl"&&(a+=De(t.clientWidth,r.clientWidth)-s),{width:s,height:o,x:a,y:i}}const Ln=25;function Os(e,t){const n=Je(e),r=Ge(e),s=n.visualViewport;let o=r.clientWidth,a=r.clientHeight,i=0,g=0;if(s){o=s.width,a=s.height;const u=Kn();(!u||u&&t==="fixed")&&(i=s.offsetLeft,g=s.offsetTop)}const l=Ht(r);if(l<=0){const u=r.ownerDocument,c=u.body,h=getComputedStyle(c),y=u.compatMode==="CSS1Compat"&&parseFloat(h.marginLeft)+parseFloat(h.marginRight)||0,x=Math.abs(r.clientWidth-c.clientWidth-y);x<=Ln&&(o-=x)}else l<=Ln&&(o+=l);return{width:o,height:a,x:i,y:g}}const Ts=new Set(["absolute","fixed"]);function Ms(e,t){const n=Ze(e,!0,t==="fixed"),r=n.top+e.clientTop,s=n.left+e.clientLeft,o=Ue(e)?ot(e):ze(1),a=e.clientWidth*o.x,i=e.clientHeight*o.y,g=s*o.x,l=r*o.y;return{width:a,height:i,x:g,y:l}}function Fn(e,t,n){let r;if(t==="viewport")r=Os(e,n);else if(t==="document")r=Ss(Ge(e));else if(be(t))r=Ms(t,n);else{const s=fr(e);r={x:t.x-s.x,y:t.y-s.y,width:t.width,height:t.height}}return jt(r)}function mr(e,t){const n=st(e);return n===t||!be(n)||mt(n)?!1:Ke(n).position==="fixed"||mr(n,t)}function Ps(e,t){const n=t.get(e);if(n)return n;let r=Xt(e,[],!1).filter(i=>be(i)&&sn(i)!=="body"),s=null;const o=Ke(e).position==="fixed";let a=o?st(e):e;for(;be(a)&&!mt(a);){const i=Ke(a),g=Yn(a);!g&&i.position==="fixed"&&(s=null),(o?!g&&!s:!g&&i.position==="static"&&!!s&&Ts.has(s.position)||an(a)&&!g&&mr(e,a))?r=r.filter(u=>u!==a):s=i,a=st(a)}return t.set(e,r),r}function Is(e){let{element:t,boundary:n,rootBoundary:r,strategy:s}=e;const a=[...n==="clippingAncestors"?on(t)?[]:Ps(t,this._c):[].concat(n),r],i=a[0],g=a.reduce((l,u)=>{const c=Fn(t,u,s);return l.top=De(c.top,l.top),l.right=at(c.right,l.right),l.bottom=at(c.bottom,l.bottom),l.left=De(c.left,l.left),l},Fn(t,i,s));return{width:g.right-g.left,height:g.bottom-g.top,x:g.left,y:g.top}}function ks(e){const{width:t,height:n}=ur(e);return{width:t,height:n}}function As(e,t,n){const r=Ue(t),s=Ge(t),o=n==="fixed",a=Ze(e,!0,o,t);let i={scrollLeft:0,scrollTop:0};const g=ze(0);function l(){g.x=Ht(s)}if(r||!r&&!o)if((sn(t)!=="body"||an(s))&&(i=Lt(t)),r){const y=Ze(t,!0,o,t);g.x=y.x+t.clientLeft,g.y=y.y+t.clientTop}else s&&l();o&&!r&&s&&l();const u=s&&!r&&!o?dr(s,i):ze(0),c=a.left+i.scrollLeft-g.x-u.x,h=a.top+i.scrollTop-g.y-u.y;return{x:c,y:h,width:a.width,height:a.height}}function $t(e){return Ke(e).position==="static"}function Hn(e,t){if(!Ue(e)||Ke(e).position==="fixed")return null;if(t)return t(e);let n=e.offsetParent;return Ge(e)===n&&(n=n.ownerDocument.body),n}function gr(e,t){const n=Je(e);if(on(e))return n;if(!Ue(e)){let s=st(e);for(;s&&!mt(s);){if(be(s)&&!$t(s))return s;s=st(s)}return n}let r=Hn(e,t);for(;r&&Wr(r)&&$t(r);)r=Hn(r,t);return r&&mt(r)&&$t(r)&&!Yn(r)?n:r||Kr(e)||n}const Ns=async function(e){const t=this.getOffsetParent||gr,n=this.getDimensions,r=await n(e.floating);return{reference:As(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function js(e){return Ke(e).direction==="rtl"}const Ds={convertOffsetParentRelativeRectToViewportRelativeRect:Es,getDocumentElement:Ge,getClippingRect:Is,getOffsetParent:gr,getElementRects:Ns,getClientRects:Cs,getDimensions:ks,getScale:ot,isElement:be,isRTL:js};function pr(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function Ls(e,t){let n=null,r;const s=Ge(e);function o(){var i;clearTimeout(r),(i=n)==null||i.disconnect(),n=null}function a(i,g){i===void 0&&(i=!1),g===void 0&&(g=1),o();const l=e.getBoundingClientRect(),{left:u,top:c,width:h,height:y}=l;if(i||t(),!h||!y)return;const x=rt(c),m=rt(s.clientWidth-(u+h)),b=rt(s.clientHeight-(c+y)),p=rt(u),C={rootMargin:-x+"px "+-m+"px "+-b+"px "+-p+"px",threshold:De(0,at(1,g))||1};let R=!0;function v(E){const S=E[0].intersectionRatio;if(S!==g){if(!R)return a();S?a(!1,S):r=setTimeout(()=>{a(!1,1e-7)},1e3)}S===1&&!pr(l,e.getBoundingClientRect())&&a(),R=!1}try{n=new IntersectionObserver(v,{...C,root:s.ownerDocument})}catch{n=new IntersectionObserver(v,C)}n.observe(e)}return a(!0),o}function Bn(e,t,n,r){r===void 0&&(r={});const{ancestorScroll:s=!0,ancestorResize:o=!0,elementResize:a=typeof ResizeObserver=="function",layoutShift:i=typeof IntersectionObserver=="function",animationFrame:g=!1}=r,l=fn(e),u=s||o?[...l?Xt(l):[],...Xt(t)]:[];u.forEach(p=>{s&&p.addEventListener("scroll",n,{passive:!0}),o&&p.addEventListener("resize",n)});const c=l&&i?Ls(l,n):null;let h=-1,y=null;a&&(y=new ResizeObserver(p=>{let[w]=p;w&&w.target===l&&y&&(y.unobserve(t),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{var C;(C=y)==null||C.observe(t)})),n()}),l&&!g&&y.observe(l),y.observe(t));let x,m=g?Ze(e):null;g&&b();function b(){const p=Ze(e);m&&!pr(m,p)&&n(),m=p,x=requestAnimationFrame(b)}return n(),()=>{var p;u.forEach(w=>{s&&w.removeEventListener("scroll",n),o&&w.removeEventListener("resize",n)}),c?.(),(p=y)==null||p.disconnect(),y=null,g&&cancelAnimationFrame(x)}}const Fs=xs,Hs=ys,Bs=gs,Us=vs,_s=ps,Vs=bs,zs=(e,t,n)=>{const r=new Map,s={platform:Ds,...n},o={...s.platform,_c:r};return ms(e,t,{...s,platform:o})};var $s=typeof document<"u",Ws=function(){},Ot=$s?f.useLayoutEffect:Ws;function Dt(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let n,r,s;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(n=e.length,n!==t.length)return!1;for(r=n;r--!==0;)if(!Dt(e[r],t[r]))return!1;return!0}if(s=Object.keys(e),n=s.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!{}.hasOwnProperty.call(t,s[r]))return!1;for(r=n;r--!==0;){const o=s[r];if(!(o==="_owner"&&e.$$typeof)&&!Dt(e[o],t[o]))return!1}return!0}return e!==e&&t!==t}function hr(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function Un(e,t){const n=hr(e);return Math.round(t*n)/n}function Wt(e){const t=f.useRef(e);return Ot(()=>{t.current=e}),t}function Ks(e){e===void 0&&(e={});const{placement:t="bottom",strategy:n="absolute",middleware:r=[],platform:s,elements:{reference:o,floating:a}={},transform:i=!0,whileElementsMounted:g,open:l}=e,[u,c]=f.useState({x:0,y:0,strategy:n,placement:t,middlewareData:{},isPositioned:!1}),[h,y]=f.useState(r);Dt(h,r)||y(r);const[x,m]=f.useState(null),[b,p]=f.useState(null),w=f.useCallback(T=>{T!==E.current&&(E.current=T,m(T))},[]),C=f.useCallback(T=>{T!==S.current&&(S.current=T,p(T))},[]),R=o||x,v=a||b,E=f.useRef(null),S=f.useRef(null),k=f.useRef(u),U=g!=null,P=Wt(g),j=Wt(s),N=Wt(l),O=f.useCallback(()=>{if(!E.current||!S.current)return;const T={placement:t,strategy:n,middleware:h};j.current&&(T.platform=j.current),zs(E.current,S.current,T).then(D=>{const _={...D,isPositioned:N.current!==!1};I.current&&!Dt(k.current,_)&&(k.current=_,kt.flushSync(()=>{c(_)}))})},[h,t,n,j,N]);Ot(()=>{l===!1&&k.current.isPositioned&&(k.current.isPositioned=!1,c(T=>({...T,isPositioned:!1})))},[l]);const I=f.useRef(!1);Ot(()=>(I.current=!0,()=>{I.current=!1}),[]),Ot(()=>{if(R&&(E.current=R),v&&(S.current=v),R&&v){if(P.current)return P.current(R,v,O);O()}},[R,v,O,P,U]);const L=f.useMemo(()=>({reference:E,floating:S,setReference:w,setFloating:C}),[w,C]),F=f.useMemo(()=>({reference:R,floating:v}),[R,v]),M=f.useMemo(()=>{const T={position:n,left:0,top:0};if(!F.floating)return T;const D=Un(F.floating,u.x),_=Un(F.floating,u.y);return i?{...T,transform:"translate("+D+"px, "+_+"px)",...hr(F.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:D,top:_}},[n,i,F.floating,u.x,u.y]);return f.useMemo(()=>({...u,update:O,refs:L,elements:F,floatingStyles:M}),[u,O,L,F,M])}const Ys=(e,t)=>({...Fs(e),options:[e,t]}),Gs=(e,t)=>({...Hs(e),options:[e,t]}),Xs=(e,t)=>({...Vs(e),options:[e,t]}),qs=(e,t)=>({...Bs(e),options:[e,t]}),Js=(e,t)=>({...Us(e),options:[e,t]}),Qs=(e,t)=>({..._s(e),options:[e,t]});function Zs(e){const{open:t=!1,onOpenChange:n,elements:r={}}=e,s=Gn(),o=ht()!=null,a=gt(()=>new Yr({open:t,onOpenChange:n,referenceElement:r.reference??null,floatingElement:r.floating??null,triggerElements:new Xn,floatingId:s,nested:o,noEmit:!1})).current;return le(()=>{const i={open:t,floatingId:s};r.reference!==void 0&&(i.referenceElement=r.reference,i.domReferenceElement=be(r.reference)?r.reference:null),r.floating!==void 0&&(i.floatingElement=r.floating),a.update(i)},[t,s,r.reference,r.floating,a]),a.context.onOpenChange=n,a.context.nested=o,a.context.noEmit=!1,a}function ei(e={}){const{nodeId:t,externalTree:n}=e,r=Zs(e),s=e.rootContext||r,o={reference:s.useState("referenceElement"),floating:s.useState("floatingElement"),domReference:s.useState("domReferenceElement")},[a,i]=f.useState(null),g=f.useRef(null),l=xt(n);le(()=>{o.domReference&&(g.current=o.domReference)},[o.domReference]);const u=Ks({...e,elements:{...o,...a&&{reference:a}}}),c=f.useCallback(S=>{const k=be(S)?{getBoundingClientRect:()=>S.getBoundingClientRect(),getClientRects:()=>S.getClientRects(),contextElement:S}:S;i(k),u.refs.setReference(k)},[u.refs]),[h,y]=f.useState(null),[x,m]=f.useState(null);s.useSyncedValue("referenceElement",h),s.useSyncedValue("domReferenceElement",be(h)?h:null),s.useSyncedValue("floatingElement",x);const b=f.useCallback(S=>{(be(S)||S===null)&&(g.current=S,y(S)),(be(u.refs.reference.current)||u.refs.reference.current===null||S!==null&&!be(S))&&u.refs.setReference(S)},[u.refs,y]),p=f.useCallback(S=>{m(S),u.refs.setFloating(S)},[u.refs]),w=f.useMemo(()=>({...u.refs,setReference:b,setFloating:p,setPositionReference:c,domReference:g}),[u.refs,b,p,c]),C=f.useMemo(()=>({...u.elements,domReference:o.domReference}),[u.elements,o.domReference]),R=s.useState("open"),v=s.useState("floatingId"),E=f.useMemo(()=>({...u,dataRef:s.context.dataRef,open:R,onOpenChange:s.setOpen,events:s.context.events,floatingId:v,refs:w,elements:C,nodeId:t,rootStore:s}),[u,w,C,t,s,R,v]);return le(()=>{s.context.dataRef.current.floatingContext=E;const S=l?.nodesRef.current.find(k=>k.id===t);S&&(S.context=E)}),f.useMemo(()=>({...u,context:E,refs:w,elements:C,rootStore:s}),[u,w,C,E,s])}const Kt=qr&&Jr;function ti(e,t={}){const n="rootStore"in e?e.rootStore:e,{events:r,dataRef:s}=n.context,{enabled:o=!0,delay:a}=t,i=f.useRef(!1),g=f.useRef(null),l=it(),u=f.useRef(!0);f.useEffect(()=>{const h=n.select("domReferenceElement");if(!o)return;const y=Je(h);function x(){const p=n.select("domReferenceElement");!n.select("open")&&Ue(p)&&p===Mt($e(p))&&(i.current=!0)}function m(){u.current=!0}function b(){u.current=!1}return y.addEventListener("blur",x),Kt&&(y.addEventListener("keydown",m,!0),y.addEventListener("pointerdown",b,!0)),()=>{y.removeEventListener("blur",x),Kt&&(y.removeEventListener("keydown",m,!0),y.removeEventListener("pointerdown",b,!0))}},[n,o]),f.useEffect(()=>{if(!o)return;function h(y){if(y.reason===Jn||y.reason===Qn){const x=n.select("domReferenceElement");be(x)&&(g.current=x,i.current=!0)}}return r.on("openchange",h),()=>{r.off("openchange",h)}},[r,o,n]);const c=f.useMemo(()=>({onMouseLeave(){i.current=!1,g.current=null},onFocus(h){const y=h.currentTarget;if(i.current){if(g.current===y)return;i.current=!1,g.current=null}const x=Ft(h.nativeEvent);if(be(x)){if(Kt&&!h.relatedTarget){if(!u.current&&!Gr(x))return}else if(!Xr(x))return}const m=Pt(h.relatedTarget,n.context.triggerElements),{nativeEvent:b,currentTarget:p}=h,w=typeof a=="function"?a():a;if(n.select("open")&&m||w===0||w===void 0){n.setOpen(!0,xe(ut,b,p));return}l.start(w,()=>{i.current||n.setOpen(!0,xe(ut,b,p))})},onBlur(h){i.current=!1,g.current=null;const y=h.relatedTarget,x=h.nativeEvent,m=be(y)&&y.hasAttribute(qn("focus-guard"))&&y.getAttribute("data-type")==="outside";l.start(0,()=>{const b=n.select("domReferenceElement"),p=Mt(b?b.ownerDocument:document);!y&&p===b||Me(s.current.floatingContext?.refs.floating.current,p)||Me(b,p)||m||Pt(y??p,n.context.triggerElements)||n.setOpen(!1,xe(ut,x))})}}),[s,n,l,a]);return f.useMemo(()=>o?{reference:c,trigger:c}:{},[o,c])}const nn=qn("safe-polygon"),ni=`button,a,[role="button"],select,[tabindex]:not([tabindex="-1"]),${Zr}`;function ri(e){return e?!!e.closest(ni):!1}class dn{constructor(){this.pointerType=void 0,this.interactedInside=!1,this.handler=void 0,this.blockMouseMove=!0,this.performedPointerEventsMutation=!1,this.unbindMouseMove=()=>{},this.restTimeoutPending=!1,this.openChangeTimeout=new qt,this.restTimeout=new qt,this.handleCloseOptions=void 0}static create(){return new dn}dispose=()=>{this.openChangeTimeout.clear(),this.restTimeout.clear()};disposeEffect=()=>this.dispose}function xr(e){const t=gt(dn.create).current,n=e.context.dataRef.current;return n.hoverInteractionState||(n.hoverInteractionState=t),Qr(n.hoverInteractionState.disposeEffect),n.hoverInteractionState}const oi=new Set(["click","mousedown"]);function si(e,t={}){const n="rootStore"in e?e.rootStore:e,r=n.useState("open"),s=n.useState("floatingElement"),o=n.useState("domReferenceElement"),{dataRef:a}=n.context,{enabled:i=!0,closeDelay:g=0}=t,l=xr(n),u=xt(),c=ht(),h=ue(()=>l.interactedInside?!0:a.current.openEvent?oi.has(a.current.openEvent.type):!1),y=ue(()=>{const C=a.current.openEvent?.type;return C?.includes("mouse")&&C!=="mousedown"}),x=ue(C=>Pt(C,n.context.triggerElements)),m=f.useCallback((C,R=!0)=>{const v=ii(g,l.pointerType);v&&!l.handler?l.openChangeTimeout.start(v,()=>n.setOpen(!1,xe(Fe,C))):R&&(l.openChangeTimeout.clear(),n.setOpen(!1,xe(Fe,C)))},[g,n,l]),b=ue(()=>{l.unbindMouseMove(),l.handler=void 0}),p=ue(()=>{if(l.performedPointerEventsMutation){const C=$e(s).body;C.style.pointerEvents="",C.removeAttribute(nn),l.performedPointerEventsMutation=!1}}),w=ue(C=>{const R=Ft(C);if(!ri(R)){l.interactedInside=!1;return}l.interactedInside=!0});le(()=>{r||(l.pointerType=void 0,l.restTimeoutPending=!1,l.interactedInside=!1,b(),p())},[r,l,b,p]),f.useEffect(()=>()=>{b()},[b]),f.useEffect(()=>p,[p]),le(()=>{if(i&&r&&l.handleCloseOptions?.blockPointerEvents&&y()&&be(o)&&s){l.performedPointerEventsMutation=!0;const C=$e(s).body;C.setAttribute(nn,"");const R=o,v=s,E=u?.nodesRef.current.find(S=>S.id===c)?.context?.elements.floating;return E&&(E.style.pointerEvents=""),C.style.pointerEvents="none",R.style.pointerEvents="auto",v.style.pointerEvents="auto",()=>{C.style.pointerEvents="",R.style.pointerEvents="",v.style.pointerEvents=""}}},[i,r,o,s,l,y,u,c]),f.useEffect(()=>{if(!i)return;function C(S){h()||!a.current.floatingContext||!n.select("open")||x(S.relatedTarget)||(p(),b(),h()||m(S))}function R(S){l.openChangeTimeout.clear(),p(),l.handler?.(S),b()}function v(S){h()||m(S,!1)}const E=s;return E&&(E.addEventListener("mouseleave",C),E.addEventListener("mouseenter",R),E.addEventListener("mouseleave",v),E.addEventListener("pointerdown",w,!0)),()=>{E&&(E.removeEventListener("mouseleave",C),E.removeEventListener("mouseenter",R),E.removeEventListener("mouseleave",v),E.removeEventListener("pointerdown",w,!0))}},[i,s,n,a,h,x,m,p,b,w,l])}function ii(e,t){return t&&!Tt(t)?0:typeof e=="function"?e():e}function Yt(e){return typeof e=="function"?e():e}const ai={current:null};function ci(e,t={}){const n="rootStore"in e?e.rootStore:e,{dataRef:r,events:s}=n.context,{enabled:o=!0,delay:a=0,handleClose:i=null,mouseOnly:g=!1,restMs:l=0,move:u=!0,triggerElementRef:c=ai,externalTree:h,isActiveTrigger:y=!0}=t,x=xt(h),m=xr(n),b=He(i),p=He(a),w=He(l),C=He(o);y&&(m.handleCloseOptions=b.current?.__options);const R=ue(()=>m.interactedInside?!0:r.current.openEvent?["click","mousedown"].includes(r.current.openEvent.type):!1),v=ue(P=>Pt(P,n.context.triggerElements)),E=f.useCallback((P,j=!0)=>{const N=zt(p.current,"close",m.pointerType);N&&!m.handler?m.openChangeTimeout.start(N,()=>n.setOpen(!1,xe(Fe,P))):j&&(m.openChangeTimeout.clear(),n.setOpen(!1,xe(Fe,P)))},[p,n,m]),S=ue(()=>{m.unbindMouseMove(),m.handler=void 0}),k=ue(()=>{if(m.performedPointerEventsMutation){const P=$e(n.select("domReferenceElement")).body;P.style.pointerEvents="",P.removeAttribute(nn),m.performedPointerEventsMutation=!1}});f.useEffect(()=>{if(!o)return;function P(j){j.open||(m.openChangeTimeout.clear(),m.restTimeout.clear(),m.blockMouseMove=!0,m.restTimeoutPending=!1)}return s.on("openchange",P),()=>{s.off("openchange",P)}},[o,s,m]);const U=ue(P=>{if(R()||!r.current.floatingContext||v(P.relatedTarget))return;const j=c.current;b.current?.({...r.current.floatingContext,tree:x,x:P.clientX,y:P.clientY,onClose(){k(),S(),!R()&&j===n.select("domReferenceElement")&&E(P)}})(P)});return f.useEffect(()=>{if(!o)return;const P=c.current??(y?n.select("domReferenceElement"):null);if(!be(P))return;function j(I){if(m.openChangeTimeout.clear(),m.blockMouseMove=!1,g&&!Tt(m.pointerType)||Yt(w.current)>0&&!zt(p.current,"open"))return;const L=zt(p.current,"open",m.pointerType),F=n.select("domReferenceElement"),M=n.context.triggerElements,T=(M.hasElement(I.target)||M.hasMatchingElement(ie=>Me(ie,I.target)))&&(!F||!Me(F,I.target)),D=I.currentTarget??null,_=n.select("open"),ne=!_||T;T&&_?n.setOpen(!0,xe(Fe,I,D)):L?m.openChangeTimeout.start(L,()=>{ne&&n.setOpen(!0,xe(Fe,I,D))}):ne&&n.setOpen(!0,xe(Fe,I,D))}function N(I){if(R()){k();return}m.unbindMouseMove();const L=n.select("domReferenceElement"),F=$e(L);if(m.restTimeout.clear(),m.restTimeoutPending=!1,v(I.relatedTarget))return;if(b.current&&r.current.floatingContext){n.select("open")||m.openChangeTimeout.clear();const T=c.current;m.handler=b.current({...r.current.floatingContext,tree:x,x:I.clientX,y:I.clientY,onClose(){k(),S(),C.current&&!R()&&T===n.select("domReferenceElement")&&E(I,!0)}});const D=m.handler;D(I),F.addEventListener("mousemove",D),m.unbindMouseMove=()=>{F.removeEventListener("mousemove",D)};return}(m.pointerType!=="touch"||!Me(n.select("floatingElement"),I.relatedTarget))&&E(I)}function O(I){U(I)}return n.select("open")&&P.addEventListener("mouseleave",O),u&&P.addEventListener("mousemove",j,{once:!0}),P.addEventListener("mouseenter",j),P.addEventListener("mouseleave",N),()=>{P.removeEventListener("mouseleave",O),u&&P.removeEventListener("mousemove",j),P.removeEventListener("mouseenter",j),P.removeEventListener("mouseleave",N)}},[S,k,r,p,E,n,o,b,U,m,y,R,v,g,u,w,c,x,C]),f.useMemo(()=>{if(!o)return;function P(j){m.pointerType=j.pointerType}return{onPointerDown:P,onPointerEnter:P,onMouseMove(j){const{nativeEvent:N}=j,O=j.currentTarget,I=n.select("domReferenceElement"),L=n.context.triggerElements,F=n.select("open"),M=(L.hasElement(j.target)||L.hasMatchingElement(D=>Me(D,j.target)))&&(!I||!Me(I,j.target));if(g&&!Tt(m.pointerType)||F&&!M||Yt(w.current)===0||!M&&m.restTimeoutPending&&j.movementX**2+j.movementY**2<2)return;m.restTimeout.clear();function T(){if(m.restTimeoutPending=!1,R())return;const D=n.select("open");!m.blockMouseMove&&(!D||M)&&n.setOpen(!0,xe(Fe,N,O))}m.pointerType==="touch"?kt.flushSync(()=>{T()}):M&&F?T():(m.restTimeoutPending=!0,m.restTimeout.start(Yt(w.current),T))}}},[o,m,R,g,n,w])}const li="Escape";function Bt(e,t,n){switch(e){case"vertical":return t;case"horizontal":return n;default:return t||n}}function Rt(e,t){return Bt(t,e===rn||e===pt,e===Xe||e===qe)}function Gt(e,t,n){return Bt(t,e===pt,n?e===Xe:e===qe)||e==="Enter"||e===" "||e===""}function ui(e,t,n){return Bt(t,n?e===Xe:e===qe,e===pt)}function fi(e,t,n,r){const s=n?e===qe:e===Xe,o=e===rn;return t==="both"||t==="horizontal"&&r&&r>1?e===li:Bt(t,s,o)}function di(e,t){const n="rootStore"in e?e.rootStore:e,r=n.useState("open"),s=n.useState("floatingElement"),o=n.useState("domReferenceElement"),a=n.context.dataRef,{listRef:i,activeIndex:g,onNavigate:l=()=>{},enabled:u=!0,selectedIndex:c=null,allowEscape:h=!1,loopFocus:y=!1,nested:x=!1,rtl:m=!1,virtual:b=!1,focusItemOnOpen:p="auto",focusItemOnHover:w=!0,openOnArrowKeyDown:C=!0,disabledIndices:R=void 0,orientation:v="vertical",parentOrientation:E,cols:S=1,id:k,resetOnPointerLeave:U=!0,externalTree:P}=t,j=eo(s),N=He(j),O=ht(),I=xt(P);le(()=>{a.current.orientation=v},[a,v]);const L=to(o),F=f.useRef(p),M=f.useRef(c??-1),T=f.useRef(null),D=f.useRef(!0),_=ue(A=>{l(M.current===-1?null:M.current,A)}),ne=f.useRef(_),ie=f.useRef(!!s),fe=f.useRef(r),V=f.useRef(!1),de=f.useRef(!1),K=He(R),G=He(r),re=He(c),pe=He(U),oe=ue(()=>{function A(ge){b?I?.events.emit("virtualfocus",ge):xn(ge,{sync:V.current,preventScroll:!0})}const $=i.current[M.current],B=de.current;$&&A($),(V.current?ge=>ge():requestAnimationFrame)(()=>{const ge=i.current[M.current]||$;if(!ge)return;$||A(ge),Q&&(B||!D.current)&&ge.scrollIntoView?.({block:"nearest",inline:"nearest"})})});le(()=>{u&&(r&&s?(M.current=c??-1,F.current&&c!=null&&(de.current=!0,_())):ie.current&&(M.current=-1,ne.current()))},[u,r,s,c,_]),le(()=>{if(u){if(!r){V.current=!1;return}if(s)if(g==null){if(V.current=!1,re.current!=null)return;if(ie.current&&(M.current=-1,oe()),(!fe.current||!ie.current)&&F.current&&(T.current!=null||F.current===!0&&T.current==null)){let A=0;const $=()=>{i.current[0]==null?(A<2&&(A?requestAnimationFrame:queueMicrotask)($),A+=1):(M.current=T.current==null||Gt(T.current,v,m)||x?Vt(i):An(i),T.current=null,_())};$()}}else ft(i,g)||(M.current=g,oe(),de.current=!1)}},[u,r,s,g,re,x,i,v,m,_,oe,K]),le(()=>{if(!u||s||!I||b||!ie.current)return;const A=I.nodesRef.current,$=A.find(ge=>ge.id===O)?.context?.elements.floating,B=Mt($e(s)),se=A.some(ge=>ge.context&&Me(ge.context.elements.floating,B));$&&!se&&D.current&&$.focus({preventScroll:!0})},[u,s,I,O,b]),le(()=>{ne.current=_,fe.current=r,ie.current=!!s}),le(()=>{r||(T.current=null,F.current=p)},[r,p]);const ae=g!=null,Q=f.useMemo(()=>{function A(B){if(!G.current)return;const se=i.current.indexOf(B.currentTarget);se!==-1&&M.current!==se&&(M.current=se,_(B))}return{onFocus(B){V.current=!0,A(B)},onClick:({currentTarget:B})=>B.focus({preventScroll:!0}),onMouseMove(B){V.current=!0,de.current=!1,w&&A(B)},onPointerLeave(B){if(!G.current||!D.current||B.pointerType==="touch")return;V.current=!0;const se=B.relatedTarget;!w||i.current.includes(se)||pe.current&&(xn(null,{sync:!0}),M.current=-1,_(B),b||N.current?.focus({preventScroll:!0}))}}},[G,N,w,i,_,pe,b]),Se=f.useCallback(()=>E??I?.nodesRef.current.find(A=>A.id===O)?.context?.dataRef?.current.orientation,[O,I,E]),ve=ue(A=>{if(D.current=!1,V.current=!0,A.which===229||!G.current&&A.currentTarget===N.current)return;if(x&&fi(A.key,v,m,S)){Rt(A.key,Se())||Ae(A),n.setOpen(!1,xe(Ct,A.nativeEvent)),Ue(o)&&(b?I?.events.emit("virtualfocus",o):o.focus());return}const $=M.current,B=Vt(i,R),se=An(i,R);if(L||(A.key==="Home"&&(Ae(A),M.current=B,_(A)),A.key==="End"&&(Ae(A),M.current=se,_(A))),S>1){const ge=Array.from({length:i.current.length},()=>({width:1,height:1})),he=ls(ge,S),je=he.findIndex(z=>z!=null&&!dt(i,z,R)),_e=he.reduce((z,Z,q)=>Z!=null&&!dt(i,Z,R)?q:z,-1),H=he[cs({current:he.map(z=>z!=null?i.current[z]:null)},{event:A,orientation:v,loopFocus:y,rtl:m,cols:S,disabledIndices:fs([...(typeof R!="function"?R:null)||i.current.map((z,Z)=>dt(i,Z,R)?Z:void 0),void 0],he),minIndex:je,maxIndex:_e,prevIndex:us(M.current>se?B:M.current,ge,he,S,A.key===pt?"bl":A.key===(m?Xe:qe)?"tr":"tl"),stopEvent:!0})];if(H!=null&&(M.current=H,_(A)),v==="both")return}if(Rt(A.key,v)){if(Ae(A),r&&!b&&Mt(A.currentTarget.ownerDocument)===A.currentTarget){M.current=Gt(A.key,v,m)?B:se,_(A);return}Gt(A.key,v,m)?y?$>=se?h&&$!==i.current.length?M.current=-1:(V.current=!1,M.current=B):M.current=Pe(i,{startingIndex:$,disabledIndices:R}):M.current=Math.min(se,Pe(i,{startingIndex:$,disabledIndices:R})):y?$<=B?h&&$!==-1?M.current=i.current.length:(V.current=!1,M.current=se):M.current=Pe(i,{startingIndex:$,decrement:!0,disabledIndices:R}):M.current=Math.max(B,Pe(i,{startingIndex:$,decrement:!0,disabledIndices:R})),ft(i,M.current)&&(M.current=-1),_(A)}}),we=f.useMemo(()=>b&&r&&ae&&{"aria-activedescendant":`${k}-${g}`},[b,r,ae,k,g]),me=f.useMemo(()=>({"aria-orientation":v==="both"?void 0:v,...L?{}:we,onKeyDown(A){if(A.key==="Tab"&&A.shiftKey&&r&&!b){const $=Ft(A.nativeEvent);if($&&!Me(N.current,$))return;Ae(A),n.setOpen(!1,xe(It,A.nativeEvent)),Ue(o)&&o.focus();return}ve(A)},onPointerMove(){D.current=!0}}),[we,ve,N,v,L,n,r,b,o]),X=f.useMemo(()=>{function A(B){p==="auto"&&no(B.nativeEvent)&&(F.current=!b)}function $(B){F.current=p,p==="auto"&&ro(B.nativeEvent)&&(F.current=!0)}return{onKeyDown(B){const se=n.select("open");D.current=!1;const ge=B.key.startsWith("Arrow"),he=ui(B.key,Se(),m),je=Rt(B.key,v),_e=(x?he:je)||B.key==="Enter"||B.key.trim()==="";if(b&&se)return ve(B);if(!(!se&&!C&&ge)){if(_e){const H=Rt(B.key,Se());T.current=x&&H?null:B.key}if(x){he&&(Ae(B),se?(M.current=Vt(i,K.current),_(B)):n.setOpen(!0,xe(Ct,B.nativeEvent,B.currentTarget)));return}je&&(re.current!=null&&(M.current=re.current),Ae(B),!se&&C?n.setOpen(!0,xe(Ct,B.nativeEvent,B.currentTarget)):ve(B),se&&_(B))}},onFocus(B){n.select("open")&&!b&&(M.current=-1,_(B))},onPointerDown:$,onPointerEnter:$,onMouseDown:A,onClick:A}},[ve,K,p,i,x,_,n,C,v,Se,m,re,b]),Y=f.useMemo(()=>({...we,...X}),[we,X]);return f.useMemo(()=>u?{reference:Y,floating:me,item:Q,trigger:X}:{},[u,Y,me,X,Q])}function mi(e,t){const n="rootStore"in e?e.rootStore:e,r=n.context.dataRef,s=n.useState("open"),{listRef:o,activeIndex:a,onMatch:i,onTypingChange:g,enabled:l=!0,resetMs:u=750,selectedIndex:c=null}=t,h=it(),y=f.useRef(""),x=f.useRef(c??a??-1),m=f.useRef(null);le(()=>{!s&&c!==null||(h.clear(),m.current=null,y.current!==""&&(y.current=""))},[s,c,h]),le(()=>{s&&y.current===""&&(x.current=c??a??-1)},[s,c,a]);const b=ue(v=>{v?r.current.typing||(r.current.typing=v,g?.(v)):r.current.typing&&(r.current.typing=v,g?.(v))}),p=ue(v=>{function E(N,O,I){const L=O.find(F=>F?.toLocaleLowerCase().indexOf(I.toLocaleLowerCase())===0);return L?N.indexOf(L):-1}const S=o.current;if(y.current.length>0&&y.current[0]!==" "&&(E(S,S,y.current)===-1?b(!1):v.key===" "&&Ae(v)),S==null||v.key.length!==1||v.ctrlKey||v.metaKey||v.altKey)return;s&&v.key!==" "&&(Ae(v),b(!0));const k=y.current==="";k&&(x.current=c??a??-1),S.every(N=>N?N[0]?.toLocaleLowerCase()!==N[1]?.toLocaleLowerCase():!0)&&y.current===v.key&&(y.current="",x.current=m.current),y.current+=v.key,h.start(u,()=>{y.current="",x.current=m.current,b(!1)});const P=k?c??a??-1:x.current,j=E(S,[...S.slice((P||0)+1),...S.slice(0,(P||0)+1)],y.current);j!==-1?(i?.(j),m.current=j):v.key!==" "&&(y.current="",b(!1))}),w=ue(v=>{const E=v.relatedTarget,S=n.select("domReferenceElement"),k=n.select("floatingElement"),U=Me(S,E),P=Me(k,E);U||P||(h.clear(),y.current="",x.current=m.current,b(!1))}),C=f.useMemo(()=>({onKeyDown:p,onBlur:w}),[p,w]),R=f.useMemo(()=>({onKeyDown:p,onKeyUp(v){v.key===" "&&b(!1)},onBlur:w}),[p,w,b]);return f.useMemo(()=>l?{reference:C,floating:R}:{},[l,C,R])}function _n(e,t){const[n,r]=e;let s=!1;const o=t.length;for(let a=0,i=o-1;a<o;i=a++){const[g,l]=t[a]||[0,0],[u,c]=t[i]||[0,0];l>=r!=c>=r&&n<=(u-g)*(r-l)/(c-l)+g&&(s=!s)}return s}function gi(e,t){return e[0]>=t.x&&e[0]<=t.x+t.width&&e[1]>=t.y&&e[1]<=t.y+t.height}function pi(e={}){const{buffer:t=.5,blockPointerEvents:n=!1,requireIntent:r=!0}=e,s=new qt;let o=!1,a=null,i=null,g=typeof performance<"u"?performance.now():0;function l(c,h){const y=performance.now(),x=y-g;if(a===null||i===null||x===0)return a=c,i=h,g=y,null;const m=c-a,b=h-i,w=Math.sqrt(m*m+b*b)/x;return a=c,i=h,g=y,w}const u=({x:c,y:h,placement:y,elements:x,onClose:m,nodeId:b,tree:p})=>function(C){function R(){s.clear(),m()}if(s.clear(),!x.domReference||!x.floating||y==null||c==null||h==null)return;const{clientX:v,clientY:E}=C,S=[v,E],k=Ft(C),U=C.type==="mouseleave",P=Me(x.floating,k),j=Me(x.domReference,k),N=x.domReference.getBoundingClientRect(),O=x.floating.getBoundingClientRect(),I=y.split("-")[0],L=c>O.right-O.width/2,F=h>O.bottom-O.height/2,M=gi(S,N),T=O.width>N.width,D=O.height>N.height,_=(T?N:O).left,ne=(T?N:O).right,ie=(D?N:O).top,fe=(D?N:O).bottom;if(P&&(o=!0,!U))return;if(j&&(o=!1),j&&!U){o=!0;return}if(U&&be(C.relatedTarget)&&Me(x.floating,C.relatedTarget)||p&&oo(p.nodesRef.current,b).some(({context:K})=>K?.open))return;if(I==="top"&&h>=N.bottom-1||I==="bottom"&&h<=N.top+1||I==="left"&&c>=N.right-1||I==="right"&&c<=N.left+1)return R();let V=[];switch(I){case"top":V=[[_,N.top+1],[_,O.bottom-1],[ne,O.bottom-1],[ne,N.top+1]];break;case"bottom":V=[[_,O.top+1],[_,N.bottom-1],[ne,N.bottom-1],[ne,O.top+1]];break;case"left":V=[[O.right-1,fe],[O.right-1,ie],[N.left+1,ie],[N.left+1,fe]];break;case"right":V=[[N.right-1,fe],[N.right-1,ie],[O.left+1,ie],[O.left+1,fe]];break}function de([K,G]){switch(I){case"top":{const re=[T?K+t/2:L?K+t*4:K-t*4,G+t+1],pe=[T?K-t/2:L?K+t*4:K-t*4,G+t+1],oe=[[O.left,L||T?O.bottom-t:O.top],[O.right,L?T?O.bottom-t:O.top:O.bottom-t]];return[re,pe,...oe]}case"bottom":{const re=[T?K+t/2:L?K+t*4:K-t*4,G-t],pe=[T?K-t/2:L?K+t*4:K-t*4,G-t],oe=[[O.left,L||T?O.top+t:O.bottom],[O.right,L?T?O.top+t:O.bottom:O.top+t]];return[re,pe,...oe]}case"left":{const re=[K+t+1,D?G+t/2:F?G+t*4:G-t*4],pe=[K+t+1,D?G-t/2:F?G+t*4:G-t*4];return[...[[F||D?O.right-t:O.left,O.top],[F?D?O.right-t:O.left:O.right-t,O.bottom]],re,pe]}case"right":{const re=[K-t,D?G+t/2:F?G+t*4:G-t*4],pe=[K-t,D?G-t/2:F?G+t*4:G-t*4],oe=[[F||D?O.left+t:O.right,O.top],[F?D?O.left+t:O.right:O.left+t,O.bottom]];return[re,pe,...oe]}default:return[]}}if(!_n([v,E],V)){if(o&&!M)return R();if(!U&&r){const K=l(C.clientX,C.clientY);if(K!==null&&K<.1)return R()}_n([v,E],de([c,h]))?!o&&r&&s.start(40,R):R()}};return u.__options={blockPointerEvents:n},u}const yr=f.createContext(void 0);function br(e){const t=f.useContext(yr);if(t===void 0&&!e)throw new Error(yt(33));return t}const vr=f.createContext(void 0);function et(e){const t=f.useContext(vr);if(t===void 0&&!e)throw new Error(yt(36));return t}const hi=f.createContext(void 0);function Ut(e=!0){const t=f.useContext(hi);if(t===void 0&&!e)throw new Error(yt(25));return t}function xi(e){const{closeOnClick:t,highlighted:n,id:r,nodeId:s,store:o,itemRef:a,itemMetadata:i}=e,{events:g}=o.useState("floatingTreeRoot"),l=Ut(!0),u=l!==void 0;return f.useMemo(()=>({id:r,role:"menuitem",tabIndex:n?0:-1,onMouseMove(c){s&&g.emit("itemhover",{nodeId:s,target:c.currentTarget})},onClick(c){t&&g.emit("close",{domEvent:c,reason:Zn})},onMouseUp(c){if(l){const h=l.initialCursorPointRef.current;if(l.initialCursorPointRef.current=null,u&&h&&Math.abs(c.clientX-h.x)<=1&&Math.abs(c.clientY-h.y)<=1)return}a.current&&o.context.allowMouseUpTriggerRef.current&&(!u||c.button===2)&&(!i||i.type==="regular-item")&&a.current.click()}}),[t,n,r,g,s,o,a,l,u,i])}const yi={type:"regular-item"};function bi(e){const{closeOnClick:t,disabled:n=!1,highlighted:r,id:s,store:o,nativeButton:a,itemMetadata:i,nodeId:g}=e,l=f.useRef(null),{getButtonProps:u,buttonRef:c}=er({disabled:n,focusableWhenDisabled:!0,native:a}),h=xi({closeOnClick:t,highlighted:r,id:s,nodeId:g,store:o,itemRef:l,itemMetadata:i}),y=f.useCallback(m=>Jt(h,{onMouseEnter(){i.type==="submenu-trigger"&&i.setActive()},onKeyUp(b){b.key===" "&&o.context.typingRef.current&&b.preventBaseUIHandler()}},m,u),[h,u,o,i]),x=tr(l,c);return f.useMemo(()=>({getItemProps:y,itemRef:x}),[y,x])}const wr=f.createContext({register:()=>{},unregister:()=>{},subscribeMapChange:()=>()=>{},elementsRef:{current:[]},nextIndexRef:{current:0}});function vi(){return f.useContext(wr)}let wi=(function(e){return e[e.None=0]="None",e[e.GuessFromOrder=1]="GuessFromOrder",e})({});function Rr(e={}){const{label:t,metadata:n,textRef:r,indexGuessBehavior:s,index:o}=e,{register:a,unregister:i,subscribeMapChange:g,elementsRef:l,labelsRef:u,nextIndexRef:c}=vi(),h=f.useRef(-1),[y,x]=f.useState(o??(s===wi.GuessFromOrder?()=>{if(h.current===-1){const p=c.current;c.current+=1,h.current=p}return h.current}:-1)),m=f.useRef(null),b=f.useCallback(p=>{if(m.current=p,y!==-1&&p!==null&&(l.current[y]=p,u)){const w=t!==void 0;u.current[y]=w?t:r?.current?.textContent??p.textContent}},[y,l,u,t,r]);return le(()=>{if(o!=null)return;const p=m.current;if(p)return a(p,n),()=>{i(p)}},[o,a,i,n]),le(()=>{if(o==null)return g(p=>{const w=m.current?p.get(m.current)?.index:null;w!=null&&x(w)})},[o,g,x]),f.useMemo(()=>({ref:b,index:y}),[y,b])}const Ri=f.forwardRef(function(t,n){const{render:r,className:s,id:o,label:a,nativeButton:i=!1,disabled:g=!1,closeOnClick:l=!0,...u}=t,c=Rr({label:a}),h=br(!0),y=nr(o),{store:x}=et(),m=x.useState("isActive",c.index),b=x.useState("itemProps"),{getItemProps:p,itemRef:w}=bi({closeOnClick:l,disabled:g,highlighted:m,id:y,store:x,nativeButton:i,nodeId:h?.nodeId,itemMetadata:yi});return bt("div",t,{state:{disabled:g,highlighted:m},props:[b,u,p],ref:[w,n,c.ref]})}),Ei=f.createContext(void 0);function Ci(e){return f.useContext(Ei)}function Er(e){return e==="starting"?so:vt}const Si={...rr,...lo},Oi=f.forwardRef(function(t,n){const{render:r,className:s,finalFocus:o,...a}=t,{store:i}=et(),{side:g,align:l}=br(),u=Ci()!=null,c=i.useState("open"),h=i.useState("transitionStatus"),y=i.useState("popupProps"),x=i.useState("mounted"),m=i.useState("instantType"),b=i.useState("activeTriggerElement"),p=i.useState("parent"),w=i.useState("lastOpenChangeReason"),C=i.useState("rootId"),R=i.useState("floatingRootContext"),v=i.useState("floatingTreeRoot"),E=i.useState("closeDelay"),S=i.useState("activeTriggerElement"),k=p.type==="context-menu";io({open:c,ref:i.context.popupRef,onComplete(){c&&i.context.onOpenChangeComplete?.(!0)}}),f.useEffect(()=>{function I(L){i.setOpen(!1,xe(L.reason,L.domEvent))}return v.events.on("close",I),()=>{v.events.off("close",I)}},[v.events,i]);const U=i.useState("hoverEnabled"),P=i.useState("disabled");si(R,{enabled:U&&!P&&!k&&p.type!=="menubar",closeDelay:E});const j={transitionStatus:h,side:g,align:l,open:c,nested:p.type==="menu",instant:m},N=bt("div",t,{state:j,ref:[n,i.context.popupRef],stateAttributesMapping:Si,props:[y,{onKeyDown(I){u&&uo.has(I.key)&&I.stopPropagation()}},Er(h),a,{"data-rootownerid":C}]});let O=p.type===void 0||k;return(b||p.type==="menubar"&&w!==ao)&&(O=!0),d.jsx(co,{context:R,modal:k,disabled:!x,returnFocus:o===void 0?O:o,initialFocus:p.type!=="menu",restoreFocus:!0,externalTree:p.type!=="menubar"?v:void 0,previousFocusableElement:S,nextFocusableElement:p.type===void 0?i.context.triggerFocusTargetRef:void 0,beforeContentFocusGuardRef:p.type===void 0?i.context.beforeContentFocusGuardRef:void 0,children:N})}),Cr=f.createContext(void 0);function Ti(){const e=f.useContext(Cr);if(e===void 0)throw new Error(yt(32));return e}const Mi=f.forwardRef(function(t,n){const{keepMounted:r=!1,...s}=t,{store:o}=et();return o.useState("mounted")||r?d.jsx(Cr.Provider,{value:r,children:d.jsx(fo,{ref:n,...s})}):null}),Pi=f.createContext(void 0);function Sr(){return f.useContext(Pi)?.direction??"ltr"}const Ii=e=>({name:"arrow",options:e,async fn(t){const{x:n,y:r,placement:s,rects:o,platform:a,elements:i,middlewareData:g}=t,{element:l,padding:u=0,offsetParent:c="real"}=Ye(e,t)||{};if(l==null)return{};const h=cr(u),y={x:n,y:r},x=un(s),m=ln(x),b=await a.getDimensions(l),p=x==="y",w=p?"top":"left",C=p?"bottom":"right",R=p?"clientHeight":"clientWidth",v=o.reference[m]+o.reference[x]-y[x]-o.floating[m],E=y[x]-o.reference[x],S=c==="real"?await a.getOffsetParent?.(l):i.floating;let k=i.floating[R]||o.floating[m];(!k||!await a.isElement?.(S))&&(k=i.floating[R]||o.floating[m]);const U=v/2-E/2,P=k/2-b[m]/2-1,j=Math.min(h[w],P),N=Math.min(h[C],P),O=j,I=k-b[m]-N,L=k/2-b[m]/2+U,F=en(O,L,I),M=!g.arrow&&Qe(s)!=null&&L!==F&&o.reference[m]/2-(L<O?j:N)-b[m]/2<0,T=M?L<O?L-O:L-I:0;return{[x]:y[x]+T,data:{[x]:F,centerOffset:L-F-T,...M&&{alignmentOffset:T}},reset:M}}}),ki=(e,t)=>({...Ii(e),options:[e,t]}),Ai={name:"hide",async fn(e){const{width:t,height:n,x:r,y:s}=e.rects.reference,o=t===0&&n===0&&r===0&&s===0;return{data:{referenceHidden:(await Qs().fn(e)).data?.referenceHidden||o}}}},Ni={sideX:"left",sideY:"top"};function Or(e,t,n){const r=e==="inline-start"||e==="inline-end";return{top:"top",right:r?n?"inline-start":"inline-end":"right",bottom:"bottom",left:r?n?"inline-end":"inline-start":"left"}[t]}function Vn(e,t,n){const{rects:r,placement:s}=e;return{side:Or(t,Le(s),n),align:Qe(s)||"center",anchor:{width:r.reference.width,height:r.reference.height},positioner:{width:r.floating.width,height:r.floating.height}}}function ji(e){const{anchor:t,positionMethod:n="absolute",side:r="bottom",sideOffset:s=0,align:o="center",alignOffset:a=0,collisionBoundary:i,collisionPadding:g=5,sticky:l=!1,arrowPadding:u=5,disableAnchorTracking:c=!1,keepMounted:h=!1,floatingRootContext:y,mounted:x,collisionAvoidance:m,shiftCrossAxis:b=!1,nodeId:p,adaptiveOrigin:w,lazyFlip:C=!1,externalTree:R}=e,[v,E]=f.useState(null);!x&&v!==null&&E(null);const S=m.side||"flip",k=m.align||"flip",U=m.fallbackAxisSide||"end",P=typeof t=="function"?t:void 0,j=ue(P),N=P?j:t,O=He(t),L=Sr()==="rtl",F=v||{top:"top",right:"right",bottom:"bottom",left:"left","inline-end":L?"left":"right","inline-start":L?"right":"left"}[r],M=o==="center"?F:`${F}-${o}`;let T=g;const D=1,_=r==="bottom"?D:0,ne=r==="top"?D:0,ie=r==="right"?D:0,fe=r==="left"?D:0;typeof T=="number"?T={top:T+_,right:T+fe,bottom:T+ne,left:T+ie}:T&&(T={top:(T.top||0)+_,right:(T.right||0)+fe,bottom:(T.bottom||0)+ne,left:(T.left||0)+ie});const V={boundary:i==="clipping-ancestors"?"clippingAncestors":i,padding:T},de=f.useRef(null),K=He(s),G=He(a),oe=[Ys(ce=>{const Ee=Vn(ce,r,L),ke=typeof K.current=="function"?K.current(Ee):K.current,Oe=typeof G.current=="function"?G.current(Ee):G.current;return{mainAxis:ke,crossAxis:Oe,alignmentAxis:Oe}},[typeof s!="function"?s:0,typeof a!="function"?a:0,L,r])],ae=k==="none"&&S!=="shift",Q=!ae&&(l||b||S==="shift"),Se=S==="none"?null:qs({...V,padding:{top:T.top+D,right:T.right+D,bottom:T.bottom+D,left:T.left+D},mainAxis:!b&&S==="flip",crossAxis:k==="flip"?"alignment":!1,fallbackAxisSideDirection:U}),ve=ae?null:Gs(ce=>{const Ee=$e(ce.elements.floating).documentElement;return{...V,rootBoundary:b?{x:0,y:0,width:Ee.clientWidth,height:Ee.clientHeight}:void 0,mainAxis:k!=="none",crossAxis:Q,limiter:l||b?void 0:Xs(ke=>{if(!de.current)return{};const{width:Oe,height:te}=de.current.getBoundingClientRect(),Ne=Be(Le(ke.placement)),Ve=Ne==="y"?Oe:te,ct=Ne==="y"?T.left+T.right:T.top+T.bottom;return{offset:Ve/2+ct/2}})}},[V,l,b,T,k]);S==="shift"||k==="shift"||o==="center"?oe.push(ve,Se):oe.push(Se,ve),oe.push(Js({...V,apply({elements:{floating:ce},rects:{reference:Ee},availableWidth:ke,availableHeight:Oe}){const te=ce.style;te.setProperty("--available-width",`${ke}px`),te.setProperty("--available-height",`${Oe}px`),te.setProperty("--anchor-width",`${Ee.width}px`),te.setProperty("--anchor-height",`${Ee.height}px`)}}),ki(()=>({element:de.current||document.createElement("div"),padding:u,offsetParent:"floating"}),[u]),{name:"transformOrigin",fn(ce){const{elements:Ee,middlewareData:ke,placement:Oe,rects:te,y:Ne}=ce,Ve=Le(Oe),ct=Be(Ve),gn=de.current,Pr=ke.arrow?.x||0,Ir=ke.arrow?.y||0,kr=gn?.clientWidth||0,Ar=gn?.clientHeight||0,_t=Pr+kr/2,pn=Ir+Ar/2,Nr=Math.abs(ke.shift?.y||0),jr=te.reference.height/2,lt=typeof s=="function"?s(Vn(ce,r,L)):s,Dr=Nr>lt,Lr={top:`${_t}px calc(100% + ${lt}px)`,bottom:`${_t}px ${-lt}px`,left:`calc(100% + ${lt}px) ${pn}px`,right:`${-lt}px ${pn}px`}[Ve],Fr=`${_t}px ${te.reference.y+jr-Ne}px`;return Ee.floating.style.setProperty("--transform-origin",Q&&ct==="y"&&Dr?Fr:Lr),{}}},Ai,w),le(()=>{!x&&y&&y.update({referenceElement:null,floatingElement:null,domReferenceElement:null})},[x,y]);const we=f.useMemo(()=>({elementResize:!c&&typeof ResizeObserver<"u",layoutShift:!c&&typeof IntersectionObserver<"u"}),[c]),{refs:me,elements:X,x:Y,y:A,middlewareData:$,update:B,placement:se,context:ge,isPositioned:he,floatingStyles:je}=ei({rootContext:y,placement:M,middleware:oe,strategy:n,whileElementsMounted:h?void 0:(...ce)=>Bn(...ce,we),nodeId:p,externalTree:R}),{sideX:_e,sideY:H}=$.adaptiveOrigin||Ni,z=he?n:"fixed",Z=f.useMemo(()=>{const ce=w?{position:z,[_e]:Y,[H]:A}:{position:z,...je};return he||(ce.opacity=0),ce},[w,z,_e,Y,H,A,je,he]),q=f.useRef(null);le(()=>{if(!x)return;const ce=O.current,Ee=typeof ce=="function"?ce():ce,Oe=(zn(Ee)?Ee.current:Ee)||null||null;Oe!==q.current&&(me.setPositionReference(Oe),q.current=Oe)},[x,me,N,O]),f.useEffect(()=>{if(!x)return;const ce=O.current;typeof ce!="function"&&zn(ce)&&ce.current!==q.current&&(me.setPositionReference(ce.current),q.current=ce.current)},[x,me,N,O]),f.useEffect(()=>{if(h&&x&&X.domReference&&X.floating)return Bn(X.domReference,X.floating,B,we)},[h,x,X,B,we]);const ee=Le(se),Re=Or(r,ee,L),Ie=Qe(se)||"center",W=!!$.hide?.referenceHidden;le(()=>{C&&x&&he&&E(ee)},[C,x,he,ee]);const J=f.useMemo(()=>({position:"absolute",top:$.arrow?.y,left:$.arrow?.x}),[$.arrow]),ye=$.arrow?.centerOffset!==0;return f.useMemo(()=>({positionerStyles:Z,arrowStyles:J,arrowRef:de,arrowUncentered:ye,side:Re,align:Ie,physicalSide:ee,anchorHidden:W,refs:me,context:ge,isPositioned:he,update:B}),[Z,J,de,ye,Re,Ie,ee,W,me,ge,he,B])}function zn(e){return e!=null&&"current"in e}function Di(e){const{children:t,elementsRef:n,labelsRef:r,onMapChange:s}=e,o=ue(s),a=f.useRef(0),i=gt(Fi).current,g=gt(Li).current,[l,u]=f.useState(0),c=f.useRef(l),h=ue((p,w)=>{g.set(p,w??null),c.current+=1,u(c.current)}),y=ue(p=>{g.delete(p),c.current+=1,u(c.current)}),x=f.useMemo(()=>{const p=new Map;return Array.from(g.keys()).filter(C=>C.isConnected).sort(Hi).forEach((C,R)=>{const v=g.get(C)??{};p.set(C,{...v,index:R})}),p},[g,l]);le(()=>{if(typeof MutationObserver!="function"||x.size===0)return;const p=new MutationObserver(w=>{const C=new Set,R=v=>C.has(v)?C.delete(v):C.add(v);w.forEach(v=>{v.removedNodes.forEach(R),v.addedNodes.forEach(R)}),C.size===0&&(c.current+=1,u(c.current))});return x.forEach((w,C)=>{C.parentElement&&p.observe(C.parentElement,{childList:!0})}),()=>{p.disconnect()}},[x]),le(()=>{c.current===l&&(n.current.length!==x.size&&(n.current.length=x.size),r&&r.current.length!==x.size&&(r.current.length=x.size),a.current=x.size),o(x)},[o,x,n,r,l]),le(()=>()=>{n.current=[]},[n]),le(()=>()=>{r&&(r.current=[])},[r]);const m=ue(p=>(i.add(p),()=>{i.delete(p)}));le(()=>{i.forEach(p=>p(x))},[i,x]);const b=f.useMemo(()=>({register:h,unregister:y,subscribeMapChange:m,elementsRef:n,labelsRef:r,nextIndexRef:a}),[h,y,m,n,r,a]);return d.jsx(wr.Provider,{value:b,children:t})}function Li(){return new Map}function Fi(){return new Set}function Hi(e,t){const n=e.compareDocumentPosition(t);return n&Node.DOCUMENT_POSITION_FOLLOWING||n&Node.DOCUMENT_POSITION_CONTAINED_BY?-1:n&Node.DOCUMENT_POSITION_PRECEDING||n&Node.DOCUMENT_POSITION_CONTAINS?1:0}const Bi=f.forwardRef(function(t,n){const{anchor:r,positionMethod:s="absolute",className:o,render:a,side:i,align:g,sideOffset:l=0,alignOffset:u=0,collisionBoundary:c="clipping-ancestors",collisionPadding:h=5,arrowPadding:y=5,sticky:x=!1,disableAnchorTracking:m=!1,collisionAvoidance:b=mo,...p}=t,{store:w}=et(),C=Ti(),R=Ut(!0),v=w.useState("parent"),E=w.useState("floatingRootContext"),S=w.useState("floatingTreeRoot"),k=w.useState("mounted"),U=w.useState("open"),P=w.useState("modal"),j=w.useState("activeTriggerElement"),N=w.useState("transitionStatus"),O=w.useState("lastOpenChangeReason"),I=w.useState("floatingNodeId"),L=w.useState("floatingParentNodeId");let F=r,M=l,T=u,D=g,_=b;v.type==="context-menu"&&(F=r??v.context?.anchor,D=D??"start",!i&&D!=="center"&&(T=t.alignOffset??2,M=t.sideOffset??-5));let ne=i,ie=D;v.type==="menu"?(ne=ne??"inline-end",ie=ie??"start",_=t.collisionAvoidance??go):v.type==="menubar"&&(ne=ne??"bottom",ie=ie??"start");const fe=v.type==="context-menu",V=ji({anchor:F,floatingRootContext:E,positionMethod:R?"fixed":s,mounted:k,side:ne,sideOffset:M,align:ie,alignOffset:T,arrowPadding:fe?0:y,collisionBoundary:c,collisionPadding:h,sticky:x,nodeId:I,keepMounted:C,disableAnchorTracking:m,collisionAvoidance:_,shiftCrossAxis:fe&&!("side"in _&&_.side==="flip"),externalTree:S}),de=f.useMemo(()=>{const ae={};return U||(ae.pointerEvents="none"),{role:"presentation",hidden:!k,style:{...V.positionerStyles,...ae}}},[U,k,V.positionerStyles]);f.useEffect(()=>{function ae(Q){Q.open&&(Q.parentNodeId===I&&w.set("hoverEnabled",!1),Q.nodeId!==I&&Q.parentNodeId===w.select("floatingParentNodeId")&&w.setOpen(!1,xe(St)))}return S.events.on("menuopenchange",ae),()=>{S.events.off("menuopenchange",ae)}},[w,S.events,I]),f.useEffect(()=>{if(w.select("floatingParentNodeId")==null)return;function ae(Q){if(Q.open||Q.nodeId!==w.select("floatingParentNodeId"))return;const Se=Q.reason??St;w.setOpen(!1,xe(Se))}return S.events.on("menuopenchange",ae),()=>{S.events.off("menuopenchange",ae)}},[S.events,w]),f.useEffect(()=>{function ae(Q){!U||Q.nodeId!==w.select("floatingParentNodeId")||Q.target&&j&&j!==Q.target&&w.setOpen(!1,xe(St))}return S.events.on("itemhover",ae),()=>{S.events.off("itemhover",ae)}},[S.events,U,j,w]),f.useEffect(()=>{const ae={open:U,nodeId:I,parentNodeId:L,reason:w.select("lastOpenChangeReason")};S.events.emit("menuopenchange",ae)},[S.events,U,w,I,L]);const K={open:U,side:V.side,align:V.align,anchorHidden:V.anchorHidden,nested:v.type==="menu"},G=f.useMemo(()=>({side:V.side,align:V.align,arrowRef:V.arrowRef,arrowUncentered:V.arrowUncentered,arrowStyles:V.arrowStyles,nodeId:V.context.nodeId}),[V.side,V.align,V.arrowRef,V.arrowUncentered,V.arrowStyles,V.context.nodeId]),re=bt("div",t,{state:K,stateAttributesMapping:rr,ref:[n,w.useStateSetter("positionerElement")],props:[de,Er(N),p]}),pe=k&&v.type!=="menu"&&(v.type!=="menubar"&&P&&O!==Fe||v.type==="menubar"&&v.context.modal);let oe=null;return v.type==="menubar"?oe=v.context.contentElement:v.type===void 0&&(oe=j),d.jsxs(yr.Provider,{value:G,children:[pe&&d.jsx(po,{ref:v.type==="context-menu"||v.type==="nested-context-menu"?v.context.internalBackdropRef:null,inert:ho(!U),cutout:oe}),d.jsx(xo,{id:I,children:d.jsx(Di,{elementsRef:w.context.itemDomElements,labelsRef:w.context.itemLabels,children:re})})]})}),Ui=f.createContext(null);function Tr(e){return f.useContext(Ui)}const _i={...bo,disabled:Te(e=>e.parent.type==="menubar"&&e.parent.context.disabled||e.disabled),modal:Te(e=>(e.parent.type===void 0||e.parent.type==="context-menu")&&(e.modal??!0)),allowMouseEnter:Te(e=>e.allowMouseEnter),stickIfOpen:Te(e=>e.stickIfOpen),parent:Te(e=>e.parent),rootId:Te(e=>e.parent.type==="menu"?e.parent.store.select("rootId"):e.parent.type!==void 0?e.parent.context.rootId:e.rootId),activeIndex:Te(e=>e.activeIndex),isActive:Te((e,t)=>e.activeIndex===t),hoverEnabled:Te(e=>e.hoverEnabled),instantType:Te(e=>e.instantType),lastOpenChangeReason:Te(e=>e.openChangeReason),floatingTreeRoot:Te(e=>e.parent.type==="menu"?e.parent.store.select("floatingTreeRoot"):e.floatingTreeRoot),floatingNodeId:Te(e=>e.floatingNodeId),floatingParentNodeId:Te(e=>e.floatingParentNodeId),itemProps:Te(e=>e.itemProps),closeDelay:Te(e=>e.closeDelay),keyboardEventRelay:Te(e=>{if(e.keyboardEventRelay)return e.keyboardEventRelay;if(e.parent.type==="menu")return e.parent.store.select("keyboardEventRelay")})};class mn extends yo{constructor(t){super({...Vi(),...t},{positionerRef:f.createRef(),popupRef:f.createRef(),typingRef:{current:!1},itemDomElements:{current:[]},itemLabels:{current:[]},allowMouseUpTriggerRef:{current:!1},triggerFocusTargetRef:f.createRef(),beforeContentFocusGuardRef:f.createRef(),onOpenChangeComplete:void 0,triggerElements:new Xn},_i),this.unsubscribeParentListener=this.observe("parent",n=>{if(this.unsubscribeParentListener?.(),n.type==="menu"){this.unsubscribeParentListener=n.store.subscribe(()=>{this.notifyAll()}),this.context.allowMouseUpTriggerRef=n.store.context.allowMouseUpTriggerRef;return}n.type!==void 0&&(this.context.allowMouseUpTriggerRef=n.context.allowMouseUpTriggerRef),this.unsubscribeParentListener=null})}setOpen(t,n){this.state.floatingRootContext.context.events.emit("setOpen",{open:t,eventDetails:n})}static useStore(t,n){const r=gt(()=>new mn(n)).current;return t??r}unsubscribeParentListener=null}function Vi(){return{...vo(),disabled:!1,modal:!0,allowMouseEnter:!1,stickIfOpen:!0,parent:{type:void 0},rootId:void 0,activeIndex:null,hoverEnabled:!0,instantType:void 0,openChangeReason:null,floatingTreeRoot:new or,floatingNodeId:void 0,floatingParentNodeId:null,itemProps:vt,keyboardEventRelay:void 0,closeDelay:0}}const zi=f.createContext(void 0);function $i(){return f.useContext(zi)}const Wi=wo(function(t){const{children:n,open:r,onOpenChange:s,onOpenChangeComplete:o,defaultOpen:a=!1,disabled:i=!1,modal:g,loopFocus:l=!0,orientation:u="vertical",actionsRef:c,closeParentOnEsc:h=!1,handle:y,triggerId:x,defaultTriggerId:m=null,highlightItemOnHover:b=!0}=t,p=Ut(!0),w=et(!0),C=Tr(!0),R=$i(),v=f.useMemo(()=>R&&w?{type:"menu",store:w.store}:C?{type:"menubar",context:C}:p&&!w?{type:"context-menu",context:p}:{type:void 0},[p,w,C,R]),E=mn.useStore(y?.store,{open:a,openProp:r,activeTriggerId:m,triggerIdProp:x,parent:v});Ro(()=>{r===void 0&&E.state.open===!1&&a===!0&&E.update({open:!0,activeTriggerId:m})}),E.useControlledProp("openProp",r),E.useControlledProp("triggerIdProp",x),E.useContextCallback("onOpenChangeComplete",o);const S=E.useState("floatingTreeRoot"),k=sr(S),U=ht();le(()=>{p&&!w?E.update({parent:{type:"context-menu",context:p},floatingNodeId:k,floatingParentNodeId:U}):w&&E.update({floatingNodeId:k,floatingParentNodeId:U})},[p,w,k,U,E]);const P=E.useState("open"),j=E.useState("activeTriggerElement"),N=E.useState("positionerElement"),O=E.useState("hoverEnabled"),I=E.useState("modal"),L=E.useState("disabled"),F=E.useState("lastOpenChangeReason"),M=E.useState("parent"),T=E.useState("activeIndex"),D=E.useState("payload"),_=E.useState("floatingParentNodeId"),ne=f.useRef(null),ie=_!=null;let fe;E.useSyncedValues({disabled:i,modal:M.type===void 0?g:void 0,rootId:Gn()});const{openMethod:V,triggerProps:de,reset:K}=Eo(P);Co(E);const{forceUnmount:G}=So(P,E,()=>{E.update({allowMouseEnter:!1,stickIfOpen:!0}),K()}),re=f.useRef(M.type!=="context-menu"),pe=it();f.useEffect(()=>{if(P||(ne.current=null),M.type==="context-menu"){if(!P){pe.clear(),re.current=!1;return}pe.start(500,()=>{re.current=!0})}},[pe,P,M.type]),Oo(P&&I&&F!==Fe&&V!=="touch",N),le(()=>{!P&&!O&&E.set("hoverEnabled",!0)},[P,O,E]);const oe=f.useRef(!0),ae=it(),Q=ue((W,J)=>{const ye=J.reason;if(P===W&&J.trigger===j&&F===ye||(J.preventUnmountOnClose=()=>{E.set("preventUnmountingOnClose",!0)},!W&&J.trigger==null&&(J.trigger=j??void 0),s?.(W,J),J.isCanceled))return;const ce={open:W,nativeEvent:J.event,reason:J.reason,nested:ie};fe?.emit("openchange",ce);const Ee=J.event;if(W===!1&&Ee?.type==="click"&&Ee.pointerType==="touch"&&!oe.current)return;if(!W&&T!==null){const Ve=E.context.itemDomElements.current[T];queueMicrotask(()=>{Ve?.setAttribute("tabindex","-1")})}W&&ye===ut?(oe.current=!1,ae.start(300,()=>{oe.current=!0})):(oe.current=!0,ae.clear());const ke=(ye===Jn||ye===Zn)&&Ee.detail===0&&Ee?.isTrusted,Oe=!W&&(ye===Qn||ye==null),te={open:W,openChangeReason:ye};ne.current=J.event??null;const Ne=J.trigger?.id??null;(Ne||W)&&(te.activeTriggerId=Ne,te.activeTriggerElement=J.trigger??null),E.update(te),M.type==="menubar"&&(ye===ut||ye===It||ye===Fe||ye===Ct||ye===St)?E.set("instantType","group"):ke||Oe?E.set("instantType",ke?"click":"dismiss"):E.set("instantType",void 0)}),Se=f.useCallback(W=>{const J=xe(W);return J.preventUnmountOnClose=()=>{E.set("preventUnmountingOnClose",!0)},J},[E]),ve=f.useCallback(()=>{E.setOpen(!1,Se(To))},[E,Se]);f.useImperativeHandle(c,()=>({unmount:G,close:ve}),[G,ve]);let we;M.type==="context-menu"&&(we=M.context),f.useImperativeHandle(we?.positionerRef,()=>N,[N]),f.useImperativeHandle(we?.actionsRef,()=>({setOpen:Q}),[Q]);const me=Mo({popupStore:E,onOpenChange:Q});fe=me.context.events,f.useEffect(()=>{const W=({open:J,eventDetails:ye})=>Q(J,ye);return fe.on("setOpen",W),()=>{fe?.off("setOpen",W)}},[fe,Q]);const X=Po(me,{enabled:!L,bubbles:{escapeKey:h&&M.type==="menu"},outsidePress(){return M.type!=="context-menu"||ne.current?.type==="contextmenu"?!0:re.current},externalTree:ie?S:void 0}),Y=Io(me,{role:"menu"}),A=Sr(),$=f.useCallback(W=>{E.select("activeIndex")!==W&&E.set("activeIndex",W)},[E]),B=di(me,{enabled:!L,listRef:E.context.itemDomElements,activeIndex:T,nested:M.type!==void 0,loopFocus:l,orientation:u,parentOrientation:M.type==="menubar"?M.context.orientation:void 0,rtl:A==="rtl",disabledIndices:Qt,onNavigate:$,openOnArrowKeyDown:M.type!=="context-menu",externalTree:ie?S:void 0,focusItemOnHover:b}),se=f.useCallback(W=>{E.context.typingRef.current=W},[E]),ge=mi(me,{listRef:E.context.itemLabels,activeIndex:T,resetMs:ko,onMatch:W=>{P&&W!==T&&E.set("activeIndex",W)},onTypingChange:se}),{getReferenceProps:he,getFloatingProps:je,getItemProps:_e,getTriggerProps:H}=ir([X,Y,B,ge]),z=f.useMemo(()=>{const W=Jt(he(),{onMouseMove(){E.set("allowMouseEnter",!0)}},de);return delete W.role,W},[he,E,de]),Z=f.useMemo(()=>{const W=H();if(!W)return W;const J=Jt(W,de);return delete J.role,delete J["aria-controls"],J},[H,de]),q=f.useMemo(()=>je({onMouseMove(){E.set("allowMouseEnter",!0),M.type==="menu"&&E.set("hoverEnabled",!1)},onClick(){E.select("hoverEnabled")&&E.set("hoverEnabled",!1)},onKeyDown(W){const J=E.select("keyboardEventRelay");J&&!W.isPropagationStopped()&&J(W)}}),[je,M.type,E]),ee=f.useMemo(()=>_e(),[_e]);E.useSyncedValues({floatingRootContext:me,activeTriggerProps:z,inactiveTriggerProps:Z,popupProps:q,itemProps:ee});const Re=f.useMemo(()=>({store:E,parent:v}),[E,v]),Ie=d.jsx(vr.Provider,{value:Re,children:typeof n=="function"?n({payload:D}):n});return M.type===void 0||M.type==="context-menu"?d.jsx(Ao,{externalTree:S,children:Ie}):Ie});function Ki(e){const t=e.getBoundingClientRect(),n=window.getComputedStyle(e,"::before"),r=window.getComputedStyle(e,"::after");if(!(n.content!=="none"||r.content!=="none"))return t;const o=parseFloat(n.width)||0,a=parseFloat(n.height)||0,i=parseFloat(r.width)||0,g=parseFloat(r.height)||0,l=Math.max(t.width,o,i),u=Math.max(t.height,a,g),c=l-t.width,h=u-t.height;return{left:t.left-c/2,right:t.right+c/2,top:t.top-h/2,bottom:t.bottom+h/2}}function Yi(e={}){const{highlightItemOnHover:t,highlightedIndex:n,onHighlightedIndexChange:r}=ar(),{ref:s,index:o}=Rr(e),a=n===o,i=f.useRef(null),g=tr(s,i);return{compositeProps:f.useMemo(()=>({tabIndex:a?0:-1,onFocus(){r(o)},onMouseMove(){const u=i.current;if(!t||!u)return;const c=u.hasAttribute("disabled")||u.ariaDisabled==="true";!a&&!c&&u.focus()}}),[a,r,o,t]),compositeRef:g,index:o}}function Gi(e){const{render:t,className:n,state:r=vt,props:s=Qt,refs:o=Qt,metadata:a,stateAttributesMapping:i,tag:g="div",...l}=e,{compositeProps:u,compositeRef:c}=Yi({metadata:a});return bt(g,e,{state:r,ref:[...o,c],props:[u,...s,l],stateAttributesMapping:i})}function Mr(e){if(Ue(e)&&e.hasAttribute("data-rootownerid"))return e.getAttribute("data-rootownerid")??void 0;if(!mt(e))return Mr(st(e))}function Xi(e){const{enabled:t=!0,mouseDownAction:n,open:r}=e,s=f.useRef(!1);return f.useMemo(()=>t?{onMouseDown:o=>{(n==="open"&&!r||n==="close"&&r)&&(s.current=!0,$e(o.currentTarget).addEventListener("click",()=>{s.current=!1},{once:!0}))},onClick:o=>{s.current&&(s.current=!1,o.preventBaseUIHandler())}}:vt,[t,n,r])}const Et=2,qi=No(function(t,n){const{render:r,className:s,disabled:o=!1,nativeButton:a=!0,id:i,openOnHover:g,delay:l=100,closeDelay:u=0,handle:c,payload:h,...y}=t,x=et(!0),m=c?.store??x?.store;if(!m)throw new Error(yt(85));const b=nr(i),p=m.useState("isTriggerActive",b),w=m.useState("floatingRootContext"),C=m.useState("isOpenedByTrigger",b),R=f.useRef(null),v=Qi(),E=ar(!0),S=xt(),k=f.useMemo(()=>S??new or,[S]),U=sr(k),P=ht(),{registerTrigger:j,isMountedByThisTrigger:N}=jo(b,R,m,{payload:h,closeDelay:u,parent:v,floatingTreeRoot:k,floatingNodeId:U,floatingParentNodeId:P,keyboardEventRelay:E?.relayKeyboardEvent}),O=v.type==="menubar",I=m.useState("disabled"),L=o||I||O&&v.context.disabled,{getButtonProps:F,buttonRef:M}=er({disabled:L,native:a});f.useEffect(()=>{!C&&v.type===void 0&&(m.context.allowMouseUpTriggerRef.current=!1)},[m,C,v.type]);const T=f.useRef(null),D=it(),_=ue(X=>{if(!T.current)return;D.clear(),m.context.allowMouseUpTriggerRef.current=!1;const Y=X.target;if(Me(T.current,Y)||Me(m.select("positionerElement"),Y)||Y===T.current||Y!=null&&Mr(Y)===m.select("rootId"))return;const A=Ki(T.current);X.clientX>=A.left-Et&&X.clientX<=A.right+Et&&X.clientY>=A.top-Et&&X.clientY<=A.bottom+Et||k.events.emit("close",{domEvent:X,reason:Do})});f.useEffect(()=>{C&&m.select("lastOpenChangeReason")===Fe&&$e(T.current).addEventListener("mouseup",_,{once:!0})},[C,_,m]);const ne=O&&v.context.hasSubmenuOpen,fe=ci(w,{enabled:(g??ne)&&!L&&v.type!=="context-menu"&&(!O||ne&&!N),handleClose:pi({blockPointerEvents:!O}),mouseOnly:!0,move:!1,restMs:v.type===void 0?l:void 0,delay:{close:u},triggerElementRef:R,externalTree:k,isActiveTrigger:p}),V=Ji(C,m.select("lastOpenChangeReason")),de=Lo(w,{enabled:!L&&v.type!=="context-menu",event:C&&O?"click":"mousedown",toggle:!0,ignoreMouse:!1,stickIfOpen:v.type===void 0?V:!1}),K=ti(w,{enabled:!L&&ne}),G=Xi({open:C,enabled:O,mouseDownAction:"open"}),re=ir([de,K]),pe={disabled:L,open:C},oe=m.useState("triggerProps",N),ae=[T,n,M,j,R],Q=[re.getReferenceProps(),fe??vt,oe,{"aria-haspopup":"menu",id:b,onMouseDown:X=>{if(m.select("open"))return;D.start(200,()=>{m.context.allowMouseUpTriggerRef.current=!0}),$e(X.currentTarget).addEventListener("mouseup",_,{once:!0})}},O?{role:"menuitem"}:{},G,y,F],Se=f.useRef(null),ve=ue(X=>{kt.flushSync(()=>{m.setOpen(!1,xe(It,X.nativeEvent,X.currentTarget))}),Fo(Se.current)?.focus()}),we=ue(X=>{const Y=m.select("positionerElement");if(Y&&Ho(X,Y))m.context.beforeContentFocusGuardRef.current?.focus();else{kt.flushSync(()=>{m.setOpen(!1,xe(It,X.nativeEvent,X.currentTarget))});let A=Bo(m.context.triggerFocusTargetRef.current||R.current);for(;A!==null&&Me(Y,A);){const $=A;if(A=Uo(A),A===$)break}A?.focus()}}),me=bt("button",t,{enabled:!O,stateAttributesMapping:yn,state:pe,ref:ae,props:Q});return O?d.jsx(Gi,{tag:"button",render:r,className:s,state:pe,refs:ae,props:Q,stateAttributesMapping:yn}):C?d.jsxs(f.Fragment,{children:[d.jsx(bn,{ref:Se,onFocus:ve},`${b}-pre-focus-guard`),d.jsx(f.Fragment,{children:me},b),d.jsx(bn,{ref:m.context.triggerFocusTargetRef,onFocus:we},`${b}-post-focus-guard`)]}):d.jsx(f.Fragment,{children:me},b)});function Ji(e,t){const n=it(),[r,s]=f.useState(!1);return le(()=>{e&&t==="trigger-hover"?(s(!0),n.start(_o,()=>{s(!1)})):e||(n.clear(),s(!1))},[e,t,n]),r}function Qi(){const e=Ut(!0),t=et(!0),n=Tr();return f.useMemo(()=>n?{type:"menubar",context:n}:e&&!t?{type:"context-menu",context:e}:{type:void 0},[e,t,n])}function Zi({...e}){return d.jsx(Wi,{"data-slot":"dropdown-menu",...e})}function ea({...e}){return d.jsx(qi,{"data-slot":"dropdown-menu-trigger",...e})}function ta({align:e="start",alignOffset:t=0,side:n="bottom",sideOffset:r=4,className:s,...o}){return d.jsx(Mi,{children:d.jsx(Bi,{className:"isolate z-50 outline-none",align:e,alignOffset:t,side:n,sideOffset:r,children:d.jsx(Oi,{"data-slot":"dropdown-menu-content",className:Ce("data-open:animate-in data-closed:animate-out data-closed:fade-out-0 data-open:fade-in-0 data-closed:zoom-out-95 data-open:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 ring-foreground/10 bg-popover text-popover-foreground min-w-32 rounded-lg p-1 shadow-md ring-1 duration-100 z-50 max-h-(--available-height) w-(--anchor-width) origin-(--transform-origin) overflow-x-hidden overflow-y-auto outline-none data-closed:overflow-hidden",s),...o})})})}function $n({className:e,inset:t,variant:n="default",...r}){return d.jsx(Ri,{"data-slot":"dropdown-menu-item","data-inset":t,"data-variant":n,className:Ce("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:text-destructive not-data-[variant=destructive]:focus:**:text-accent-foreground gap-1.5 rounded-md px-1.5 py-1 text-sm [&_svg:not([class*='size-'])]:size-4 group/dropdown-menu-item relative flex cursor-default items-center outline-hidden select-none data-disabled:pointer-events-none data-disabled:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0",e),...r})}function na({characterName:e,characterId:t,isOnline:n=!0,statusText:r="Online now",onBack:s,onDeleteChat:o,onResetChat:a,statusClassName:i,statusOpacity:g=1,chocoBalance:l,chocoChange:u,isOptimisticDeducting:c}){const[h,y]=f.useState(!1);return d.jsx("header",{className:"flex-none z-50 bg-background-light/90 dark:bg-background-dark/90 backdrop-blur-md border-b border-gray-200 dark:border-white/5 sticky top-0",children:d.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[d.jsx("button",{onClick:s,className:"flex items-center justify-center text-slate-600 dark:text-white hover:bg-black/5 dark:hover:bg-white/10 rounded-full w-10 h-10 transition-colors",children:d.jsx("span",{className:"material-symbols-outlined",children:"arrow_back_ios_new"})}),d.jsxs("div",{className:"flex flex-col items-center flex-1 mx-2",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[t?d.jsx(Hr,{to:`/character/${t}`,className:"text-lg font-bold leading-tight hover:underline",children:e}):d.jsx("h1",{className:"text-lg font-bold leading-tight",children:e}),n&&d.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.6)]"})]}),d.jsx("span",{className:Ce("text-[11px] text-primary font-bold uppercase tracking-widest mt-0.5 transition-colors duration-500",i),style:{opacity:g},children:r})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[l!==void 0&&d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"hidden sm:flex items-center px-3 py-1 rounded-full bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-white/10 mr-1",children:d.jsxs("div",{className:"flex items-center relative",children:[d.jsx(Mn,{value:Number(l),className:"text-xs font-bold text-slate-700 dark:text-slate-200 mr-1",duration:c?0:500}),d.jsx("span",{className:"text-[10px] font-bold text-slate-500 dark:text-slate-400",children:"CHOCO"}),u!==void 0&&u!==0&&d.jsx(Pn,{amount:u,className:"absolute -right-6 top-0 whitespace-nowrap"})]})}),d.jsxs(Vo,{open:h,onOpenChange:y,children:[d.jsx(zo,{render:d.jsx("button",{className:"sm:hidden flex items-center px-2 py-1 rounded-full bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-white/10 mr-1",children:d.jsx("span",{className:"material-symbols-outlined text-[18px] text-slate-600 dark:text-slate-300",children:"account_balance_wallet"})})}),d.jsxs($o,{children:[d.jsxs(Wo,{children:[d.jsx(Ko,{children:" "}),d.jsx(Yo,{children:"   ."})]}),d.jsx("div",{className:"py-4 space-y-4",children:d.jsx("div",{className:"flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800 rounded-lg",children:d.jsxs("div",{className:"flex flex-col",children:[d.jsx("span",{className:"text-sm font-medium text-slate-500 dark:text-slate-400",children:"CHOCO"}),d.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[d.jsx(Mn,{value:Number(l),className:"text-2xl font-bold text-slate-900 dark:text-white",duration:c?0:500}),u!==void 0&&u!==0&&d.jsx(Pn,{amount:u})]})]})})})]})]})]}),d.jsxs(Zi,{children:[d.jsx(ea,{render:d.jsx("button",{className:"flex items-center justify-center text-slate-600 dark:text-white hover:bg-black/5 dark:hover:bg-white/10 rounded-full w-10 h-10 transition-colors",children:d.jsx("span",{className:"material-symbols-outlined",children:"more_horiz"})})}),d.jsxs(ta,{align:"end",children:[d.jsxs($n,{onClick:o,variant:"destructive",children:[d.jsx("span",{className:"material-symbols-outlined mr-2 text-[18px]",children:"delete"})," "]}),d.jsxs($n,{onClick:a,children:[d.jsx("span",{className:"material-symbols-outlined mr-2 text-[18px]",children:"restart_alt"}),"  ( )"]})]})]})]})]})})}function Wn({content:e,sender:t,senderName:n,timestamp:r,avatarUrl:s,showAvatar:o=!0,className:a,isStreaming:i=!1,mediaUrl:g,messageId:l,isLiked:u=!1,onLike:c,auraClass:h,auraOpacity:y=1,auraStyle:x}){const m=t==="user",b=()=>{l&&c&&c(l,u)};return m?d.jsxs("div",{className:Ce("flex items-end gap-3 justify-end group",a),children:[l&&c&&d.jsx("button",{onClick:b,className:Ce("opacity-0 group-hover:opacity-100 transition-opacity p-1 order-1",u?"opacity-100 text-primary":"text-gray-400 dark:text-gray-600 hover:text-primary dark:hover:text-primary"),children:d.jsx("span",{className:Ce("material-symbols-outlined text-[18px]",u&&"fill"),children:"favorite"})}),d.jsxs("div",{className:"flex flex-col gap-1 items-end max-w-[75%] order-2",children:[g&&d.jsx("div",{className:"mb-2 rounded-xl overflow-hidden shadow-lg border-2 border-primary/20 max-w-sm",children:d.jsx("img",{src:g,alt:"User shared",className:"w-full h-auto max-h-60 object-cover"})}),d.jsx("div",{className:"px-5 py-1 bg-primary text-white rounded-2xl rounded-tr-sm shadow-md shadow-primary/20 text-[15px] leading-relaxed",children:e}),r&&d.jsx("span",{className:"text-[11px] text-gray-400 dark:text-white/30 mr-1",children:r})]})]}):d.jsxs("div",{className:Ce("flex items-end gap-3 group",a),children:[o&&d.jsx("div",{className:Ce("w-10 h-10 shrink-0 rounded-full bg-gray-300 dark:bg-surface-dark overflow-hidden border border-white/10 relative transition-all duration-500",h),style:{opacity:y,...x},children:s?d.jsx("img",{alt:n||"AI profile",className:"w-full h-full object-cover",src:s}):d.jsx("div",{className:"w-full h-full bg-gradient-to-br from-primary/20 to-primary/40"})}),d.jsxs("div",{className:"flex flex-col gap-1 items-start max-w-[75%]",children:[n&&d.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-1",children:n}),g&&d.jsx("div",{className:"mb-2 rounded-xl overflow-hidden shadow-lg border border-white/10 max-w-sm",children:d.jsx("img",{src:g,alt:"AI shared",className:"w-full h-auto max-h-60 object-cover"})}),d.jsxs("div",{className:"px-5 py-3 bg-white dark:bg-surface-dark rounded-2xl rounded-tl-sm text-slate-800 dark:text-gray-100 shadow-sm text-[15px] leading-relaxed relative",children:[e,i&&d.jsx("span",{className:"inline-block w-1.5 h-4 ml-1 bg-primary animate-pulse align-middle"})]}),r&&d.jsxs("div",{className:"flex items-center gap-2 ml-1",children:[d.jsx("span",{className:"text-[11px] text-gray-400 dark:text-white/30",children:r}),l&&c&&d.jsx("button",{onClick:b,className:Ce("opacity-0 group-hover:opacity-100 transition-opacity p-1",u?"opacity-100 text-primary":"text-gray-400 dark:text-gray-600 hover:text-primary dark:hover:text-primary"),children:d.jsx("span",{className:Ce("material-symbols-outlined text-[18px]",u&&"fill"),children:"favorite"})})]}),!r&&l&&c&&d.jsx("button",{onClick:b,className:Ce("opacity-0 group-hover:opacity-100 transition-opacity p-1 ml-1",u?"opacity-100 text-primary":"text-gray-400 dark:text-gray-600 hover:text-primary dark:hover:text-primary"),children:d.jsx("span",{className:Ce("material-symbols-outlined text-[18px]",u&&"fill"),children:"favorite"})})]})]})}function ra({isOpen:e,onClose:t,onGift:n,onOpenStore:r,ownedHearts:s=0}){const[o,a]=f.useState(1),[i,g]=f.useState(!1);if(!e)return null;const l=Go.HEART,u=s>=o,c=async()=>{if(!u){r();return}g(!0);try{await n(l.id,o),t()}catch(h){console.error("Gift error:",h),nt.error("  .")}finally{g(!1)}};return d.jsx("div",{className:"absolute bottom-20 left-4 right-4 z-50 animate-in fade-in slide-in-from-bottom-4",children:d.jsxs("div",{className:"bg-[#1A1821]/95 backdrop-blur-xl border border-white/10 rounded-[32px] p-6 shadow-2xl overflow-hidden relative",children:[d.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-primary/10 blur-3xl rounded-full -mr-16 -mt-16"}),d.jsxs("div",{className:"flex justify-between items-center mb-6 relative z-10",children:[d.jsxs("div",{children:[d.jsxs("h3",{className:"text-lg font-black italic tracking-tighter text-white uppercase leading-none",children:["Send ",d.jsx("span",{className:"text-primary",children:l.name})]}),d.jsxs("p",{className:"text-[10px] text-white/40 font-black uppercase tracking-widest mt-1",children:[" : ",d.jsxs("span",{className:"text-primary",children:[s,""]})]})]}),d.jsx("button",{onClick:t,className:"text-white/20 hover:text-white transition-colors",children:d.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),d.jsxs("div",{className:"flex flex-col items-center gap-6 relative z-10",children:[d.jsxs("div",{className:"relative group",children:[d.jsx("div",{className:"absolute inset-0 bg-primary/20 blur-2xl rounded-full group-hover:bg-primary/30 transition-all"}),d.jsx("div",{className:"relative w-24 h-24 rounded-[30px] bg-[#2d1622] border border-white/5 flex items-center justify-center p-5 shadow-inner",children:d.jsx("span",{className:"material-symbols-outlined text-primary text-5xl group-hover:scale-110 transition-transform duration-500",style:{fontVariationSettings:"'FILL' 1"},children:l.iconUrl})})]}),d.jsx("div",{className:"grid grid-cols-4 gap-3 w-full",children:[1,10,50,100].map(h=>d.jsxs("button",{onClick:()=>a(h),className:Ce("py-3 rounded-[18px] text-[11px] font-black tracking-tighter transition-all border",o===h?"bg-primary border-primary text-black shadow-[0_0_20px_rgba(238,43,140,0.4)] scale-105":"bg-white/3 border-white/5 text-white/40 hover:bg-white/10 hover:text-white"),children:["x",h]},h))}),d.jsxs("div",{className:"w-full space-y-4 pt-2",children:[!u&&d.jsx("p",{className:"text-center text-[10px] font-bold text-red-500/80 bg-red-500/5 py-2 rounded-xl border border-red-500/10",children:"  .   ."}),d.jsx("button",{onClick:c,disabled:i,className:Ce("w-full h-15 rounded-[20px] font-black text-base shadow-xl transition-all flex items-center justify-center gap-2 active:scale-95",u?"bg-primary text-black shadow-primary/20 hover:shadow-primary/40":"bg-white/5 border border-white/10 text-white hover:bg-white/10"),children:i?d.jsx(Zt,{size:"sm"}):d.jsxs(d.Fragment,{children:[d.jsx("span",{className:"material-symbols-outlined text-[20px]",style:{fontVariationSettings:"'FILL' 1"},children:u?"send":"add_circle"}),u?" ":"  "]})})]})]})]})})}function oa({onSend:e,onGift:t,onOpenStore:n,userChocoBalance:r=0,ownedHearts:s=0,placeholder:o=" ...",disabled:a=!1,className:i}){const[g,l]=f.useState(""),[u,c]=f.useState(!1),[h,y]=f.useState(null),[x,m]=f.useState(null),[b,p]=f.useState(!1),w=f.useRef(null),C=()=>{(g.trim()||x)&&!a&&!u&&e&&(e(g.trim(),x||void 0),l(""),y(null),m(null))},R=async S=>{const k=S.target.files?.[0];if(!k)return;const U=new FileReader;U.onloadend=()=>{y(U.result)},U.readAsDataURL(k),c(!0);const P=new FormData;P.append("file",k);try{const j=await fetch("/api/upload",{method:"POST",body:P});if(!j.ok)throw new Error("Upload failed");const N=await j.json();m(N.url)}catch(j){console.error("Upload error:",j),alert("  ."),y(null)}finally{c(!1)}},v=S=>{S.key==="Enter"&&!S.shiftKey&&(S.preventDefault(),C())},E=()=>{y(null),m(null),w.current&&(w.current.value="")};return d.jsxs("footer",{className:Ce("flex-none bg-background-light dark:bg-background-dark border-t border-gray-200 dark:border-white/5 pb-8 pt-2 px-3 relative",i),children:[t&&d.jsx(ra,{isOpen:b,onClose:()=>p(!1),onGift:t,onOpenStore:n||(()=>{}),ownedHearts:s}),h&&d.jsxs("div",{className:"px-4 py-2 flex items-center gap-3",children:[d.jsxs("div",{className:"relative w-24 h-24 rounded-lg overflow-hidden border-2 border-primary shadow-lg group",children:[d.jsx("img",{src:h,alt:"Preview",className:"w-full h-full object-cover"}),u&&d.jsx("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center",children:d.jsx("span",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"})}),d.jsx("button",{onClick:E,className:"absolute top-1 right-1 bg-black/50 text-white rounded-full p-1 hover:bg-black/70 transition-colors",children:d.jsx("span",{className:"material-symbols-outlined text-[16px]",children:"close"})})]}),d.jsx("span",{className:"text-xs text-gray-400",children:" "})]}),d.jsxs("div",{className:"flex items-center gap-2 p-2",children:[d.jsx("input",{type:"file",ref:w,onChange:R,accept:"image/*",className:"hidden"}),d.jsxs("div",{className:"flex items-center",children:[d.jsx("button",{type:"button",onClick:()=>w.current?.click(),disabled:a||u,className:"flex items-center justify-center w-10 h-10 rounded-full text-gray-400 hover:text-primary transition-colors shrink-0 disabled:opacity-50",children:d.jsx("span",{className:"material-symbols-outlined text-[28px]",children:"add_circle"})}),d.jsx("button",{type:"button",onClick:()=>p(!b),disabled:a,className:Ce("flex items-center justify-center w-10 h-10 rounded-full transition-all shrink-0 disabled:opacity-50",b?"text-primary scale-110":"text-gray-400 hover:text-primary"),children:d.jsx("span",{className:"material-symbols-outlined text-[28px]",style:{fontVariationSettings:b?"'FILL' 1":"'FILL' 0"},children:"favorite"})})]}),d.jsxs("div",{className:"flex-1 bg-white dark:bg-surface-dark rounded-[24px] min-h-[40px] flex items-center px-4 py-1 border border-transparent focus-within:border-primary/50 transition-colors shadow-sm focus-within:shadow-md",children:[d.jsx("input",{type:"text",value:g,onChange:S=>l(S.target.value),onKeyPress:v,placeholder:o,disabled:a,className:"w-full bg-transparent border-none text-slate-800 dark:text-white placeholder-gray-400 focus:ring-0 focus:outline-none text-[15px] leading-normal p-0 font-display"}),d.jsx("button",{type:"button",className:"text-gray-400 hover:text-yellow-500 transition-colors ml-2 flex items-center justify-center",children:d.jsx("span",{className:"material-symbols-outlined",children:"sentiment_satisfied"})})]}),d.jsx("button",{type:"button",onClick:C,disabled:!g.trim()&&!x||a||u,className:"flex items-center justify-center w-10 h-10 rounded-full bg-primary text-white shadow-lg shadow-primary/30 hover:bg-primary/90 hover:scale-105 active:scale-95 transition-all shrink-0 disabled:opacity-50 disabled:cursor-not-allowed",children:a||u?d.jsx("span",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):d.jsx("span",{className:"material-symbols-outlined text-[20px] ml-0.5",children:"send"})})]})]})}function sa(){return d.jsxs("div",{className:"flex items-center gap-1 mt-1 ml-1",children:[d.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-gray-300 dark:bg-gray-600 animate-bounce",style:{animationDelay:"0ms"}}),d.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-gray-300 dark:bg-gray-600 animate-bounce",style:{animationDelay:"150ms"}}),d.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-gray-300 dark:bg-gray-600 animate-bounce",style:{animationDelay:"300ms"}})]})}function ia(){return d.jsxs("div",{className:"flex flex-col gap-6 p-4",children:[d.jsx("div",{className:"flex justify-center",children:d.jsx(We,{className:"w-32 h-6 rounded-full"})}),d.jsxs("div",{className:"flex items-end gap-3",children:[d.jsx(We,{variant:"circular",className:"w-10 h-10 shrink-0"}),d.jsxs("div",{className:"flex flex-col gap-1 items-start max-w-[75%]",children:[d.jsx(We,{className:"w-12 h-3 rounded"}),d.jsx(We,{className:"w-48 h-16 rounded-2xl rounded-tl-sm"})]})]}),d.jsx("div",{className:"flex items-end gap-3 justify-end",children:d.jsxs("div",{className:"flex flex-col gap-1 items-end max-w-[75%]",children:[d.jsx(We,{className:"w-40 h-14 rounded-2xl rounded-tr-sm"}),d.jsx(We,{className:"w-16 h-3 rounded"})]})}),d.jsxs("div",{className:"flex items-end gap-3",children:[d.jsx(We,{variant:"circular",className:"w-10 h-10 shrink-0"}),d.jsxs("div",{className:"flex flex-col gap-1 items-start max-w-[75%]",children:[d.jsx(We,{className:"w-12 h-3 rounded"}),d.jsx(We,{className:"w-56 h-20 rounded-2xl rounded-tl-sm"})]})]})]})}const tt={JOY:{color:"text-pink-400",text:" ",aura:"ring-2 ring-pink-500/30 animate-aura-breathe",style:{"--aura-color":"rgba(236,72,153,0.6)"}},SHY:{color:"text-rose-400",text:"",aura:"ring-2 ring-rose-500/40 animate-neon-flicker",style:{"--aura-color":"rgba(251,113,133,0.5)"}},EXCITED:{color:"text-orange-400",text:"!",aura:"ring-4 ring-orange-500/50 animate-intense-pulse",style:{"--aura-color":"rgba(251,146,60,0.8)"}},LOVING:{color:"text-red-500",text:"",aura:"ring-4 ring-red-600 animate-intense-pulse shadow-[0_0_10px_rgba(220,38,38,0.8)]",style:{"--aura-color":"rgba(220,38,38,0.9)"}},SAD:{color:"text-blue-400",text:"",aura:"ring-1 ring-blue-500/20 shadow-[0_0_10px_rgba(59,130,246,0.3)]",style:{"--aura-color":"rgba(59,130,246,0.3)"}},THINKING:{color:"text-purple-400",text:" ",aura:"ring-2 ring-purple-500/40 animate-aura-breathe",style:{"--aura-color":"rgba(168,85,247,0.5)"}}},va=Br(function(){const{messages:t,user:n,conversation:r,characterStat:s,paypalClientId:o,tossClientKey:a}=Ur(),i=_r(),g=Vr(),l=zr(),u=r?.id||$r().id,c=r?.character,h=c?.name||"AI",y=c?.media?.find(H=>H.type==="AVATAR")?.url||c?.media?.[0]?.url,[x,m]=f.useState(t),[b,p]=f.useState(""),[w,C]=f.useState(null),[R,v]=f.useState(!1),[E,S]=f.useState(!1),[k,U]=f.useState("idle"),[P,j]=f.useState(s?.currentEmotion||"JOY"),[N,O]=f.useState(s?.emotionExpiresAt||null),[I,L]=f.useState(1),[F,M]=f.useState(!1),[T,D]=f.useState(!0),[_,ne]=f.useState(!1),[ie,fe]=f.useState(!1),[V,de]=f.useState(!1),[K,G]=f.useState(!1),re=f.useRef(null),[pe,oe]=f.useState(n?.inventory?.find(H=>H.itemId==="heart")?.quantity||0),[ae,Q]=f.useState(n?.chocoBalance?parseFloat(n.chocoBalance):0),[Se,ve]=f.useState(void 0),[we,me]=f.useState(0),X=f.useRef(0),Y=f.useRef(null);f.useEffect(()=>{X.current=we},[we]),f.useEffect(()=>{oe(n?.inventory?.find(H=>H.itemId==="heart")?.quantity||0),!R&&we===0&&g.state==="idle"&&(n?.chocoBalance!==void 0&&Q(parseFloat(n.chocoBalance)),ve(void 0))},[n,R,we,g.state]);const A=f.useRef(null);f.useEffect(()=>{s&&(j(s.currentEmotion||"JOY"),O(s.emotionExpiresAt||null))},[s]),f.useEffect(()=>{D(!0)},[u]),f.useEffect(()=>{if(!N||P==="JOY")return;const z=setInterval(()=>{const Z=new Date().getTime(),q=new Date(N).getTime();if(Z>=q)j("JOY"),O(null),L(1);else{const ee=(q-Z)/1e3;ee<=10?L(ee/10):L(1)}},1e3);return()=>clearInterval(z)},[N,P]),f.useEffect(()=>{const H=A.current;if(!H)return;const z=()=>{const q=H.scrollHeight-H.scrollTop-H.clientHeight<200;T&&x.length>0?(H.scrollTop=H.scrollHeight,setTimeout(()=>{H.scrollTop=H.scrollHeight,D(!1)},100)):(q||F)&&(H.scrollTop=H.scrollHeight)};z();const Z=new ResizeObserver(z);return Z.observe(H),()=>Z.disconnect()},[x,b,F,T]),f.useEffect(()=>{m(H=>{const z=new Set(t.map(ee=>ee.id)),Z=H.filter(ee=>ee.role==="user"&&!z.has(ee.id));return[...t,...Z].sort((ee,Re)=>new Date(ee.createdAt).getTime()-new Date(Re.createdAt).getTime())}),M(!1)},[t]),f.useEffect(()=>()=>{re.current&&re.current.abort()},[]);const $=async(H,z)=>{try{await fetch("/api/chat/interrupt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversationId:u,content:H,mediaUrl:z})})}catch(Z){console.error("Failed to save interrupted message:",Z)}},B=async(H,z)=>{if(R){if(G(!0),re.current&&re.current.abort(),Y.current&&(clearInterval(Y.current),Y.current=null),b.trim()){const Ie=b.endsWith("...")?b:b+"...",J={id:crypto.randomUUID(),role:"assistant",content:Ie,mediaUrl:w||null,createdAt:new Date().toISOString(),isLiked:!1};m(ye=>[...ye,J]),await $(b,w)}p(""),C(null),v(!1),G(!1),await new Promise(Ie=>setTimeout(Ie,50))}const Z=5;Y.current&&clearInterval(Y.current);let q=0;me(.001),Y.current=setInterval(()=>{q<Z?(q+=1,X.current=q,me(q),Q(Ie=>Math.max(0,Ie-1))):Y.current&&(clearInterval(Y.current),Y.current=null)},1e3);const ee=crypto.randomUUID(),Re={id:ee,role:"user",content:H,mediaUrl:z||null,createdAt:new Date().toISOString(),isLiked:!1};m(Ie=>[...Ie,Re]),i.submit({id:ee,message:H,mediaUrl:z||"",createdAt:Re.createdAt},{method:"post"}),M(!0),se(H,z)},se=async(H,z,Z)=>{v(!0),p(""),C(null);try{re.current&&re.current.abort(),Y.current&&(clearInterval(Y.current),Y.current=null);const q=new AbortController;re.current=q;const ee=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},signal:q.signal,body:JSON.stringify({message:H,conversationId:u,mediaUrl:z,characterId:c?.id,giftContext:Z})});if(!ee.ok)throw new Error("AI   ");M(!1);const Re=ee.body?.getReader(),Ie=new TextDecoder;let W="",J="";if(Re)for(;;){const{done:ye,value:ce}=await Re.read();if(ye)break;const ke=Ie.decode(ce,{stream:!0}).split(`
`);for(const Oe of ke)if(Oe.startsWith("data: "))try{const te=JSON.parse(Oe.slice(6));if(te.emotion&&j(te.emotion),te.expiresAt&&O(te.expiresAt),te.text&&(W+=te.text,J+=te.text,p(Ne=>Ne+te.text)),te.messageComplete){const Ne={id:te.messageId||crypto.randomUUID(),role:"assistant",content:J,mediaUrl:te.mediaUrl||null,createdAt:new Date().toISOString(),isLiked:!1};m(Ve=>[...Ve,Ne]),p(""),C(null),J=""}if(te.mediaUrl&&!te.messageComplete&&C(te.mediaUrl),te.done)if(v(!1),Y.current&&(clearInterval(Y.current),Y.current=null),te.usage&&te.usage.totalTokens){const Ne=Math.ceil(te.usage.totalTokens/100),Ve=X.current-Ne;Q(ct=>Math.max(0,ct+Ve)),ve(-Ne),setTimeout(()=>{ve(void 0)},2e3),me(0),g.revalidate()}else setTimeout(()=>{ve(void 0),me(0),g.revalidate()},2e3)}catch{}}}catch(q){if(q.name==="AbortError"){console.log("Stream aborted locally");return}if(console.error("Streaming error:",q),nt.error("    ."),v(!1),M(!1),Y.current&&(clearInterval(Y.current),Y.current=null),X.current>0){Q(Re=>Re+X.current);const ee=X.current;me(0),ve(ee),setTimeout(()=>{ve(void 0)},2e3)}if(b&&!K){const ee={id:crypto.randomUUID(),role:"assistant",content:b+"...",createdAt:new Date().toISOString()};m(Re=>[...Re,ee]),p("")}}},ge=async(H,z)=>{try{const Z=await fetch("/api/items/gift",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({characterId:c?.id,itemId:H,amount:z,conversationId:u})}),q=await Z.json();if(!Z.ok)throw new Error(q.error||"Gifting failed");nt.success(`${z}  ! `),q.systemMsg&&m(ee=>[...ee,{id:q.systemMsg.id,role:"assistant",content:q.systemMsg.content,createdAt:q.systemMsg.createdAt}]),se("",void 0,{amount:z,itemId:H}),pe>=z&&oe(ee=>ee-z)}catch(Z){throw nt.error(Z.message),Z}},he=()=>l(-1),je=async(H=!1)=>{de(!0);try{if((await fetch("/api/chat/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversationId:u,resetMemory:H})})).ok)nt.success(H?" .":" ."),H?(m([]),fe(!1)):(ne(!1),l("/chats"));else throw new Error(" ")}catch(z){console.error("Delete error:",z),nt.error("   .")}finally{de(!1)}},_e=()=>{U("loading"),setTimeout(()=>U("idle"),1e3)};return d.jsxs("div",{className:"bg-background-light dark:bg-background-dark font-display text-slate-900 dark:text-white h-screen flex flex-col overflow-hidden max-w-md mx-auto md:max-w-2xl lg:max-w-3xl",children:[d.jsx(na,{characterName:h,characterId:c?.id,isOnline:!0,statusText:tt[P]?.text||"Active Now",statusClassName:tt[P]?.color,statusOpacity:I,onBack:he,onDeleteChat:()=>ne(!0),onResetChat:()=>fe(!0),chocoBalance:Math.floor(ae).toString(),chocoChange:Se,isOptimisticDeducting:we>0}),d.jsx("main",{ref:A,className:"flex-1 overflow-y-auto px-4 py-6 space-y-4 relative no-scrollbar",style:{scrollBehavior:"auto",background:"radial-gradient(circle at 50% 50%, rgba(238, 43, 140, 0.05) 0%, transparent 100%)"},children:k==="loading"?d.jsx(ia,{}):k==="network-error"?d.jsx(qo,{onRetry:_e}):d.jsxs(d.Fragment,{children:[x.length===0&&!R&&!F&&d.jsx("div",{className:"flex flex-col items-center justify-center py-20 px-4 text-center",children:d.jsx("p",{className:"text-sm text-slate-500",children:" .   !"})}),x.map(H=>d.jsx(Wn,{messageId:H.id,sender:H.role==="user"?"user":"ai",senderName:H.role==="user"?n?.name:h,content:H.content,mediaUrl:H.mediaUrl||void 0,avatarUrl:H.role==="assistant"?y:void 0,auraClass:H.role==="assistant"?tt[P]?.aura:void 0,auraOpacity:H.role==="assistant"?I:1,auraStyle:H.role==="assistant"?tt[P]?.style:void 0,timestamp:new Date(H.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),isLiked:H.isLiked||!1,onLike:async(z,Z)=>{try{(await fetch(`/api/messages/${z}/like`,{method:Z?"DELETE":"POST",headers:{"Content-Type":"application/json"}})).ok&&m(ee=>ee.map(Re=>Re.id===z?{...Re,isLiked:!Z}:Re))}catch(q){console.error("Like error:",q)}}},H.id)),(R||F)&&d.jsx(d.Fragment,{children:b?d.jsx(Wn,{sender:"ai",senderName:h,content:b,mediaUrl:w||void 0,avatarUrl:y,auraClass:tt[P]?.aura,auraOpacity:I,auraStyle:tt[P]?.style,timestamp:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),isStreaming:!0}):d.jsx("div",{className:"flex justify-start ml-14 -mt-2",children:d.jsx(sa,{})})}),d.jsx("div",{className:"h-4"})]})}),d.jsx(oa,{onSend:B,onGift:ge,onOpenStore:()=>S(!0),userChocoBalance:ae,ownedHearts:pe,disabled:F||K}),d.jsx(Xo,{open:E,onOpenChange:S,itemId:"heart",paypalClientId:o,tossClientKey:a}),d.jsx(vn,{open:_,onOpenChange:ne,children:d.jsxs(wn,{children:[d.jsxs(Rn,{children:[d.jsx(En,{children:" "}),d.jsx(Cn,{children:"   ?      ,     ."})]}),d.jsxs(Sn,{children:[d.jsx(On,{children:""}),d.jsx(Tn,{onClick:()=>je(!1),disabled:V,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90 disabled:opacity-50 disabled:cursor-not-allowed",children:V?d.jsxs(d.Fragment,{children:[d.jsx(Zt,{size:"sm",className:"mr-2"})," ..."]}):""})]})]})}),d.jsx(vn,{open:ie,onOpenChange:fe,children:d.jsxs(wn,{children:[d.jsxs(Rn,{children:[d.jsx(En,{children:" "}),d.jsxs(Cn,{children:[h,"    ?      , ",h,"      ."]})]}),d.jsxs(Sn,{children:[d.jsx(On,{children:""}),d.jsx(Tn,{onClick:()=>je(!0),disabled:V,className:"disabled:opacity-50 disabled:cursor-not-allowed",children:V?d.jsxs(d.Fragment,{children:[d.jsx(Zt,{size:"sm",className:"mr-2"})," ..."]}):""})]})]})})]})});export{va as default};
