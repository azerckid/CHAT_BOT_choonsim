import{P as T,a as A,_ as D}from"./react-paypal-js-PCT-g0U3.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{r as l,u as I,c as _}from"./chunk-WWGJGFF6-C0NtPc5H.js";import{D as E,a as O,b as k,c as C,d as R,e as L,B as $}from"./dialog-Dd6_L6Vt.js";import{c as d}from"./utils-BQHNewu7.js";import{t as o}from"./index-XQpFve_7.js";import{C as p}from"./subscription-plans-B7yAUbGr.js";function K({open:P,onOpenChange:c,trigger:w,paypalClientId:b,tossClientKey:h}){const[r,j]=l.useState(p[1].id),[x,u]=l.useState("TOSS"),i=I(),g=_(),[m,y]=l.useState(!1),a=p.find(t=>t.id===r)||p[1];l.useEffect(()=>{if(typeof window<"u"&&window.navigator){const t=window.navigator.language.startsWith("ko");u(t?"TOSS":"PAYPAL")}},[]),l.useEffect(()=>{i.data?.success?(o.success("충전이 완료되었습니다!"),c&&c(!1),g.revalidate()):i.data?.error&&o.error(i.data.error)},[i.data,c,g]);const v=async(t,f)=>{const s=new FormData;s.append("orderId",t.orderID),s.append("packageId",r),i.submit(s,{method:"post",action:"/api/payment/capture-order"})},N=async()=>{if(!h||m){h||o.error("토스페이먼츠 설정 오류");return}y(!0);try{const{loadTossPayments:t}=await D(async()=>{const{loadTossPayments:S}=await import("./tosspayments.esm-BI8x_fjG.js");return{loadTossPayments:S}},[]),f=await t(h),s=`order_${Date.now()}_${Math.random().toString(36).slice(2,6)}`,n=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);await f.requestPayment("카드",{amount:a.priceKRW,orderId:s,orderName:a.name,successUrl:`${window.location.origin}/payment/toss/success?creditsGranted=${a.credits+a.bonus}&packageId=${a.id}&amount=${a.priceKRW}`,failUrl:`${window.location.origin}/payment/toss/fail?from=topup`,windowTarget:n?"self":void 0})}catch(t){console.error("Toss Payment Error:",t),o.error("결제 준비 중 오류가 발생했습니다."),y(!1)}};return e.jsxs(E,{open:P,onOpenChange:c,children:[w&&e.jsx(O,{children:w}),e.jsxs(k,{className:"sm:max-w-[500px] bg-background-dark border-white/10 text-white p-0 gap-0 overflow-hidden shadow-2xl rounded-3xl",children:[e.jsxs(C,{className:"p-6 bg-surface-dark/50 backdrop-blur-md border-b border-white/5",children:[e.jsx(R,{className:"text-xl font-bold tracking-tight text-white",children:"CHOCO Top Up"}),e.jsx(L,{className:"text-white/50 text-sm",children:"AI 캐릭터와 더 즐겁게 대화하기 위해 CHOCO를 충전하세요."})]}),e.jsxs("div",{className:"p-6 space-y-6 overflow-y-auto max-h-[80vh]",children:[e.jsx("div",{className:"grid grid-cols-1 gap-3",children:p.map(t=>e.jsxs("div",{className:d("relative flex items-center justify-between p-4 rounded-2xl border transition-all cursor-pointer group",r===t.id?"bg-primary/10 border-primary shadow-[0_0_20px_rgba(238,43,140,0.15)]":"bg-surface-dark border-white/5 hover:border-white/10 hover:bg-white/5"),onClick:()=>j(t.id),children:[t.isPopular&&e.jsx("div",{className:"absolute -top-3 left-6 px-3 py-1 bg-primary text-white text-[10px] font-bold uppercase tracking-wider rounded-full shadow-lg",children:"Popular"}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:d("text-base font-bold transition-colors",r===t.id?"text-primary":"text-white"),children:t.name}),t.bonus>0&&e.jsxs("span",{className:"text-xs font-medium text-green-400 flex items-center gap-1",children:[e.jsx("span",{className:"material-symbols-outlined text-[12px]",children:"verified"}),"+",t.bonus.toLocaleString()," Bonus"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-baseline justify-end gap-1",children:[e.jsx("span",{className:"text-xl font-bold text-white tracking-tight",children:(t.credits+t.bonus).toLocaleString()}),e.jsx("span",{className:"text-[10px] text-white/50 font-bold",children:"CHOCO"})]}),e.jsxs("div",{className:"text-sm font-semibold text-white/70",children:["₩",t.priceKRW.toLocaleString()," / $",t.price]})]})]},t.id))}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2 p-1 bg-white/5 rounded-xl border border-white/10 overflow-x-auto scrollbar-hide",children:[e.jsx("button",{onClick:()=>u("TOSS"),className:d("flex-1 min-w-[100px] py-2 text-[11px] font-bold rounded-lg transition-all",x==="TOSS"?"bg-white text-black shadow-lg":"text-white/50 hover:text-white"),children:"국내 (카드)"}),e.jsx("button",{onClick:()=>u("PAYPAL"),className:d("flex-1 min-w-[100px] py-2 text-[11px] font-bold rounded-lg transition-all",x==="PAYPAL"?"bg-[#ffc439] text-[#003087] shadow-lg":"text-white/50 hover:text-white"),children:"해외 (PayPal)"})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm min-h-[100px] flex flex-col justify-center",children:[x==="PAYPAL"?b?e.jsx(T,{options:{clientId:b,currency:"USD",intent:"capture"},children:e.jsx(A,{style:{layout:"vertical",shape:"rect",borderRadius:12,height:48,color:"gold",label:"pay"},forceReRender:[r],createOrder:async(t,f)=>{const n=await(await fetch("/api/payment/create-order",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({packageId:r})})).json();if(n.error)throw new Error(n.error);return n.orderId},onApprove:v,onCancel:()=>{o.info("결제가 취소되었습니다.")},onError:t=>{console.error("PayPal Error:",t),o.error("결제 처리 중 오류가 발생했습니다.")}})}):e.jsx("div",{className:"text-center text-red-500 py-4 text-xs font-bold",children:"PayPal Client ID 없음"}):x==="TOSS"?e.jsx($,{onClick:N,disabled:m,className:d("w-full h-12 bg-[#3182f6] hover:bg-[#1b64da] text-white rounded-xl font-bold flex items-center justify-center gap-2 transition-all",m&&"opacity-70 cursor-not-allowed"),children:m?e.jsx("div",{className:"size-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"material-symbols-outlined text-[20px]",children:"payments"}),"토스로 결제하기"]})}):null,e.jsx("p",{className:"text-center text-[10px] text-slate-400 mt-3 px-1",children:"결제 시 이용약관에 동의하게 됩니다."})]})]})]})]})]})}export{K as T};
