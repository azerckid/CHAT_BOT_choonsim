import{P as I,a as A,_}from"./react-paypal-js-PCT-g0U3.js";import{w as T,a as C,b as M,r as o,u as R}from"./chunk-WWGJGFF6-C0NtPc5H.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{S as O}from"./subscription-plans-B7yAUbGr.js";import{c as n}from"./utils-BQHNewu7.js";import{t as i}from"./index-XQpFve_7.js";import{D,b as B,c as L,d as U,e as F,B as $}from"./dialog-Dd6_L6Vt.js";import"./_commonjsHelpers-DaWZu8wl.js";import"./index-Dc7LDrXT.js";import"./index.min-BJIztz5B.js";const Z=T(function(){const{user:p,paypalClientId:g,tossClientKey:m}=C(),w=M(),[s,v]=o.useState(null),[h,u]=o.useState(!1),[l,b]=o.useState("TOSS"),c=R(),[d,y]=o.useState(!1);o.useEffect(()=>{if(typeof window<"u"&&window.navigator){const t=window.navigator.language.startsWith("ko");b(t?"TOSS":"PAYPAL")}},[]);const N=Object.values(O),j=t=>{switch(t){case"FREE":return"egg";case"BASIC":return"bolt";case"PREMIUM":return"diamond";case"ULTIMATE":return"crown";default:return"star"}},P=t=>{if(p?.subscriptionTier===t.tier||t.tier==="FREE"){t.tier==="FREE"&&p?.subscriptionTier!=="FREE"&&i.info("무료 플랜은 구독 만료 후 자동으로 적용됩니다.");return}v(t),u(!0)},k=async(t,r)=>{if(!s||!s.paypalPlanId)return;const a=new FormData;a.append("subscriptionId",t.subscriptionID),a.append("planId",s.paypalPlanId),c.submit(a,{method:"post",action:"/api/payment/activate-subscription"})},S=async()=>{if(!m||!s||d){m||i.error("토스페이먼츠 설정 오류");return}y(!0);try{const{loadTossPayments:t}=await _(async()=>{const{loadTossPayments:f}=await import("./tosspayments.esm-BI8x_fjG.js");return{loadTossPayments:f}},[]),r=await t(m),a=`sub_${s.tier.toLowerCase()}_${Date.now()}_${Math.random().toString(36).slice(2,6)}`,x=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);await r.requestPayment("카드",{amount:s.monthlyPriceKRW,orderId:a,orderName:`${s.name} 멤버십 (1개월)`,successUrl:`${window.location.origin}/payment/toss/success?type=SUBSCRIPTION&tier=${s.tier}&amount=${s.monthlyPriceKRW}`,failUrl:`${window.location.origin}/payment/toss/fail?from=subscription`,windowTarget:x?"self":void 0})}catch(t){console.error("Toss Subscription Error:",t),i.error("결제 준비 중 오류가 발생했습니다."),y(!1)}};return c.data?.success&&h?(u(!1),i.success("구독이 활성화되었습니다! 환영합니다."),w("/profile")):c.data?.error&&h&&i.error(c.data.error),e.jsxs("div",{className:"min-h-screen bg-[#0B0A10] text-foreground flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-[500px] h-[500px] bg-primary/20 rounded-full blur-[120px] -translate-x-1/2 -translate-y-1/2 opacity-50 pointer-events-none"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-[500px] h-[500px] bg-blue-600/20 rounded-full blur-[120px] translate-x-1/2 -translate-y-1/2 opacity-50 pointer-events-none"}),e.jsxs("header",{className:"sticky top-0 z-50 bg-[#0B0A10]/80 backdrop-blur-md border-b border-white/5 px-4 h-16 flex items-center justify-between max-w-md mx-auto w-full",children:[e.jsx("button",{onClick:()=>w(-1),className:"flex items-center justify-center text-white/80 hover:text-primary transition-colors size-10 rounded-full hover:bg-white/5",children:e.jsx("span",{className:"material-symbols-outlined text-[24px]",children:"arrow_back_ios_new"})}),e.jsx("h1",{className:"text-lg font-bold tracking-tight text-white uppercase",children:"Membership"}),e.jsx("div",{className:"w-10"})]}),e.jsxs("main",{className:"flex-1 max-w-md mx-auto w-full p-6 pb-32 space-y-8 relative z-10",children:[e.jsxs("div",{className:"text-center space-y-3 mb-8",children:[e.jsxs("h2",{className:"text-3xl font-black italic tracking-tighter text-white uppercase",children:["Level Up",e.jsx("br",{}),e.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-primary to-purple-500",children:"Your Experience"})]}),e.jsx("p",{className:"text-sm text-white/60 font-medium",children:"Unlock exclusive features & unlimited chats."})]}),e.jsx("div",{className:"space-y-5",children:N.map(t=>{const r=p?.subscriptionTier===t.tier,a=t.tier==="PREMIUM",x=t.tier==="ULTIMATE";return e.jsxs("div",{onClick:()=>P(t),className:n("relative p-6 rounded-3xl border backdrop-blur-sm transition-all duration-300 group cursor-pointer overflow-hidden",r?"bg-white/5 border-primary shadow-[0_0_30px_rgba(255,0,255,0.15)] ring-1 ring-primary":"bg-[#1A1821]/60 border-white/5 hover:bg-[#1A1821] hover:border-primary/50 hover:shadow-lg hover:-translate-y-1"),children:[a&&!r&&e.jsx("div",{className:"absolute top-0 right-0 px-4 py-1.5 bg-primary text-[#0B0A10] text-[11px] font-black uppercase tracking-wider rounded-bl-2xl shadow-[0_4px_20px_rgba(255,0,255,0.4)] z-20",children:"Most Popular"}),r&&e.jsx("div",{className:"absolute top-0 right-0 px-4 py-1.5 bg-white/10 text-primary text-[11px] font-black uppercase tracking-wider rounded-bl-2xl border-l border-b border-primary/20 z-20",children:"Current Plan"}),x&&e.jsx("div",{className:"absolute -top-10 -right-10 w-40 h-40 bg-yellow-500/20 rounded-full blur-3xl group-hover:bg-yellow-500/30 transition-colors"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-1/2 bg-gradient-to-t from-black/40 to-transparent pointer-events-none"}),e.jsxs("div",{className:"space-y-4 relative z-10",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:n("material-symbols-outlined text-[20px]",x?"text-yellow-400":a?"text-primary":t.tier==="FREE"?"text-slate-400":"text-blue-400"),children:j(t.tier)}),e.jsx("h3",{className:"text-lg font-bold tracking-tight text-white uppercase italic",children:t.name})]}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsxs("span",{className:"text-3xl font-black text-white tracking-tighter",children:["$",t.monthlyPrice]}),e.jsx("span",{className:"text-xs text-white/50 font-bold uppercase tracking-wider",children:"/ MO"})]})]})}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-white/10 to-transparent"}),e.jsx("ul",{className:"space-y-2.5",children:t.features.slice(0,4).map((f,E)=>e.jsxs("li",{className:"flex items-center gap-3 text-sm text-white/80 font-medium",children:[e.jsx("span",{className:"material-symbols-outlined text-[16px] text-primary shrink-0",children:"check_circle"}),e.jsx("span",{children:f})]},E))})]})]},t.tier)})}),e.jsx("div",{className:"h-4"})]}),e.jsx(D,{open:h,onOpenChange:u,children:e.jsxs(B,{className:"sm:max-w-[400px] bg-[#151419] border-white/10 text-white p-0 overflow-hidden rounded-[32px] shadow-2xl",children:[e.jsxs(L,{className:"p-8 bg-[#1A1821] border-b border-white/5 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-primary to-transparent opacity-50"}),e.jsxs("div",{className:"relative z-10 text-center space-y-2",children:[e.jsx("div",{className:"mx-auto w-12 h-12 rounded-full bg-white/5 flex items-center justify-center mb-4 border border-white/10",children:e.jsx("span",{className:"material-symbols-outlined text-primary text-2xl",children:j(s?.tier||"BASIC")})}),e.jsx(U,{className:"text-2xl font-black italic tracking-tight uppercase",children:s?.name}),e.jsx(F,{className:"text-white/60 font-medium pt-2",children:l==="TOSS"?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-primary text-lg font-bold",children:["₩",s?.monthlyPriceKRW.toLocaleString()]})," / 월"]}):e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-primary text-lg font-bold",children:["$",s?.monthlyPrice]})," / month"]})})]})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex gap-2 p-1 bg-white/5 rounded-xl border border-white/10",children:[e.jsx("button",{onClick:()=>b("TOSS"),className:n("flex-1 py-2 text-xs font-bold rounded-lg transition-all",l==="TOSS"?"bg-white text-black shadow-lg":"text-white/50 hover:text-white"),children:"국내 결제 (토스)"}),e.jsx("button",{onClick:()=>b("PAYPAL"),className:n("flex-1 py-2 text-xs font-bold rounded-lg transition-all",l==="PAYPAL"?"bg-[#ffc439] text-[#003087] shadow-lg":"text-white/50 hover:text-white"),children:"Global (PayPal)"})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm min-h-[100px] flex flex-col justify-center",children:[l==="PAYPAL"?g&&s?.paypalPlanId?e.jsx(I,{options:{clientId:g,vault:!0,intent:"subscription"},children:e.jsx(A,{style:{layout:"vertical",color:"black",shape:"rect",label:"subscribe",height:48},forceReRender:[s?.tier],createSubscription:(t,r)=>r.subscription.create({plan_id:s.paypalPlanId}),onApprove:k,onCancel:()=>{i.info("결제가 취소되었습니다.")},onError:t=>{console.error("PayPal Error:",t),i.error("결제 처리 중 오류가 발생했습니다.")}})}):e.jsx("div",{className:"text-red-500 text-center text-xs font-bold py-4 italic",children:"PayPal Config Error"}):e.jsx($,{onClick:S,disabled:d,className:n("w-full h-12 bg-[#3182f6] hover:bg-[#1b64da] text-white rounded-xl font-bold flex items-center justify-center gap-2 transition-all",d&&"opacity-70 cursor-not-allowed"),children:d?e.jsx("div",{className:"size-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"material-symbols-outlined text-[20px]",children:"payments"}),"멤버십 시작하기"]})}),e.jsxs("p",{className:"text-[10px] text-slate-400 text-center mt-3 px-1 leading-tight",children:["결제 시 이용약관에 동의하게 됩니다.",e.jsx("br",{}),"언제든지 해지할 수 있습니다."]})]})]})]})})]})});export{Z as default};
