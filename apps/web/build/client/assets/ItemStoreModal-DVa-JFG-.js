import{P as S,a as k,_}from"./react-paypal-js-PCT-g0U3.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{r as x,c as I}from"./chunk-WWGJGFF6-C0NtPc5H.js";import{D as T,b as A,c as E,d as D,e as R,B as O}from"./dialog-Dd6_L6Vt.js";import{t as s}from"./index-XQpFve_7.js";import{c as o}from"./utils-BQHNewu7.js";const K={HEART:{id:"heart",name:"하트",type:"GIFT",iconUrl:"favorite",description:"아이돌에게 사랑을 전하는 가장 기본적인 방법입니다.",priceChoco:1500}},y=[{id:"heart_pack_1",itemId:"heart",name:"하트 작은 상자",quantity:10,priceKRW:1500,priceUSD:1.2,description:"가볍게 마음을 전하기 좋아요.",image:"https://cdn-icons-png.flaticon.com/512/1077/1077035.png"},{id:"heart_pack_2",itemId:"heart",name:"하트 큰 상자",quantity:50,priceKRW:7e3,priceUSD:5.5,description:"듬뿍 담긴 하트로 응원해주세요!",image:"https://cdn-icons-png.flaticon.com/512/3128/3128313.png",isPopular:!0},{id:"heart_pack_3",itemId:"heart",name:"하트 보물상자",quantity:100,priceKRW:13e3,priceUSD:10,description:"당신은 최고의 팬입니다!",image:"https://cdn-icons-png.flaticon.com/512/2859/2859706.png"}];function L({open:h,onOpenChange:c,itemId:U="heart",paypalClientId:w,tossClientKey:m}){const[a,f]=x.useState(y[1].id),[u,b]=x.useState("TOSS"),[d,l]=x.useState(!1),v=I(),g=y,r=g.find(t=>t.id===a)||g[1];x.useEffect(()=>{if(typeof window<"u"&&window.navigator){const t=window.navigator.language.startsWith("ko");b(t?"TOSS":"PAYPAL")}},[]);const j=async()=>{if(!m||d){m||s.error("결제 시스템 설정 오류");return}l(!0);try{const{loadTossPayments:t}=await _(async()=>{const{loadTossPayments:N}=await import("./tosspayments.esm-BI8x_fjG.js");return{loadTossPayments:N}},[]),i=await t(m),p=`item_${Date.now()}_${Math.random().toString(36).slice(2,6)}`,n=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);await i.requestPayment("카드",{amount:r.priceKRW,orderId:p,orderName:`${r.name} (${r.quantity}개)`,successUrl:`${window.location.origin}/payment/toss/success?type=ITEM&itemId=${r.itemId}&quantity=${r.quantity}&packageId=${r.id}&amount=${r.priceKRW}`,failUrl:`${window.location.origin}/payment/toss/fail?from=store`,windowTarget:n?"self":void 0})}catch(t){console.error("Toss Payment Error:",t),s.error("결제 준비 중 오류가 발생했습니다."),l(!1)}},P=async(t,i)=>{l(!0);try{const n=await(await fetch("/api/payment/item/capture-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:t.orderID,packageId:a})})).json();n.success?(s.success(`${n.quantityAdded}개의 하트가 인벤토리에 추가되었습니다!`),c(!1),v.revalidate()):s.error(n.error||"결제 처리 중 오류가 발생했습니다.")}catch(p){console.error("PayPal Capture Error:",p),s.error("결제 승인 처리 중 오류가 발생했습니다.")}finally{l(!1)}};return e.jsx(T,{open:h,onOpenChange:c,children:e.jsxs(A,{className:"sm:max-w-[500px] bg-[#1A1018] border-white/10 text-white p-0 gap-0 overflow-hidden shadow-[0_0_50px_rgba(238,43,140,0.2)] rounded-[32px]",children:[e.jsxs(E,{className:"p-8 bg-gradient-to-b from-[#2d1622]/80 to-transparent backdrop-blur-xl border-b border-white/5 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-[-50px] left-[-50px] w-32 h-32 bg-primary/20 rounded-full blur-[60px]"}),e.jsxs(D,{className:"text-2xl font-black italic tracking-tighter text-white uppercase flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-primary text-[32px] filled",children:"favorite"}),"Heart ",e.jsx("span",{className:"text-primary",children:"Store"})]}),e.jsx(R,{className:"text-white/50 text-sm font-medium mt-1",children:"아이돌에게 보낼 소중한 마음을 충전하세요."})]}),e.jsxs("div",{className:"p-8 space-y-8 overflow-y-auto max-h-[70vh] no-scrollbar",children:[e.jsx("div",{className:"grid grid-cols-1 gap-4",children:g.map(t=>e.jsxs("div",{className:o("relative flex items-center gap-5 p-5 rounded-[24px] border transition-all cursor-pointer group hover:scale-[1.02]",a===t.id?"bg-primary/10 border-primary/50 shadow-[0_0_30px_rgba(238,43,140,0.2)]":"bg-white/2 border-white/5 hover:border-white/20 hover:bg-white/5"),onClick:()=>f(t.id),children:[t.isPopular&&e.jsx("div",{className:"absolute -top-3 right-6 px-3 py-1 bg-primary text-white text-[10px] font-black uppercase tracking-widest rounded-full shadow-[0_0_15px_rgba(238,43,140,0.5)] z-10",children:"Best Choice"}),e.jsxs("div",{className:"relative shrink-0 w-16 h-16 rounded-2xl bg-[#2d1622] flex items-center justify-center p-2 border border-white/5 overflow-hidden group-hover:border-primary/30 transition-colors",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsx("img",{src:t.image,alt:t.name,className:"w-10 h-10 object-contain relative z-10 group-hover:scale-110 transition-transform duration-500"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:o("text-lg font-bold tracking-tight mb-0.5 transition-colors",a===t.id?"text-primary":"text-white"),children:t.name}),e.jsx("p",{className:"text-xs text-white/40 font-medium truncate",children:t.description}),e.jsx("div",{className:"mt-2 flex items-center gap-1.5",children:e.jsxs($,{className:"bg-primary/20 text-primary border-none text-[10px] px-2 py-0.5 font-black uppercase tracking-tighter",children:[t.quantity," Hearts"]})})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-[10px] font-black text-white/30 uppercase tracking-widest leading-none mb-1",children:"Price"}),e.jsxs("div",{className:"text-lg font-black text-white italic tracking-tighter leading-none",children:["₩",t.priceKRW.toLocaleString()]}),e.jsxs("div",{className:"text-[10px] text-white/20 font-bold mt-1",children:["$",t.priceUSD.toFixed(1)]})]})]},t.id))}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2 p-1.5 bg-white/3 rounded-[20px] border border-white/5",children:[e.jsx("button",{onClick:()=>b("TOSS"),className:o("flex-1 py-3 text-xs font-black uppercase tracking-widest rounded-[14px] transition-all",u==="TOSS"?"bg-white text-black shadow-xl":"text-white/30 hover:text-white"),children:"Toss Pay"}),e.jsx("button",{onClick:()=>b("PAYPAL"),className:o("flex-1 py-3 text-xs font-black uppercase tracking-widest rounded-[14px] transition-all",u==="PAYPAL"?"bg-[#ffc439] text-[#003087] shadow-xl":"text-white/30 hover:text-white"),children:"PayPal"})]}),e.jsx("div",{className:"bg-white/2 rounded-[28px] p-2 border border-white/5 backdrop-blur-xl",children:u==="TOSS"?e.jsx(O,{onClick:j,disabled:d,className:o("w-full h-16 bg-primary hover:bg-primary-dark text-black rounded-[22px] font-black italic text-lg tracking-tighter transition-all shadow-[0_10px_30px_rgba(238,43,140,0.3)] hover:shadow-[0_15px_40px_rgba(238,43,140,0.5)] active:scale-95",d&&"opacity-70 cursor-not-allowed"),children:d?e.jsx("div",{className:"size-6 border-3 border-black/30 border-t-black rounded-full animate-spin"}):"PURCHASE NOW"}):e.jsx("div",{className:"p-2 bg-white rounded-[22px]",children:w?e.jsx(S,{options:{clientId:w,currency:"USD",intent:"capture"},children:e.jsx(k,{style:{layout:"vertical",shape:"rect",borderRadius:12,height:55,color:"gold",label:"pay"},forceReRender:[a],createOrder:async()=>{try{const i=await(await fetch("/api/payment/item/create-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({packageId:a})})).json();if(i.orderId)return i.orderId;throw new Error(i.error||"Failed to create order")}catch(t){throw console.error("PayPal Create Order Error:",t),s.error("결제 주문 생성에 실패했습니다."),t}},onApprove:P})}):e.jsx("div",{className:"text-center text-black/40 py-4 text-xs font-bold",children:"PayPal Unavailable"})})})]})]}),e.jsx("div",{className:"p-6 bg-white/2 border-t border-white/5 text-center",children:e.jsxs("p",{className:"text-[10px] text-white/20 font-bold uppercase tracking-widest",children:["Your purchase supports the creators. ",e.jsx("br",{}),"Secure transaction powered by global gateways."]})})]})})}const $=({children:h,className:c})=>e.jsx("span",{className:o("px-2 py-1 rounded inline-flex",c),children:h});export{L as I,K as a};
