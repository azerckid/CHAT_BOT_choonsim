import{b as k,L as b,w,a as y,r as j}from"./chunk-WWGJGFF6-C0NtPc5H.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{c as a}from"./utils-BQHNewu7.js";import{B as A}from"./BottomNavigation-vdZES2hj.js";import{S as m,E as C,N as S}from"./NetworkError-CKNiMwbG.js";import{D as O,a as I,b as L,c as T,d as z}from"./dialog-Dd6_L6Vt.js";import"./_commonjsHelpers-DaWZu8wl.js";import"./index.min-BJIztz5B.js";import"./index-Dc7LDrXT.js";function D({id:d,name:n,lastMessage:o,timestamp:c,avatarUrl:s,unreadCount:x,isRead:i=!1,isOnline:p=!1,messageType:h="text",characterId:u,className:f}){const g=k(),t=h==="voice"?{icon:"mic",colors:"bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-300"}:h==="music"?{icon:"music_note",colors:"bg-purple-100 dark:bg-purple-900/50 text-purple-600 dark:text-purple-300"}:null,r=u?`/character/${u}`:null;return e.jsxs("div",{className:a("group relative flex items-center gap-4 p-3 rounded-2xl hover:bg-white hover:shadow-sm dark:hover:bg-surface-dark dark:hover:shadow-none transition-all mb-1",f),children:[r?e.jsxs(b,{to:r,className:"relative shrink-0",onClick:l=>l.stopPropagation(),children:[e.jsx("div",{className:a("w-14 h-14 rounded-xl bg-cover bg-center",i&&"grayscale-[20%]"),style:{backgroundImage:`url("${s}")`}}),t&&e.jsx("div",{className:"absolute -bottom-1 -right-1 bg-white dark:bg-surface-dark p-[2px] rounded-full",children:e.jsx("span",{className:a("material-symbols-outlined text-sm rounded-full p-0.5",t.colors),style:{fontSize:"14px"},children:t.icon})})]}):e.jsxs("div",{className:"relative shrink-0",children:[e.jsx("div",{className:a("w-14 h-14 rounded-xl bg-cover bg-center",i&&"grayscale-[20%]"),style:{backgroundImage:`url("${s}")`}}),t&&e.jsx("div",{className:"absolute -bottom-1 -right-1 bg-white dark:bg-surface-dark p-[2px] rounded-full",children:e.jsx("span",{className:a("material-symbols-outlined text-sm rounded-full p-0.5",t.colors),style:{fontSize:"14px"},children:t.icon})})]}),e.jsxs(b,{to:`/chat/${d}`,className:"flex-1 min-w-0 cursor-pointer",children:[e.jsxs("div",{className:"flex justify-between items-baseline mb-0.5",children:[r?e.jsx("button",{type:"button",onClick:l=>{l.preventDefault(),l.stopPropagation(),g(r)},className:a("text-base font-bold truncate block hover:underline text-left bg-transparent border-none p-0 cursor-pointer",i?"text-slate-700 dark:text-gray-200":"text-slate-900 dark:text-white"),children:n}):e.jsx("h3",{className:a("text-base font-bold truncate",i?"text-slate-700 dark:text-gray-200":"text-slate-900 dark:text-white"),children:n}),e.jsx("span",{className:a("text-xs font-medium",i?"text-gray-400 dark:text-gray-500":x?"text-primary":"text-gray-500 dark:text-text-muted"),children:c})]}),e.jsx("p",{className:a("text-sm truncate",i?"text-slate-400 dark:text-gray-500":"text-slate-600 dark:text-gray-300 font-medium"),children:o})]}),e.jsx("div",{className:"shrink-0 flex flex-col items-end gap-1",children:x&&x>0?e.jsx("div",{className:"w-5 h-5 bg-primary rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-[10px] font-bold text-white",children:x})}):i?e.jsx("span",{className:"material-symbols-outlined text-base text-gray-400 dark:text-gray-600",children:"done_all"}):null})]})}function _({idols:d,onIdolClick:n,onAddClick:o,className:c}){return e.jsxs("section",{className:a("pt-6 pb-2",c),children:[e.jsx("div",{className:"px-4 mb-3 flex items-center justify-between",children:e.jsx("h2",{className:"text-sm font-semibold uppercase tracking-wider text-gray-500 dark:text-text-muted",children:"Online Now"})}),e.jsxs("div",{className:"flex overflow-x-auto no-scrollbar px-4 gap-4 pb-4 snap-x",children:[e.jsxs("div",{onClick:o,className:"flex flex-col items-center gap-2 shrink-0 snap-start cursor-pointer",children:[e.jsx("div",{className:"w-[72px] h-[72px] rounded-full border-2 border-dashed border-gray-300 dark:border-white/20 flex items-center justify-center hover:bg-black/5 dark:hover:bg-white/5 transition-colors",children:e.jsx("span",{className:"material-symbols-outlined text-3xl text-primary",children:"add"})}),e.jsx("span",{className:"text-xs font-medium text-center w-16 truncate opacity-60",children:"Add"})]}),d.map(s=>e.jsxs("div",{onClick:()=>n?.(s.id),className:"flex flex-col items-center gap-2 shrink-0 snap-start cursor-pointer group",children:[e.jsxs("div",{className:a("relative p-[3px] rounded-full transition-all duration-300",s.isOnline?"bg-gradient-to-tr from-primary to-purple-400 group-hover:scale-105":"border-2 border-gray-200 dark:border-white/10 group-hover:border-primary/50"),children:[e.jsx("div",{className:"w-[66px] h-[66px] rounded-full bg-background-light dark:bg-background-dark p-[2px]",children:e.jsx("div",{className:a("w-full h-full rounded-full bg-cover bg-center",!s.isOnline&&"grayscale-[30%]"),style:{backgroundImage:`url("${s.avatarUrl}")`}})}),s.isOnline&&e.jsx("div",{className:"absolute bottom-1 right-1 w-3.5 h-3.5 bg-green-500 border-2 border-background-dark rounded-full"})]}),e.jsx("span",{className:a("text-xs font-medium text-center w-16 truncate",!s.isOnline&&"text-gray-500 dark:text-text-muted"),children:s.name})]},s.id))]})]})}function E(){return e.jsx("div",{className:"flex flex-col px-2",children:Array.from({length:5}).map((d,n)=>e.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-2xl mb-1",children:[e.jsx(m,{variant:"circular",className:"w-14 h-14 shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-baseline mb-2",children:[e.jsx(m,{className:"w-20 h-4 rounded"}),e.jsx(m,{className:"w-12 h-3 rounded"})]}),e.jsx(m,{className:"w-full h-4 rounded"})]}),e.jsx(m,{variant:"circular",className:"w-5 h-5 shrink-0"})]},n))})}function B({message:d="서버 오류가 발생했습니다. 잠시 후 다시 시도해주세요.",onRetry:n,className:o}){return e.jsx(C,{title:"서버 오류",message:d,onRetry:n,className:o})}const F=w(function(){const{conversations:n,allCharacters:o}=y(),[c,s]=j.useState("idle"),[x,i]=j.useState(!1),p=k(),h=t=>{p(`/character/${t}`)},u=async t=>{try{s("loading");const r=await fetch("/api/chat/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({characterId:t})});if(!r.ok)throw new Error("Failed to create chat");const l=await r.json();p(`/chat/${l.conversationId}`)}catch(r){console.error("Chat creation error:",r),s("error"),setTimeout(()=>s("idle"),2e3)}},f=o.map(t=>({id:t.id,name:t.name,avatarUrl:t.media?.find(r=>r.type==="AVATAR")?.url||t.media?.[0]?.url,isOnline:t.isOnline})),g=()=>{s("loading"),setTimeout(()=>{s("idle")},1e3)};return e.jsxs("div",{className:"bg-background-light dark:bg-background-dark font-display text-slate-900 dark:text-white min-h-screen relative overflow-x-hidden selection:bg-primary selection:text-white pb-24 max-w-md mx-auto md:max-w-lg lg:max-w-xl",children:[e.jsxs("header",{className:"sticky top-0 z-40 bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-md border-b border-gray-200 dark:border-white/5 px-4 pt-12 pb-3 flex items-center justify-between transition-colors duration-300",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-cover bg-center ring-2 ring-gray-200 dark:ring-white/10",style:{backgroundImage:'url("https://lh3.googleusercontent.com/aida-public/AB6AXuCVl0hrpoB1yOAKpQmi-_0n7ICqjGaew6qKzz_Gn8CbqiQL1TBgAMDihfIzH7NO8Kir1bL6J_gs-qj0PzAlVN-0TM1Py8H0_3TOtix5p0aql-mvaSLfSbA290FDgIwdBcPIYdPe53zzyV5MDn_BXBDETX3SZX_aoWMl3hh_NIS59fdAciuwSHR-AoKLwEeh2jIaNjLb0MTt70Uv5AzH3-4cfSZ7zkxkEY0Pj82wFASAxuhtYWy-IwB4kj9mN8N7xCmOj_sTq6L2f30")'}}),e.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-background-light dark:border-background-dark"})]}),e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Messages"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{to:"/search",className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-black/5 dark:hover:bg-white/10 transition-colors",children:e.jsx("span",{className:"material-symbols-outlined text-2xl text-gray-600 dark:text-text-muted",children:"search"})}),e.jsx(b,{to:"/settings",className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-black/5 dark:hover:bg-white/10 transition-colors",children:e.jsx("span",{className:"material-symbols-outlined text-2xl text-gray-600 dark:text-text-muted",children:"settings"})})]})]}),e.jsx(_,{idols:f,onIdolClick:h,onAddClick:()=>i(!0)}),e.jsxs("main",{className:"mt-2 flex flex-col px-2",children:[e.jsx("div",{className:"px-4 py-2",children:e.jsx("h2",{className:"text-sm font-semibold uppercase tracking-wider text-gray-500 dark:text-text-muted",children:"Recent Chats"})}),c==="loading"?e.jsx(E,{}):c==="network-error"?e.jsx(S,{onRetry:g}):c==="error"?e.jsx(B,{onRetry:g}):n.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 px-4 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mb-4",children:e.jsx("span",{className:"material-symbols-outlined text-primary text-3xl",children:"chat_bubble"})}),e.jsx("h3",{className:"text-lg font-bold mb-1",children:"새로운 대화를 시작해보세요!"}),e.jsx("p",{className:"text-sm text-slate-500",children:"춘심이가 당신의 연락을 기다리고 있어요."})]}):n.map(t=>{const r=t.messages?.[0],l=t.character,N=l?.media?.find(v=>v.type==="AVATAR")?.url||l?.media?.[0]?.url;return e.jsx(D,{id:t.id,name:l?.name||"AI",lastMessage:r?.content||"대화를 시작해보세요",timestamp:r?new Date(r.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"",avatarUrl:N,isRead:r?r.read:!0,isOnline:l?.isOnline||!1,characterId:l?.id},t.id)})]}),e.jsxs(O,{open:x,onOpenChange:i,children:[e.jsx(I,{render:e.jsx("button",{className:"fixed bottom-24 right-4 z-30 w-14 h-14 bg-slate-900 dark:bg-primary text-white rounded-full shadow-lg dark:shadow-primary/30 flex items-center justify-center hover:scale-105 active:scale-95 transition-all",children:e.jsx("span",{className:"material-symbols-outlined text-2xl",children:"add_comment"})})}),e.jsxs(L,{className:"max-w-sm max-h-[80vh] overflow-y-auto",children:[e.jsx(T,{children:e.jsx(z,{children:"새 대화 시작하기"})}),e.jsx("div",{className:"grid gap-4 py-4",children:o.map(t=>e.jsxs("button",{onClick:()=>{u(t.id),i(!1)},className:"flex items-center gap-4 p-2 rounded-xl hover:bg-slate-100 dark:hover:bg-white/5 transition-colors text-left",children:[e.jsxs("div",{className:"relative flex-none",children:[e.jsx("img",{src:t.media?.find(r=>r.type==="AVATAR")?.url||t.media?.[0]?.url,alt:t.name,className:"w-12 h-12 rounded-full object-cover"}),t.isOnline&&e.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-background-light dark:border-background-dark"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-bold text-slate-900 dark:text-white truncate",children:t.name}),e.jsx("p",{className:"text-xs text-slate-500 line-clamp-1",children:t.role})]})]},t.id))})]})]}),e.jsx(A,{}),e.jsx("div",{className:"pointer-events-none fixed bottom-0 left-0 w-full h-32 bg-gradient-to-t from-background-light dark:from-background-dark to-transparent z-10"})]})});export{F as default};
