# Admin 페이지 기능 요구사항

이 문서는 캐릭터 콘텐츠 관리 및 서비스 운영을 위한 Admin 페이지의 기능 목록을 정리합니다.

---

## Admin 페이지 구조 개요

Admin 페이지는 크게 **2가지 주요 영역**으로 구분됩니다:

### Part 1: 캐릭터 콘텐츠 관리 (Content Management)
캐릭터(춘심, 소라, 미나 등)의 콘텐츠를 관리하는 영역
- 캐릭터 정보 관리 (프로필, 페르소나 프롬프트)
- 사진/동영상 갤러리 관리
- 캐릭터 추가/삭제

### Part 2: 사용자 및 운영 관리 (User & Operations Management)
서비스 운영과 사용자 관리를 위한 영역
- 사용자 관리 및 통계
- 결제/구독 관리
- 대화/메시지 관리
- 시스템 모니터링
- 콘텐츠 관리 (뉴스, 미션 등)

---

## Part 1: 캐릭터 콘텐츠 관리 (Character Content Management) ⭐ 핵심 기능

### 1. 캐릭터 관리 (Character Management)

### 1.1 캐릭터 목록
- 캐릭터 목록 표시 (테이블 또는 카드 형태)
  - ID, 이름, 역할, 온라인 상태, 아바타 미리보기
  - 생성일, 최종 수정일
- 검색 및 필터링
  - 이름으로 검색
  - 역할별 필터 (Main AI, K-Pop Idol, Fashion Model 등)
  - 온라인 상태별 필터
- 정렬 기능
  - 이름순, 생성일순, 최종 수정일순

### 1.2 캐릭터 정보 편집
- 기본 정보 관리
  - `id`: 캐릭터 ID (편집 불가, 생성 시 고정)
  - `name`: 캐릭터 이름
  - `role`: 역할 (Main AI, K-Pop Idol, Singer Songwriter 등)
  - `bio`: 짧은 소개 문구
  - `isOnline`: 온라인 상태 (토글)
- 아바타 이미지 관리
  - 현재 아바타 이미지 미리보기
  - Cloudinary 업로드를 통한 아바타 이미지 변경
  - URL 직접 입력 옵션
- 페르소나 프롬프트 편집
  - `personaPrompt`: 긴 텍스트 에디터 (코드 에디터 또는 마크다운 에디터)
  - 프롬프트 템플릿 기능 (자주 사용하는 프롬프트 저장)
  - 프롬프트 미리보기 및 테스트 기능
  - 프롬프트 버전 관리 (선택사항)

### 1.3 캐릭터 사진 갤러리 관리
- 사진 갤러리 목록
  - 현재 등록된 사진들 그리드/리스트 표시
  - 각 사진 미리보기
  - 사진 순서 표시 (현재는 인덱스 기반, `[PHOTO:0]`, `[PHOTO:1]` 등)
- 사진 업로드
  - Cloudinary를 통한 이미지 업로드
  - 여러 장 일괄 업로드 지원
  - 업로드 진행률 표시
  - 이미지 최적화 (자동 리사이징, 포맷 변환)
- 사진 관리
  - 사진 삭제 (Cloudinary에서도 함께 삭제)
  - 사진 순서 변경 (드래그 앤 드롭 또는 위/아래 버튼)
  - 사진별 설명/태그 추가 (선택사항)
- 사진 URL 직접 입력
  - 외부 URL로 이미지 추가 옵션

### 1.4 캐릭터 동영상 갤러리 관리 (향후 확장)
- 동영상 갤러리 목록
  - 현재 등록된 동영상들 그리드/리스트 표시
  - 각 동영상 미리보기 (썸네일)
  - 동영상 재생 시간 표시
  - 동영상 순서 표시
- 동영상 업로드
  - Cloudinary를 통한 동영상 업로드
  - 동영상 파일 형식 지원 (MP4, WebM 등)
  - 업로드 진행률 표시
  - 동영상 최적화 (압축, 포맷 변환)
- 동영상 관리
  - 동영상 삭제 (Cloudinary에서도 함께 삭제)
  - 동영상 순서 변경
  - 동영상별 설명/태그 추가 (선택사항)
- 동영상 URL 직접 입력
  - 외부 URL로 동영상 추가 옵션 (YouTube, Vimeo 등)

### 1.5 캐릭터 생성
- 새 캐릭터 추가
  - 기본 정보 입력 폼
  - 필수 필드: id, name, role, bio
  - 선택 필드: avatarUrl, isOnline (기본값: false)
  - 초기 페르소나 프롬프트 입력
- 캐릭터 복제
  - 기존 캐릭터를 복사하여 새 캐릭터 생성 (템플릿 활용)

### 1.6 캐릭터 삭제
- 캐릭터 삭제 기능
  - 삭제 전 확인 다이얼로그
  - 관련 데이터 확인 (대화방 수, 메시지 수 등)
  - 관련 아바타/사진 Cloudinary 삭제 (선택사항)

---

## Part 2: 사용자 및 운영 관리 (User & Operations Management)

### 2. 사용자 관리 (User Management)

### 2.1 사용자 목록
- 사용자 목록 표시
  - ID, 이메일, 이름, 가입일, 최종 접속일
  - 프로필 이미지 미리보기
  - 구독 등급 (FREE, BASIC, PREMIUM, ULTIMATE)
- 검색 및 필터링
  - 이메일/이름으로 검색
  - 구독 등급별 필터
  - 가입일 기간 필터
- 정렬 기능
  - 가입일순, 최종 접속일순, 이름순

### 2.2 사용자 상세 정보
- 사용자 프로필 정보
  - 기본 정보 (이메일, 이름, 프로필 이미지)
  - 가입일, 최종 접속일
  - 인증 제공자 (local, google 등)
- 사용자 통계
  - 총 대화방 수
  - 총 메시지 수
  - 함께한 날 수
  - 총 사용 시간 (세션 시간 합계)
  - 평균 세션 시간
  - 최종 접속일 및 시간
  - 친밀도 레벨 (Phase 9 기능)
- 설정 정보
  - 구독 등급 (변경 가능)
  - 체크인 시간 (`checkInTime`)
  - 푸시 알림 구독 여부
  - 페르소나 모드 (아이돌/애인/하이브리드)

### 2.3 사용자 관리 기능
- 구독 등급 변경
  - 드롭다운 또는 버튼으로 등급 선택
  - 변경 이력 기록 (선택사항)
- 사용자 차단/삭제
  - 사용자 계정 비활성화
  - 사용자 계정 영구 삭제 (관련 데이터 포함)
  - 삭제 전 확인 및 경고

### 2.4 결제/구독 통계
- 결제 현황 요약
  - 전체 유료 사용자 수
  - 등급별 유료 사용자 수 (BASIC, PREMIUM, ULTIMATE)
  - 월간/연간 매출 (실제 결제 시스템 연동 시)
  - 평균 구독 기간
  - 구독 취소율
- 결제 이력 조회 (실제 결제 시스템 연동 시)
  - 사용자별 결제 내역
  - 결제일, 결제 금액, 결제 방법
  - 구독 시작일, 만료일
  - 결제 상태 (성공, 실패, 환불 등)
  - 자동 갱신 여부
- 구독 분석
  - 신규 구독자 수 (일별/월별)
  - 구독 연장율
  - 등급별 전환율 (FREE → BASIC → PREMIUM → ULTIMATE)
  - 구독 해지 추이
- 결제 통계 차트
  - 일별/월별 매출 추이
  - 등급별 사용자 분포 (파이 차트)
  - 구독 전환율 추이
  - 결제 방법별 분포

---

### 3. 대화/메시지 관리 (Conversation & Message Management)

### 3.1 대화방 목록
- 대화방 목록 표시
  - 대화방 ID, 제목, 캐릭터, 사용자
  - 생성일, 최종 메시지 시간
  - 메시지 수
- 검색 및 필터링
  - 사용자 이메일/이름으로 검색
  - 캐릭터별 필터
  - 날짜 기간 필터
- 정렬 기능
  - 최신 메시지순, 생성일순

### 3.2 대화방 상세
- 대화 내용 조회
  - 전체 메시지 내역 표시
  - 메시지별 타임스탬프, 발신자 정보
  - 이미지/미디어 메시지 표시
- 대화방 관리
  - 대화방 삭제 (관련 메시지 및 미디어 파일 포함)
  - 대화방 초기화 (메시지 삭제, 메모리 초기화)
- 통계 정보
  - 총 메시지 수
  - 사용자 메시지 수 / AI 메시지 수
  - 평균 응답 시간 (선택사항)

### 3.3 메시지 관리
- 메시지 검색
  - 키워드 검색 (전체 메시지 또는 특정 대화방)
  - 날짜 범위 검색
- 메시지 삭제
  - 특정 메시지 삭제
  - 메시지와 연관된 미디어 파일 삭제

---

### 4. 콘텐츠 관리 (Service Content Management) - Phase 9 기능
**참고**: 캐릭터 콘텐츠 관리(Part 1)와는 별도로, 서비스 운영을 위한 콘텐츠 관리

### 4.1 뉴스/이벤트 관리
- 뉴스 목록
  - 제목, 타입 (Event, Shop, Announcement), 발행일, 활성화 상태
- 뉴스 작성/편집
  - 제목, 내용, 이미지 업로드
  - 타입 선택
  - 발행일 설정
  - 활성화/비활성화 토글
  - 상세 페이지 링크 설정
- 뉴스 삭제

### 4.2 미션 관리
- 미션 목록
  - 제목, 타입 (daily, weekly, achievement), 보상 XP, 활성화 상태
- 미션 작성/편집
  - 제목, 설명
  - 미션 타입 선택
  - 보상 XP 설정
  - 완료 조건 설정 (JSON 형태)
  - 캐릭터별 미션 할당
  - 활성화/비활성화 토글
- 미션 삭제

### 4.3 팬 피드 관리 (FanPost)
**주의**: 현재 DB에 존재하는 `Tweet` 테이블은 타 프로젝트용이므로 **절대 사용하지 않습니다**. 이 기능을 위해서는 별도의 `FanPost` 테이블을 신규 생성해야 합니다.
- 팬 피드(FanPost) 목록
  - 작성자, 캐릭터, 카테고리, 좋아요 수, 댓글 수, 작성일
- 팬 피드 관리
  - 부적절한 콘텐츠 삭제
  - 카테고리 변경
  - 공개/비공개 설정

---

## 5. 시스템 모니터링 (System Monitoring)

### 5.1 대시보드
- 주요 지표 요약
  - 전체 사용자 수
  - 활성 사용자 수 (DAU, MAU)
  - 총 대화방 수
  - 오늘 생성된 메시지 수
  - 총 캐릭터 수
  - 유료 사용자 수 및 비율
  - 월간 매출 (실제 결제 시스템 연동 시)
- 그래프 및 차트
  - 일별 사용자 증가 추이
  - 일별 메시지 수 추이
  - 캐릭터별 인기 순위
  - 구독 등급별 사용자 분포
  - 일별/월별 매출 추이 (실제 결제 시스템 연동 시)

### 5.2 API 사용량 모니터링
- Gemini API 사용량
  - 일별/월별 API 호출 수
  - 토큰 사용량
  - 비용 추정 (선택사항)
- Cloudinary 사용량
  - 저장된 이미지 수
  - 저장 용량
  - 업로드/삭제 활동

### 5.3 에러 로그
- 에러 로그 조회
  - 에러 타입별 필터
  - 날짜 범위 필터
  - 에러 상세 정보 확인

### 5.4 크론 잡 모니터링
- 크론 잡 실행 상태
  - 체크인 메시지 전송 성공/실패
  - 실행 시간 로그
  - 실패한 작업 재실행 기능

---

## 6. 설정 관리 (Settings)

### 6.1 시스템 설정
- AI 설정
  - Gemini API 키 관리
  - 기본 페르소나 모드 설정
  - Guardrail 설정 (전역)
- Cloudinary 설정
  - Cloudinary 인증 정보 확인
  - 업로드 설정 (폴더 구조, 최적화 옵션)
- 인증 설정
  - OAuth 제공자 설정 (Google 등)
  - 세션 만료 시간 설정

### 6.2 Admin 계정 관리 및 접근 제어 전략 (Access Control)
- **접근 제어 방식 (Hybrid Strategy)**
  - **1단계: 환경 변수 (Super Admin)**:
    - 초기 관리자 설정을 위해 서버 환경 변수 `ADMIN_EMAILS`에 관리자 이메일 목록을 등록 (콤마로 구분, 예: `admin@test.com,ceo@test.com`)
    - 해당 이메일로 로그인한 사용자는 DB Role과 무관하게 무조건 Admin 권한 부여 (Hardcoding 대안)
  - **2단계: DB Role (Scalable Admin)**:
    - `User` 테이블의 `role`이 `ADMIN`인 사용자에게 접근 권한 부여
    - Super Admin이 Admin 페이지 내에서 다른 사용자의 등급을 `ADMIN`으로 승격시킬 수 있는 기능 제공
- Admin 사용자 목록
- Admin 계정 권한 회수 (Role을 다시 USER로 변경)

---

## 7. 데이터 관리 (Data Management)

### 7.1 데이터베이스 백업
- 수동 백업 트리거
- 백업 파일 다운로드
- 백업 이력 조회

### 7.2 데이터 정리
- 사용하지 않는 미디어 파일 정리
- 오래된 메시지 아카이빙 (선택사항)
- 비활성 사용자 데이터 정리

### 7.3 데이터 내보내기
- 특정 사용자 데이터 내보내기
- 전체 데이터 내보내기 (GDPR 준수)

---

## 8. UI/UX 요구사항

### 8.1 레이아웃
- 사이드바 네비게이션
  - 주요 메뉴: 대시보드, 캐릭터, 사용자, 대화, 콘텐츠, 설정
  - 현재 페이지 하이라이트
- 상단 헤더
  - 로고/서비스 이름
  - 현재 사용자 정보 (Admin 계정)
  - 로그아웃 버튼

### 8.2 공통 기능
- 검색 기능 (전역 검색 바)
- 필터링 및 정렬 (각 목록 페이지)
- 페이지네이션 (대량 데이터 처리)
- 모달/다이얼로그 (상세 정보, 확인 다이얼로그)
- Toast 알림 (성공/에러 메시지)
- 로딩 상태 표시

### 8.3 권한 및 보안
- Admin 인증 (로그인 페이지)
- 세션 관리
- API 엔드포인트 보호 (`/api/admin/*` 라우트)
- CSRF 보호
- 입력 데이터 검증 (Zod 스키마)

---

## 9. 우선순위별 구현 단계

### Phase 1: Part 1 - 캐릭터 콘텐츠 관리 (최우선)
**목표**: 캐릭터 콘텐츠 업로드 및 관리 기능 완성

1. **캐릭터 관리** (1.1 ~ 1.5)
   - 캐릭터 목록
   - 캐릭터 정보 편집 (이름, 역할, bio, 페르소나 프롬프트)
   - 아바타 이미지 업로드
   - 사진 갤러리 관리 (업로드/삭제/순서 변경)
   - 동영상 갤러리 관리 (향후 확장)
   - 캐릭터 생성/삭제
2. **Admin 인증**
   - 로그인 페이지
   - 세션 관리
   - API 보호

### Phase 2: Part 2 - 사용자 및 운영 관리 (필수 기능)
**목표**: 사용자 통계 및 관리 기능 완성

3. **사용자 관리** (2.1 ~ 2.4)
   - 사용자 목록 및 검색
   - 사용자 상세 정보
   - 사용자 통계 (대화방 수, 메시지 수, 사용 시간 등)
   - 구독 등급 변경
   - 결제/구독 통계 (매출, 등급별 분포, 전환율 등)
4. **대화/메시지 관리** (3.1 ~ 3.3)
   - 대화방 목록
   - 대화 내용 조회
   - 대화방/메시지 삭제

### Phase 3: 시스템 모니터링 및 운영 기능
**목표**: 서비스 운영을 위한 모니터링 및 관리 도구

5. **시스템 모니터링** (5.1 ~ 5.4)
   - 대시보드 (전체 통계 요약)
   - API 사용량 모니터링 (Gemini, Cloudinary)
   - 에러 로그
   - 크론 잡 모니터링
6. **서비스 콘텐츠 관리** (4.1 ~ 4.3)
   - 뉴스/이벤트 관리
   - 미션 관리
   - 팬 피드 관리

### Phase 4: 고급 기능 및 유지보수
7. **데이터 관리** (7.1 ~ 7.3)
   - 데이터베이스 백업
   - 데이터 정리
   - 데이터 내보내기
8. **설정 관리** (6.1 ~ 6.2)
   - 시스템 설정
   - Admin 계정 관리

---

## 10. 기술 스택 제안

### 프론트엔드
- **Next.js** (권장) 또는 **Vite + React**
- **shadcn/ui** 또는 **Ant Design** (Admin 대시보드 컴포넌트)
- **Tailwind CSS** (스타일링)
- **Zod** (폼 검증)
- **React Query** 또는 **SWR** (데이터 fetching 및 캐싱)

### 백엔드 API 및 인증
- 기존 React Router v7의 `/api/*` 라우트 활용
- 추가 필요: `/api/admin/*` 라우트
- **인증 (Authentication)**: `better-auth`의 Admin 플러그인 또는 Role 기반 미들웨어를 사용하여 구현
  - 별도의 로그인 페이지보다는 기존 인증 시스템을 확장하여 Admin 권한을 체크

### 데이터베이스 (Schema Requirements)
- 기존 Prisma + Turso 활용
- **필수 스키마 변경 사항**:
  1. **Character 테이블 추가**: 캐릭터 정보(이름, 역할, 바이오, 프롬프트 등) 저장
  2. **User Role 추가**: `User` 모델에 `role` 필드 추가 (예: `USER`, `ADMIN`) - admin 페이지 접근 제어용
  3. **Media 관계 설정**: Character와 Media 간의 관계 설정 필요 (프로필, 갤러리 용)
  4. **FanPost 테이블 신규 생성**: 기존 `Tweet` 테이블은 타 프로젝트 잔재이므로 사용 금지. 독립적인 `FanPost` 모델 정의 필요.

---

## 아키텍처 및 배포 전략 (Architecture & Deployment)

- **단일 리포지토리 (Monolith) 권장**:
  - 별도 리포지토리 대신, 현재 프로젝트 내의 `/routes/admin` 경로 하위에 구현
  - Prisma Client, 타입 정의, 인증 로직을 공유하여 유지보수 효율성 증대
- **접근 제어**:
  - `/admin/*` 경로는 `User.role === 'ADMIN'`인 사용자만 접근 가능하도록 미들웨어 단에서 차단
- **데이터 마이그레이션**:
  - 캐릭터 데이터는 초기에는 하드코딩된 `characters.ts`에서 DB(`Character` 테이블)로 마이그레이션 필요



## Related Documents
- **Specs**: [Document Management Plan](./08_DOCUMENT_MANAGEMENT_PLAN.md) - 문서 관리 규칙 및 구조
