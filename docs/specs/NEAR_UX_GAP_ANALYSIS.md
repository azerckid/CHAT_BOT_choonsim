# NEAR Zero-Friction UX 흐름 및 필수 UI 분석 보고서

이 문서는 사용자가 NEAR 기반의 결제 및 서비스를 이용하는 전체 흐름(User Journey)을 정의하고, 각 단계에서 필수적으로 요구되는 UI와 현재 구현 상태를 분석하여 누락된 요소(Gap)를 도출합니다.

## 1. 전체 사용자 흐름 (User Journey Overview)

1.  **진입 (Entry)**: 앱 실행 및 자동 지갑 생성 (Invisible Wallet).
2.  **입금 (Deposit)**: 외부 지갑에서 NEAR를 앱 내 지갑으로 전송.
3.  **환전 (Swap)**: 입금된 NEAR를 서비스 재화(CHOCO)로 변환.
4.  **사용 (Payment)**: 유료 기능(채팅 등) 사용 시 402 에러 처리 및 가스리스 결제.
5.  **확인 (Verify)**: 잔액 차감 내역 및 가스비 무료 확인.

---

## 2. 단계별 상세 분석

### 단계 1: 진입 (Entry & Wallet Check)
*   **사용자 행동**: 로그인 후 "내 지갑"이 어디 있는지 확인하고 싶어함.
*   **필수 UI**:
    *   [ ] **지갑 주소 표시**: 메인 화면이나 설정 진입 직후 눈에 띄는 곳에 배치.
    *   [ ] **복사 버튼**: 주소를 쉽게 복사할 수 있는 버튼.
*   **현재 상태 (As-Is)**:
    *   `/settings` 하단 "지갑 관리" > "지갑 내보내기" 다이얼로그 내부에 숨겨져 있음.
    *   사용자가 찾기 매우 어려움.
*   **필요한 개선 (To-Be)**:
    *   설정 메인 화면 상단(프로필 아래)에 지갑 주소 카드 배치.

### 단계 2: 입금 (Deposit)
*   **사용자 행동**: "돈을 넣고 싶어" -> 입금 버튼을 누름 -> QR코드나 주소를 보고 송금함.
*   **필수 UI**:
    *   [ ] **[입금] 버튼**: 직관적인 액션 버튼 (Deposit / Receive).
    *   [ ] **QR 코드**: 모바일 지갑 스캔용 QR.
    *   [ ] **입금 가이드**: "NEAR 네트워크로 전송하세요" 등의 문구.
*   **현재 상태 (As-Is)**:
    *   **전무함.** 입금 버튼도 없고, QR 코드도 없음.
    *   사용자는 "지갑 내보내기"에서 주소를 본 후, 알아서 외부 지갑을 켜고 전송해야 함.
*   **필요한 개선 (To-Be)**:
    *   **입금 전용 모달(Dialog)** 구현. (QR 코드 포함)
    *   지갑 잔액 표시 화면 옆에 `[충전]` 버튼 배치.

### 단계 3: 환전 (Swap / Exchange)
*   **사용자 행동**: "NEAR는 있는데 CHOCO가 없네?" -> NEAR를 CHOCO로 바꾸고 싶음.
*   **필수 UI**:
    *   [ ] **잔액 현황판**: `NEAR: 5.2` / `CHOCO: 0` 등 이중 잔액 표시.
    *   [ ] **[환전] 버튼**: 스왑 UI 진입점.
    *   [ ] **환전 인터페이스**:
        *   입력창: "1 NEAR" 입력 시 -> "5,000 CHOCO" 예상 수령액 표시.
        *   환율 표시: `1 NEAR = 5,000 CHOCO` (실시간/고정).
        *   **[변환하기] 버튼**: 실행 액션.
*   **현재 상태 (As-Is)**:
    *   ✅ 백엔드(`exchange-rate.server.ts`) 구현 완료
    *   ✅ **자동 환전 기능 구현됨**: 입금 시 자동으로 CHOCO로 환전됨 (`deposit-engine.server.ts`)
    *   ❌ **프론트엔드 UI는 전무함**: 수동 환전 UI 없음
    *   ⚠️ 사용자는 입금하면 자동으로 CHOCO로 환전되지만, 수동으로 환전할 방법이 없음
*   **필요한 개선 (To-Be)**:
    *   간단한 **Swap UI** 구현 필요 (수동 환전용).
    *   또는 입금 시 **자동 환전 옵션 토글** 제공 (현재는 항상 자동 환전됨).

### 단계 4: 사용 (Usage & 402 Payment)
*   **사용자 행동**: 유료 채팅 시도 -> "Credit 부족" 경고 -> "결제하시겠습니까?" 팝업 -> 승인.
*   **필수 UI**:
    *   [x] **402 결제 시트(Payment Sheet)**: ✅ 구현 완료
        *   청구 금액 표시 (예: "10 CHOCO"). ✅
        *   보유 잔액 및 차감 후 잔액 표시. ✅
        *   **[결제 승인] 버튼**. ✅
    *   [x] **자동 결제**: ✅ 구현 완료 (백엔드 Allowance 기반)
        *   한도 내 자동 결제 로직 구현됨 (`use-x402.ts`)
        *   UI 토글은 없으나 백엔드에서 자동 처리됨
*   **현재 상태 (As-Is)**:
    *   ✅ `use-x402.ts` 훅 구현 완료
    *   ✅ `PaymentSheet` 컴포넌트 구현 완료 (`app/components/payment/PaymentSheet.tsx`)
    *   ✅ `root.tsx`에서 Global Payment Modal 연동 완료
    *   ✅ 402 인터셉터 작동 확인됨 (전역 fetch 인터셉터)
    *   ✅ 채팅방 내 402 에러 처리 로직 구현됨 (`app/routes/api/chat/index.ts`)
*   **필요한 개선 (To-Be)**:
    *   ⚠️ 자동 결제 토글 UI 추가 (선택 사항, 현재는 백엔드에서 자동 처리)

### 단계 5: 잔액 및 내역 확인 (History)
*   **사용자 행동**: "방금 얼마 빠져나갔지?" -> 내역 확인.
*   **필수 UI**:
    *   [ ] **Transaction History**: 최근 사용/충전 내역 리스트.
    *   [ ] **가스비 무료 표시**: "수수료: 0 NEAR (대납됨)" 등을 명시하여 효능감 제공.
*   **현재 상태 (As-Is)**:
    *   없음.
*   **필요한 개선 (To-Be)**:
    *   설정 > 지갑 관리 내에 **"사용 내역"** 탭 추가.

---

## 3. 요약 및 우선순위 (To-Do List)

현재 UI 상태로는 **"입금 -> 환전 -> 사용"의 흐름이 부분적으로 단절**되어 있습니다. 사용자가 직접 테스트하려면 다음 기능들이 **반드시** 추가되어야 합니다.

### 구현 완료된 기능 ✅
- ✅ **402 결제 시스템**: Global Payment Modal 연동 완료 (`root.tsx`)
- ✅ **자동 환전**: 입금 시 자동으로 CHOCO로 환전됨 (`deposit-engine.server.ts`)
- ✅ **자동 결제**: 한도 내 자동 결제 로직 구현됨 (`use-x402.ts`)

### 구현 필요 기능

1.  **[최우선] 입금 UI (QR)**: 돈을 넣을 구멍이 없음. (`settings.tsx` 수정 필요)
    *   입금 버튼, QR 코드, 입금 가이드 필요
    *   현재는 "지갑 내보내기"에서 주소를 확인한 후 외부 지갑으로 직접 전송해야 함

2.  **[최우선] 환전(Swap) UI**: 수동 환전 UI 없음. (신규 컴포넌트 필요)
    *   자동 환전은 작동하나, 사용자가 수동으로 환전할 방법이 없음
    *   잔액 현황판 (NEAR/CHOCO 이중 표시) 필요

3.  **[필수] 잔액 표시**: 내가 얼마 있는지 알기 어려움.
    *   `WalletBalance` 컴포넌트는 있으나 사용처 불명확
    *   설정 화면에 명확한 잔액 표시 필요

4.  **[권장] 결제 내역**: 사후 확인용.
    *   Transaction History UI 없음
    *   백엔드 데이터는 있음 (`ExchangeLog`, `TokenTransfer` 테이블)

이 순서대로 UI 작업을 진행해야만 UAT가 의미를 가질 수 있습니다.
